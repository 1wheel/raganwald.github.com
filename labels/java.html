<html> 
<head>
        
        <title><script type="text/javascript" src="http://www.blogger.com/static/v1/common/js/327583163-csitaillib.js"></script>raganwald</title>

	<link rel="stylesheet" type="text/css" href="/blog.css" />
	<link rel="stylesheet" type="text/css" href="/sunburst.css" />

	<!-- Meta Information --> 
	<!-- put "BlogMetaData" between angle-dollar and dollar angle  to restore defaults -->

	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<meta name="MSSmartTagsPreventParsing" content="true" />
	<meta name="generator" content="Blogger" />

	<link rel="alternate" type="application/atom+xml" title="Raganwald Posts + Links(Atom)" href="http://feeds.raganwald.com/raganwald" />
	<!-- <link rel="alternate" type="application/rss+xml" title="Raganwald Posts + Links (RSS 2.0)" href="http://feeds.raganwald.com/raganwald" /> -->
	<link rel="alternate" type="application/atom+xml" title="Raganwald Posts Only (Atom)" href="http://feeds.raganwald.com/raganwald_articles" />
	<link rel="alternate" type="application/atom+xml" title="Raganwald on Twitter (Atom, experimental)" href="http://twitter.com/statuses/user_timeline/14165291.atom" />

	<link rel="service.post" type="application/atom+xml" title="Raganwald" href="https://www.blogger.com/atom/7618424" />
	<link rel="service.post" type="application/atom+xml" title="Raganwald (Atom 1.0)" href="http://www.blogger.com/feeds/7618424/posts/full" />

	<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://www.blogger.com/rsd.g?blogID=7618424" />



    <link rel="openid.server" href="http://www.myopenid.com/server " />
    <link rel="openid.delegate" href="http://reginald.braithwaite.myopenid.com/" />
    <meta http-equiv="X-XRDS-Location" content="http://reginald.braithwaite.myopenid.com/xrds" />




	<style type="text/css">
	@import url("http://www.blogger.com/css/blog_controls.css");
	@import url("http://www.blogger.com/dyn-css/authorization.css?blogID=7618424");
	</style>

	<!-- /Meta Information -->
<link rel="me" href="http://www.blogger.com/profile/13132345822387028437" />
</head>

<body>

	<div id="leftcontent">
			<img src="http://weblog.raganwald.com/assets/raganwald_2008_350_150" 
			width="350" height="150" border="0" alt="raganwald" title="raganwald 2008" align="middle"/><br/>
<!--
<div style="background-color:black; text-align: center; color: white; padding: 10px 10px 10px 10px;">
<p><font size="+1">Arthur C. Clarke</font><font size="-1">, 1917&thinsp;&ndash;&thinsp;2008
<br/>&ldquo;If we have learned one thing from the history of invention and discovery,
<br/>it is that, in the long run&mdash;and often in the short one&mdash;the most daring prophecies seem laughably conservative.&rdquo;</font>
</p></div>
-->
		
			
				<div class="DateHeader">Thursday, October 25, 2007</div>
			

			<div class="Post"><a name="5039489814009701313">&nbsp;</a>
				<span class="PostTitle">

					<a href="http://weblog.raganwald.com/2007/10/too-much-of-good-thing-not-all.html" title="permanent link">Too much of a good thing: not all functions should be object methods</a></span>
					<div style="clear:both;"></div>OOP is several different ideas put together, the most important of which is <em>Fine-Grained Information Hiding</em>.<br /><br /><blockquote>One can think of information hiding as being the principle and encapsulation being the technique. A software module hides information by encapsulating the information into a module or other construct which presents an interface.<br /></blockquote><div style="text-align: right;">&mdash;<a href="http://en.wikipedia.org/wiki/Information_hiding" title="Information hiding - Wikipedia, the free encyclopedia">Information Hiding</a> on Wikipedia</div><br /><br />The basic principle of all OO languages is that relatively small things&#8212;such as individual accounts in a business program&#8212;each encapsulate both their data (in the form of members) and their algorithms (in the form of methods). Our notions of members and polymorphism both work to this goal of hiding information. There&#8217;s a lot more to most OO languages, such as whether they include a notion of types and what mechanisms they use for sharing common behaviour. But let&#8217;s look at this one principle: <em>objects are responsible for their data and for their algorithms</em>.<br /><br /><strong>should objects be responsible for all of their own behaviour?</strong><br /><br />There&#8217;s a general idea that in a well-constructed program, each object &#8220;knows&#8221; how it ought to behave. That&#8217;s what its methods are for. Quite obviously, objects cannot be responsible for <em>everything</em> involving them in a program. If each object completely encapsulated all of the things it could do or be involved in, you would never pass one object as a parameter in a message to another object.<br /><br /><blockquote>For every complex problem, there is a solution that is simple, neat, and wrong.<br /></blockquote><div style="text-align: right;">&mdash;H. L. Mencken</div><br /><br />For example, you would never have collections. If every object &#8220;knew&#8221; how to organize itself into collections, you wouldn&#8217;t need an Array or Hash, would you? In practice, each object in a system can be involved in many different actions. It has to be responsible for some of them, and it has to play a secondary, passive role in others. Most OO programs do not have every object implement its own collections methods. They may include some form of specialization so you can have an array of accounts, but an array of accounts is still not an account.<br /><br /><strong>subject.verb(object)</strong><br /><br />In the English language, we have the idea of a <em>Subject</em> and an <em>Object</em> in a sentence. For example, when we say &#8220;Jack loves Jill,&#8221; Jack is a subject and Jill is an object. Jack loves. Jill is loved. It&#8217;s the same in OO programs. Sometimes objects are actively doing things through their methods. Sometimes other object&#8217;s methods are doing things with them.<br /><br /><blockquote>Verbing Weirds Language<br /></blockquote><div style="text-align: right;">&mdash;Bill Watterson, <a href="http://en.wikipedia.org/wiki/Calvin_and_Hobbes" title="Calvin and Hobbes - Wikipedia, the free encyclopedia">Calvin and Hobbes</a></div><br /><br />Good OO design is, in part, doing a good job of choosing the right bifurcations: given a list of nouns and verbs, making the right decisions about which nouns ought to be the active nouns, the subjects, the ones that &#8220;own&#8221; the verb in the form of a method. And thus consciously making decisions about which objects ought to be the passive nouns, the objects of the verbs, the ones that <em>don&#8217;t</em> implement the methods.<br /><br />Unfortunately, there are lots of places where we can err on the side of giving too much responsibility to individual objects. It&#8217;s understandable, given that OO is theoretically all about objects being responsible for themselves. But as in many other things, in practice good OO is about objects being responsible for a little as possible (but no less!), not as much as possible.<br /><br /><strong>the kingdom of nouns</strong><br /><br />One common symptom of this problem is <a href="http://steve-yegge.blogspot.com/2006/03/execution-in-kingdom-of-nouns.html" title="Stevey's Blog Rants: Execution in the Kingdom of Nouns">a system that has objects for all of the obvious nouns or entities, but not for the verbs</a>. OO began with languages like <a href="http://en.wikipedia.org/wiki/Simula" title="Simula - Wikipedia, the free encyclopedia">Simula</a>, where the paradigm was trying to represent real-world entities such as automobiles on a highway. From that time forward, the emphasis has been on having objects for each noun in the problem domain. In such traditionally-organized OO programs, the &#8220;verbs&#8221; or actions are all attached to objects as methods. <br /><br /><div class="book"><hr/><em><a id="lnx0" name="evtst|a|0201379430" href="http://www.amazon.com/gp/product/0201379430?ie=UTF8&amp;tag=raganwald001-20&amp;link_code=as3&amp;camp=211189&amp;creative=373489&amp;creativeASIN=0201379430"><img src="http://weblog.raganwald.com/uploaded_images/object_design-719894.jpg" border="0" height="160" width="128"></a><img src="http://www.assoc-amazon.com/e/ir?t=raganwald001-20&amp;l=as2&amp;o=1&amp;a=0201379430" alt="" style="border: medium none  ! important; margin: 0px ! important;" border="0" height="1" width="1"><br><br><a name="evtst|a|0201379430" href="http://www.amazon.com/gp/product/0201379430?ie=UTF8&amp;tag=raganwald001-20&amp;link_code=as3&amp;camp=211189&amp;creative=373489&amp;creativeASIN=0201379430">Object Design: Roles, Responsibilities, and Collaborations</a><img src="http://www.assoc-amazon.com/e/ir?t=raganwald001-20&amp;l=as2&amp;o=1&amp;a=0201379430" alt="" style="border: medium none  ! important; margin: 0px ! important;" border="0" height="1" width="1"> focuses on the practice of designing objects as integral members of a community where each object has specific roles and responsibilities. The authors present the latest practices and techniques of Responsibility-Driven Design and show how you can apply them as you develop modern object-based applications.  <br><br></em><hr/></div>Not all &#8220;verbs&#8221; have a clear separation between a single entity that is the subject or active entity that ought to own the verb&#8217;s definition and the secondary, passive subject entities that should not own the verb&#8217;s definition. The easiest examples of this are operations that are intended to be <a href="http://en.wikipedia.org/wiki/Commutativity" title="Commutativity - Wikipedia, the free encyclopedia">commutative</a>.<br /><br />For example, many languages define addition as a method belonging to numbers or magnitudes. In Smalltalk, the expression <code>1 + 2</code> actually means &#8220;<em>send the message</em> <code>+ 2</code> <em>to the object</em> <code>1</code>.&#8221; At first glance, this seems elegant: the number <code>1</code> handles the message <code>+ 2</code> as integer addition, while <code>1.0</code> would handle the same message with floating point arithmetic. What more could you want?<br /><br />Well, there is a huge problem with this arrangement: <em>Addition is commutative</em>. <code>1.0 + 2</code> must give the same result as <code>2 + 1.0</code>. Using a simple message to implement addition means that you must be excruciatingly careful to handle all of the possible cases so that you do not accidentally violate this property. Now of course, the designers of system classes like <code>Integer</code> and <code>Float</code> went to this trouble. But if you want to add another magnitude class&#8212;say <code>CurrencytwoPlaceDecimal</code>&#8212;you have to open up all of the system classes and modify them so that <code>1 + ThirtyCents</code> gives the same result as <code>ThirtyCents + 1</code>.<br /><br /><strong>beware of breaking symmetry</strong><br /><br />Of course, you may not need to implement a new magnitude class. Fine. But what about <a href="http://en.wikipedia.org/wiki/Symmetric_relation" title="Symmetric relation - Wikipedia, the free encyclopedia">symmetric relations</a> like <em>comparison</em>? This is a major pitfall for OO developers: in many cases you need to write a test of equivalence or equality (operations like <code>==</code>, <code>equal?</code>, <code>eql?</code>, <code>eqv?</code> and all of the other variations on the same theme). In every one of these cases, horrible things will happen if your operation is not symmetric. For every case, <code>x.eql?(y)</code> if-and-only-if <code>y.eql?(x)</code>.<br /><br />This is obviously easy when <code>x</code> and <code>y</code> are both the same kind of object. <a href="http://weblog.raganwald.com/2007/04/what-does-barbara-liskov-have-to-say.html" title="What does Barbara Liskov have to say about Equality in Java?">What happens when they&#8217;re different, but still logically equivalent?</a> It turns out that implementing commutative operations and symmetric relations as methods doesn&#8217;t work very well. It forces you to smear duplicate logic over many different classes (or prototypes, if your language swings that way).<br /><br />Here&#8217;s a practical example. Let&#8217;s say you want to implement a form of equivalence for collections. For ordered collections like lists, what you want is that if two ordered collections have the same members, in the same order, they are equivalent. It&#8217;s easy to imagine writing such a method as a <a href="http://en.wikipedia.org/wiki/Mixin" title="Mixin - Wikipedia, the free encyclopedia">mixin</a> for all of your ordered collections. It obviously knows about iterating over ordered collections (recursively, if you grew up with <a href="http://www.amazon.com/gp/product/0465026567?ie=UTF8&amp;tag=raganwald001-20&amp;link_code=as3&amp;camp=211189&amp;creative=373489&amp;creativeASIN=0465026567" title="Amazon.com: Godel, Escher, Bach: An Eternal Golden Braid by Douglas R. Hofstadter">Godel, Escher, Bach</a> on your night stand). Note that you may not have an indexed collection: you might have a <code>list</code> where you simply retrieve values in order.<br /><br />And likewise, you can write a collection equivalence method for dictionaries like hash tables: if two objects have the same values at the same keys, they are equivalent. Again, a simple mixin will handle things for dictionaries.<br /><br />Now comes the wrinkle: you decide that an ordered collection ought to be equivalent to a dictionary where the keys are the integers ascending from zero. In other words, <code>('foo' 'bar' 'blitz')</code> ought to be equivalent to <code>{ 0 =&gt; 'foo', 1 =&gt; 'bar', 2 =&gt; 'blitz' }</code>. How are you going to code this? Well, the dictionary mixin could obviously handle equivalence to an ordered list. But we need symmetry, so we have to &#8220;open up&#8221; the ordered collection mixin and add code for equivalence to dictionaries.<br /><br /><blockquote>Actually I made up the term object-oriented and I can tell you I did not have C++ in mind. The important thing here is that I have many of the same feelings about Smalltalk.<br /></blockquote><div style="text-align: right;">&mdash;Alan Kay</div><br /><br />I&#8217;m holding my nose, we have not one but two different code smells: 1) Why is one piece of logic in two different places? 2) Why do ordered collections know anything at all about dictionaries, and why do dictionaries know anything at all about ordered collections? The latter is especially disturbing: the whole point of OO is information hiding. How does having ordered collections and dictionaries knowing about each other help us to hide information?<br /><br />The obvious answer to me is that the knowledge of how to compare an ordered collection to a dictionary does not belong in ordered collections or in dictionaries. The requirement that relations like equivalence be symmetrical across heterogeneous types implies that the types themselves cannot be responsible for implementing equivalence for themselves.<br /><br />There are similar problems of code duplication and information leakage apply to modelling relations (why do we declare <code>has_one</code> and <code>belongs_to</code> in Rails) and implementing the <code>&lt;=&gt;</code> operator in Ruby. It looks like having verbs &#8220;belong to&#8221; the subject noun is often a good idea, but not always a good idea.<br /><br /><strong>commuting the sentence of execution</strong><br /><br />Maybe some verbs belong to objects, but some are best on their own? Maybe <code>+</code> and <code>&lt;=&gt;</code> and <code>equivalent?</code> really ought to be emancipated from their subservience to objects and ought to have their own definitions.<br /><br /><blockquote>There are two real approaches to object-orientation. The first is known as message-passing. You send an object a message and ask it to deal with it. (This would not work with many people in this newsgroup.) The meaning of the message is local to the object, which inherits it from the class of which it is an instance, which may inherit it from superclasses of that class&#8230;<br />  <br />  The second approach is generic functions. A generic function has one definition of its semantics, its argument list, and is only specialized on particular types of arguments. <br /></blockquote><div style="text-align: right;">&mdash;<a href="http://groups.google.com/group/comp.lang.lisp/msg/60f4c36a707db3fe">Erik Naggum discussing CLOS on comp.lang.lisp</a></div><br /><br />What we ought to do is take some of the verbs and give them their own place in our programs, instead of hanging them off nouns. This isn&#8217;t such a revolutionary idea: Common Lisp&#8217;s <a href="http://www.amazon.com/gp/product/0262610744?ie=UTF8&amp;tag=raganwald001-20&amp;link_code=as3&amp;camp=211189&amp;creative=373489&amp;creativeASIN=0262610744" title="Amazon.com: The Art of the Metaobject Protocol by Gregor Kiczales">Metaobject Protocol</a> does this exact thing, providing <a href="http://en.wikipedia.org/wiki/Generic_function" title="Generic function - Wikipedia, the free encyclopedia">generic functions</a>. A generic function is, in effect, a verb raised to the same level of abstraction as a noun.<br /><br />This isn&#8217;t some revolutionary idea limited to &#8220;powerful&#8221; languages either: the Java collections framework uses a <a href="http://java.sun.com/j2se/1.4.2/docs/api/java/lang/Comparable.html" title="Comparable (Java 2 Platform SE v1.4.2)"><code>Comparable</code></a> interface for ordering collections. The <code>compareTo(...)</code> method belongs to an object. By way of&#8212;ahem&#8212;comparison, the <a href="http://java.sun.com/j2se/1.4.2/docs/api/java/util/Comparator.html" title="Comparator (Java 2 Platform SE v1.4.2)"><code>Comparator</code></a> interface extracts comparison out of the subject object and puts it in a separate function object. You can perform sorts in Java either way.<br /><br />If we aren&#8217;t using Common Lisp, can we build the verbs we want out of the tools at our disposal? In other words, can we <a href="http://en.wikipedia.org/wiki/Greenspun%27s_Tenth_Rule" title="Greenspun's Tenth Rule - Wikipedia, the free encyclopedia">Greenspun</a> generic functions in languages like Java and Ruby?<br /><br /><strong>generic functions in java, plus a detailed look at method dispatching</strong><br /><br />Let&#8217;s start by thinking about generic functions in a Java-like language.<br /><br />Returning to our example of writing <code>equivalent?</code>, we might make an <code>Equivalent</code> class with a single method, perhaps we can call it <code>eval</code>. So we end up with something like <code>Eqivalent.eval(foo, bar)</code>. Java-like languages allow us to write different versions of the <code>eval</code> method with different type signatures, so we can write:<br /><pre><code><br />public static boolean eval (List foo, List bar) { ... }<br />public static boolean eval (List foo, Map bar) { ... }<br />public static boolean eval (Map foo, List bar) { return eval(bar, foo); }<br />public static boolean eval (Map foo, Map bar) { ... }</code></pre><br />And so forth. Are we done?<br /><br />No, our code is broken. What happens when we decide that the &#8220;default&#8221; equivalence is the <code>==</code> relationship. We can&#8217;t write:<br /><pre><code><br />public static boolean eval (Object foo, Object bar) { return foo == bar; }</code></pre><br />This is hideously broken in languages like Java. You&#8217;re almost all nodding in agreement, but please be patient while I explain it anyway: you probably want to pass this along to someone who really needs to be told why it is broken, so why don&#8217;t I go ahead and explain it for <em>them</em>?<br /><br />What you want is that if two objects are of the more specific types&#8212;<code>List</code> and <code>Map</code>&#8212;we will call the more specific version of the <code>eval</code> methods. But if we can&#8217;t &#8220;match&#8221; one of the more specific <code>eval</code> methods, we want to use <code>eval (Object foo, Object bar)</code>. Too bad, that&#8217;s not how Java works. <em>Java uses two completely different ways to figure out which method to call when you overload methods!</em><br /><br />Way number one is is for figuring out that when you call <code>noun.verb(...)</code>, where do we find the definition for <code>verb</code>? This lookup is effectively done at run time, so that even if your code looks like this:<br /><pre><code><br />public static void printSomething(Object foo) {<br />    System.out.println(foo.toString());<br />}</code></pre><br />Java will look up the method <code>toString</code> based on <code>foo</code>&#8217;s actual type when the method is called, even though you declared it to be an <code>Object</code>. That&#8217;s polymorphism at work, and it&#8217;s the information hiding working for us. Each object can do it&#8217;s own thing where <code>toString</code> is concerned, and we don&#8217;t have to worry about it. This is called <a href="http://en.wikipedia.org/wiki/Single_dispatch" title="Dynamic dispatch - Wikipedia, the free encyclopedia">single dispatch</a>, because it figures out which method to call based on just one of the nouns, the subject noun a/k/a the receiver of the method invocation.<br /><br />But that&#8217;s not what happens when we write this:<br /><pre><code><br />public static void printSomethingElse (Object foo, Object bar) {<br />    if (Equivalent.eval(foo, bar))<br />        System.out.println("2 x " + foo);<br />    else System.out.println(foo.toString() + ", " + bar.toString());<br />}</code></pre><br />It will <em>always</em> call <code>eval (Object foo, Object bar)</code>. It will <strong>not</strong> call <code>eval (List foo, List bar)</code> if you pass it two lists. That&#8217;s because although each of our methods have the same name&#8212;<code>eval</code>&#8212;Java treats them as different methods, and it figures out which one to call based on the declared types of the parameters at compile time, not on the actual types of the parameters&#8217; values at run time.<br /><br /><div class="book"><hr/><em><a id="lnx0" name="evtst|a|0262561158" href="http://www.amazon.com/gp/product/0262561158?ie=UTF8&amp;tag=raganwald001-20&amp;link_code=as3&amp;camp=211189&amp;creative=373489&amp;creativeASIN=0262561158"><img src="http://weblog.raganwald.com/uploaded_images/a_little_java-777624.jpg" border="0"></a><img src="http://www.assoc-amazon.com/e/ir?t=raganwald001-20&amp;l=as2&amp;o=1&amp;a=0262561158" alt="" style="border: medium none  ! important; margin: 0px ! important;" border="0" height="1" width="1"><em><br><br>Free your mind with <a name="evtst|a|0262561158" href="http://www.amazon.com/gp/product/0262561158?ie=UTF8&amp;tag=raganwald001-20&amp;link_code=as3&amp;camp=211189&amp;creative=373489&amp;creativeASIN=0262561158">A Little Java, a Few Patterns</a>: The authors of <a name="evtst|a|0262560992" href="http://www.amazon.com/gp/product/0262560992?ie=UTF8&amp;tag=raganwald001-20&amp;link_code=as3&amp;camp=211189&amp;creative=373489&amp;creativeASIN=0262560992">The Little Schemer</a><img src="http://www.assoc-amazon.com/e/ir?t=raganwald001-20&amp;l=as2&amp;o=1&amp;a=0262560992" alt="" style="border: medium none  ! important; margin: 0px ! important;" border="0" height="1" width="1"> and <a name="evtst|a|026256114X" href="http://www.amazon.com/gp/product/026256114X?ie=UTF8&amp;tag=raganwald001-20&amp;link_code=as3&amp;camp=211189&amp;creative=373489&amp;creativeASIN=026256114X">The Little MLer</a><img src="http://www.assoc-amazon.com/e/ir?t=raganwald001-20&amp;l=as2&amp;o=1&amp;a=026256114X" alt="" style="border: medium none  ! important; margin: 0px ! important;" border="0" height="1" width="1"> bring deep and important insights to the Java language. Every serious Java programmer should own a copy.</em><br><br></em><hr/></div>Besides writing a Lisp interpreter in Java, your next best bet for building a generic function the way we want it is to find a way to turn Java&#8217;s single dispatch into a multi-dispatch, to dispatch on two nouns, <code>foo</code> and <code>bar</code>.<br /><br />The good news is this: dispatching at run time on two different types is a well-known problem, and the solution is called <a href="http://en.wikipedia.org/wiki/Double_dispatch" title="Double dispatch - Wikipedia, the free encyclopedia">double dispatch</a>. The problem with double dispatch is that it moves our equivalence code back into our nouns, and we don&#8217;t want that.<br /><br />The <a href="http://en.wikipedia.org/wiki/Visitor_pattern" title="Visitor pattern - Wikipedia, the free encyclopedia">Visitor</a> pattern might be handy: it&#8217;s a way to add methods to an object at run time in a language like Java that supposedly doesn&#8217;t do that. If we decide that everything to be compared using <code>Equivalent.eval</code>implements an interface called <code>Visitable</code>, we can build a double dispatch system that doesn&#8217;t require putting an <code>equivalent?</code> method in the entities being compared:<br /><pre><code><br />interface Visitable {<br />    Object accept(final Visitor visitor);<br />}<br /><br />interface Visitor {<br />    Object visit(final Object obj);<br />    Object visit(final List list);<br />    Object visit(final Map map);<br />}<br /><br />public class Equivalent {<br /><br />    static boolean list_list (List foo, List bar) { ... }<br />    static boolean list_map (List foo, Map bar) { ... }<br />    static boolean map_map (Map foo, Map bar) { ... }<br />    static boolean object_object (Object foo, Object bar) { ... }<br /><br />    public static boolean eval (final Visitable foo, final Visitable bar) {<br />        return foo.accept(<br />            bar.accept(<br />                new Visitor () {<br />                    public Object visit(final Object bar) {<br />                        return new Visitor () {<br />                            public Object visit(final Object foo) {<br />                                return object_object(foo, bar);<br />                            }<br />                            public Object visit(final List foo) {<br />                                return object_object(foo, bar);<br />                            }<br />                            public Object visit(final Map foo) {<br />                                return object_object(foo, bar);<br />                            }<br />                        }<br />                    }<br />                    public Object visit(final List bar) {<br />                        return new Visitor () {<br />                            public Object visit(final Object foo) {<br />                                return object_object(foo, bar);<br />                            }<br />                            public Object visit(final List foo) {<br />                                return list_list(foo, bar);<br />                            }<br />                            public Object visit(final Map foo) {<br />                                return list_map(bar, foo);<br />                            }<br />                        }<br />                    }<br />                    public Object visit(final Map bar) {<br />                        return new Visitor () {<br />                            public Object visit(final Object foo) {<br />                                return object_object(foo, bar);<br />                            }<br />                            public Object visit(final List foo) {<br />                                return list_map(foo, bar);<br />                            }<br />                            public Object visit(final Map foo) {<br />                                return map_map(foo, bar);<br />                            }<br />                        }<br />                    }<br />                }<br />            )<br />        )<br />    }<br />}</code></pre><br />If that looks like a lot of work to you, I agree. You&#8217;re basically replicating Java&#8217;s run time dispatching on two types, so you need a bit of a matrix. Is it worth the effort? Let&#8217;s consider what this wins you:<br /><br /><ul><li>Your entities or objects no longer need to know all about other types of entities;</li><br /><li>It&#8217;s easier to make sure that commutation and symmetry are preserved when the code for a relationship is in its own class and not smeared over multiple entities.</li></ul><br />And best of all, you have a nice place for your verbs, and they are no longer second-class citizens behind the nouns.<br /><hr/><br />Update: A few people have suggested alternate approaches to implementing multiple dispatch in Java. I think there are various trade-offs to be made, and several different implementations ought to be considered before you write production code.<br /><br />However, the point of the article is to suggest that not all functions should be implemented as methods of subject objects. I think it makes that point regardless of what you think of using a Visitor and a double dispatch.<br /><br />Here&rsquo;s an alternate approach from <a href="http://programming.reddit.com/user/LaurieCheers/">Laurie Cheers</a>:<br /><pre><code>interface Classifiable<br />{<br />    int classify();<br />}<br /><br />// I know this isn't valid Java, but it makes the example much clearer. The alternative is to tiresomely spell out every combination.<br />#define PAIR(a,b) (a|(b&lt;&lt;4))<br /><br />abstract class DoubleDispatchable<br />{<br />    abstract Object list_list(List a, List b);<br />    abstract Object list_map(List a, Map b);<br />    abstract Object map_map(Map a, Map b);<br />    abstract Object object_object(Object a, Object b);<br /><br />    const int OBJECT = 0;<br />    const int LIST = 1;<br />    const int MAP = 2;<br /><br />    Object dispatch(Classifiable a, Classifiable b)<br />    {<br />        switch(PAIR(a.classify(), b.classify))<br />        {<br />            case PAIR(LIST, MAP): return list_map(a,b);<br />            case PAIR(MAP, LIST): return list_map(b,a);<br />            case PAIR(LIST, LIST): return list_list(a,b);<br />            case PAIR(MAP, MAP): return map_map(a,b);<br />            default: return object_object(a,b);<br />        }<br />    }<br />}<br /><br />class Equivalent extends DoubleDispatchable<br />{<br />    Object list_list(List a, List b) {...}<br />    Object list_map(List a, Map b) {...}<br />    Object map_map(Map a, Map b) {...}<br />    Object object_object(Object a, Object b) {...}<br /><br />    bool eval(Classifiable a, Classifiable b) { return dispatch(a,b) != false; }<br />}<br /></code></pre><br />What trade-offs, you ask? The Visitor pattern given gets the compiler to guarantee that you write each of the nine cases, whereas hand-written tests and logic simplifies the code.<br /><br />I specifically chose the Visitor pattern because it seemed more in keeping with the spirit of the Java language and culture, trading verbosity for compiler safety.<br /><br />I'm extremely comfortable with the other trade-off, emphasizing readability and simplicity. Although, if you go far enough down that road, you might as well look at other languages ;-)<div style="clear:both; padding-bottom:0.25em"></div><p class="blogger-labels">Labels: <a rel='tag' href="http://weblog.raganwald.com/labels/java.html">java</a>, <a rel='tag' href="http://weblog.raganwald.com/labels/lispy.html">lispy</a>, <a rel='tag' href="http://weblog.raganwald.com/labels/popular.html">popular</a></p>&nbsp;
					<span class="PostFooter">

						&para; <a href="http://weblog.raganwald.com/2007/10/too-much-of-good-thing-not-all.html" title="permanent link">11:24 PM</a>

					 
				</span> 


                                        <p id="postfeeds"></p>

			</div>

			

		
			
				<div class="DateHeader">Wednesday, May 09, 2007</div>
			

			<div class="Post"><a name="3249831202425873324">&nbsp;</a>
				<span class="PostTitle">

					<a href="http://weblog.raganwald.com/2007/05/hard-core-concurrency-considerations.html" title="permanent link">Hard-Core Concurrency Considerations</a></span>
					<div style="clear:both;"></div><a href="http://www.peerbox.com:8668/space/start">Kevin Greer</a> responded to <a href="http://weblog.raganwald.com/2007/04/haskell-not-just-for-language-weenies.html" title="Don't have a COW, man? What Haskell teaches us about writing Enterprise-scale software">What Haskell teaches us about writing Enterprise-scale software</a> with some insightful emails about the pros and cons of using purely functional data structures for managing concurrency in a multi-processor environment. I&#8217;ve reproduced them (with his permission) below.<br /><br />Now, your first reaction might be, &#8220;Ah, Reg is not nearly as smart as he thinks he is.&#8221;<br /><br />If you feel like giving me some credit, you can keep in mind that I was not writing the definitive essay on designing concurrent software, just pointing out some interesting overlaps between what I consider to be the most academic programming language around and the most practical requirements in business applications.<br /><br />But there&#8217;s something more important to take from this.<br /><br />The original post was a response to someone asking whether there was any value to the stuff you read on <a href="http://programming.reddit.com/" title="reddit.com: programming - what&#39;s new online">programming.reddit.com</a>. His query was whether reading about Haskell was <em>practical</em>. My response was, yes it is, and here are some examples of where functional data structures have an analogue in concurrent data structures. My thesis (that&#8217;s a two dollar word for &#8220;point&#8221;) was that many &#8220;impractical&#8221; things have a lot to teach us about things we will encounter in the pragmatic &#8220;<a href="http://weblog.raganwald.com/2006/09/business-programming-simply-isnt-that.html">real world</a>.&#8221;<br /><br /><div class="book"><hr/><em><a href="http://www.amazon.com/gp/product/0321349601?ie=UTF8&tag=raganwald001-20&linkCode=as2&camp=1789&creative=9325&creativeASIN=0321349601"><img border="0" src="/uploaded_images/java_concurrency.jpg"></a><img src="http://www.assoc-amazon.com/e/ir?t=raganwald001-20&l=as2&o=1&a=0321349601" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" /><br /><br /><a href="http://www.amazon.com/gp/product/0321349601?ie=UTF8&tag=raganwald001-20&linkCode=as2&camp=1789&creative=9325&creativeASIN=0321349601">Java Concurrency in Practice</a><img src="http://www.assoc-amazon.com/e/ir?t=raganwald001-20&l=as2&o=1&a=0321349601" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" /> is written by the people who actually designed and implemented the concurrency features in Java 5 and 6. If you are writing Java programs for two, four, eight, or more cores and CPUs (and isn&rsquo;t that practically all server-side Java development?), owning and reading this book should be the very next step in your professional development.</em><hr/><br /><br /></div>Of course, most people read <a href="http://weblog.raganwald.com/2007/04/haskell-not-just-for-language-weenies.html" title="Don't have a COW, man? What Haskell teaches us about writing Enterprise-scale software">the post</a> and thought, &#8220;Cool, some neat stuff about concurrency.&#8221; Nothing wrong with that. If you value tips on concurrent programming (and <a href="http://weblog.raganwald.com/2006/09/surfs-up.html" title="raganwald: Surf's Up!">I certainly do</a>), you&#8217;ll find Kevin&#8217;s emails very insightful.<br /><br />And if you are still wondering whether you should look at &#8220;impractical&#8221; and &#8220;academic&#8221; material like Haskell, Erlang, or other things not being promoted by MegloSoft, consider that one of the papers Kevin cites describes a data structure running on a 768 CPU system. Is this in a University lab somewhere? No, it is in a company that promotes itself as an Enterprise-Scale Java company.<br /><br />You simply can&#8217;t assume that everything the industry tells you to learn is everything you need. Or that any one source (Cool! <a href="http://weblog.raganwald.com/" title="raganwald">Raganwald</a> has a new post on <a href="http://weblog.raganwald.com/2007/02/haskell-ruby-and-infinity.html" title="raganwald: Haskell, Ruby and Infinity">Lazy Evaluation</a>) has the definitive answer.<br /><br />You need to commit to <em>life-long learning</em> to be a software developer. Some of that learning is straightforward MSDN Magazine stuff, simple updates to things you already know. And some of that learning is a little further out on the curve.<br /><br />Without further ado, here is one of the most comprehensive technical replies to a post on my blog I&#8217;ve received to date.<br /><br /><strong>Concurrency Considerations</strong><br /><br />Hi Reg,<br /><br />I was just reading your article on concurrent collections and have a few comments:<br /><br /><ol><li>Just because readers do not update the structure doesn’t mean that they don’t need to synchronize.  This belief is a common source of concurrency bugs on multi-processor systems.<br /><br />Unless you synchronize on the root of your data-structure (or declare it as volatile), you can’t be sure that your cache doesn’t have a stale version of the data (which may have been updated by another processor).  You don’t need to synchronize for the entire life of the method, as you would by declaring the method synchronized, but you still need to synchronize on the memory access.  You hold the lock for a shorter period of time, thus allowing for better concurrency, but you still have to sync.<br /><br />If you fail to synchronize your memory (or declare it as volatile), then your code will work correctly on a single CPU machine but will fail when you add more CPU’s (it will work on multi-core machines provided that the cores share the same cache).  If you have a recursive datastructure (like a tree) then you will need to actually synchronize on each level/node, unless of course you use a purely functional data-structure, in which case, you’ll only need to synchronize on the root.<br /><br />Given that you need to make a quick sync anyway, this approach is not much better than just using a ReadWrite-lock (it is slightly better because you can start updating before the readers finish reading (not a big deal for get()’s but potentially a big deal for iterators()), but then again updates are more expensive because of the copying).</li><br /><li>I don’t think that you should be using Haskell as a model of “Enterprise-scale” anything.  “Enterprise-scale software” usually entails “Enterprise-scale hardware” which  means, among other things, multiple-CPU’s.  The problem is that Haskell purely-functional model doesn’t support multiple-CPU’s (it’s true, check the literature (except for specialized pipelined architectures, but not in the general case)).<br /><br />The whole processing “state” is essentially one large purely-functional data-structure.  The problem of synchronizing your data-structure appears to be eliminated, but it has really just been moved up to the top-level “state” structure (monad), where the problem is actually compounded.  This is worse, because not only would you need to lock your structure in order to make an update, but you would in fact need to lock “the whole world”.<br /><br />Some people will advocate launching one process per CPU and then using message passing to communicate between them.  This is just a very inefficient (many orders of magnitude slower) way of pushing the synchronization issue off onto the OS/Network-stack.  (Q: What do multi-core systems mean for the future viability of Haskell?)</li><br /><li>You forgot to mention the common technique of using “striping” to improve concurrency.   Basically,  what you do is create multiple sub-datastructures which each contain only a sub-set of the data.    You can partition the data based on the hash of the key being stored.  You then wrap the whole thing up so that it still has the same interface as the single data-structure.<br /><br />The advantage of this approach is that when you use a ReadWrite lock you only need to lock a small portion of the data-structure, rather than the whole thing.   This allows multiple updates to be performed in parallel.  This is how Java’s concurrent collections work.  See:  <a href="http://java.sun.com/j2se/1.5.0/docs/api/java/util/concurrent/ConcurrentHashMap.html" title="ConcurrentHashMap (Java 2 Platform SE 5.0)">ConcurrentHashMap</a>: Java creates 16 sub-structures by default but you can increase the number when even more concurrency is required.</li><br /><li>Have a look at <a href="http://www.azulsystems.com/events/javaone_2007/2007_LockFreeHash.pdf">Azul’s non-blocking HashMap implementation</a>.   They can do 1.2 billion hashMap operations per second (with 1% of 12 million/sec of those being updates) on a 768 cpu machine (the standard Java <a href="http://java.sun.com/j2se/1.5.0/docs/api/java/util/concurrent/ConcurrentHashMap.html" title="ConcurrentHashMap (Java 2 Platform SE 5.0)">ConcurrentHashMap</a> still does half a billion ops/sec which isn’t bad either) .  This shows how scalable non-functional methods can be.<br /><br />I’ve never read of any Haskell or other purely-functional implementation being able to scale to anywhere near these numbers.</li></ol><br /><div class="book"><hr/><em><a href="http://www.amazon.com/gp/product/193435600X?ie=UTF8&tag=raganwald001-20&linkCode=as2&camp=1789&creative=9325&creativeASIN=193435600X"><img border="0" src="/uploaded_images/programming_erlang.jpg"></a><img src="http://www.assoc-amazon.com/e/ir?t=raganwald001-20&l=as2&o=1&a=193435600X" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" /><br /><br />There&rsquo;s <strong>another</strong> entire world of concurrency control, the world of independent actors communicating with fault-tolerant protocols. The world of Erlang. You can pre-order the most hotly anticipated book on the subject, <a href="http://www.amazon.com/gp/product/193435600X?ie=UTF8&tag=raganwald001-20&linkCode=as2&camp=1789&creative=9325&creativeASIN=193435600X">Programming Erlang: Software for a Concurrent World</a><img src="http://www.assoc-amazon.com/e/ir?t=raganwald001-20&l=as2&o=1&a=193435600X" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />, the definitive reference from the language's creator, Joe Armstrong.</em><hr/><br /><br /></div>Summary: <em>Using a purely-functional data-structure does make it easier to support multiple readers, but you still need to sync briefly at the “top” of the structure.  Striping has the added advantage of also supporting multiple-writers as well, and in practice, this is a much bigger win.  Haskell is inherently limited to a single CPU, which doesn’t  match modern hardware; especially of the “enterprise” class.  Shared-memory models of concurrency have demonstrated much better performance than purely-functional models.</em>  <br /><br />Best Regards,<br /><br />Kevin Greer<br /><br />p.s. I've actually implemented a b-tree structure for very large data-sets and chose to use a purely-functional data-structure myself.  My reason for doing so was that I have some very long-running read operations (~8 hours) and I obviously can't afford a ReadWrite lock that's going to starve writer threads for that long.<br /><br />Another nice advantage of using purely-functional data-structures is that they make it easy to implement temporal-databases that let you perform time-dependent queries.<br /><br />I just wanted to point out that if all you have is quick-reads then purely-functional is no different than a simple ReadWrite lock and that a super-pure implementation, as with Haskell, doesn't scale to multiple-CPU's or to highly concurrent updates.  However, it can be used to good effect in combination with striping or other techniques.<br /><br />(A tangential note: Java's GC is getting so good in recent releases that P-F data-structures are becoming much more efficient (given that P-F generates more garbage).)<br /><br />p.p.s. One more advantage of functional data-structures (the largest advantage for me actually):<br /><br />They map well to log(or journal)-based storage.  Functional data-structures never update old data, but instead, just create new versions.  If your data-structure uses disk-based storage then this means that you never need to go back and overwrite your file; you only need to append data to the end of the file.  This has two advantages:<br /><br /><ol><li>This works well with the physical characteristics of hard-disks.  They have incredibly high transfer rates (10&#8217;s of Megs/sec) but very slow seek times (~ 200 seeks/sec if 5ms access time).  If you are adding say 1k objects to a data-structure which requires 2 updates on average to a file then you&#8217;re looking at about 100 updates per second.  If on the other-hand you write all of these updates to the end of the file then you&#8217;re looking at say 20,000 updates per second!</li><br /><li>You can&#8217;t corrupt old data with interrupted writes.  The old data is always still there.  The only place that a corruption occur is at the end of the file, in which case you just scan backwards until you find the previous good head of your data-structure.</li></ol><br /><hr/><br /><em>This is fantastic stuff to share, thanks, Kevin!<br /><br />What other tips can readers contribute for people building highly concurrent software (besides the frequent use of JProbe Threadalyzer, of course)? What online resources (papers, articles, books) do readers recommend for the professional developer?</em><div style="clear:both; padding-bottom:0.25em"></div><p class="blogger-labels">Labels: <a rel='tag' href="http://weblog.raganwald.com/labels/java.html">java</a>, <a rel='tag' href="http://weblog.raganwald.com/labels/passion.html">passion</a>, <a rel='tag' href="http://weblog.raganwald.com/labels/popular.html">popular</a></p>&nbsp;
					<span class="PostFooter">

						&para; <a href="http://weblog.raganwald.com/2007/05/hard-core-concurrency-considerations.html" title="permanent link">2:17 PM</a>

					 
				</span> 


                                        <p id="postfeeds"></p>

			</div>

			

		
			
				<div class="DateHeader">Monday, May 07, 2007</div>
			

			<div class="Post"><a name="8982350227311849405">&nbsp;</a>
				<span class="PostTitle">

					<a href="http://weblog.raganwald.com/2007/05/parable-illustrating-importance-of.html" title="permanent link">A parable illustrating the importance of the differences between Scheme and Common Lisp in a world where Java is the Lingua Franca of Programmers</a></span>
					<div style="clear:both;"></div><a href="http://forum.ship-of-fools.com/threads/laugh_judgment/01f.html">An encounter on a bridge</a>.<div style="clear:both; padding-bottom:0.25em"></div><p class="blogger-labels">Labels: <a rel='tag' href="http://weblog.raganwald.com/labels/java.html">java</a>, <a rel='tag' href="http://weblog.raganwald.com/labels/lispy.html">lispy</a></p>&nbsp;
					<span class="PostFooter">

						&para; <a href="http://weblog.raganwald.com/2007/05/parable-illustrating-importance-of.html" title="permanent link">1:13 PM</a>

					 
				</span> 


                                        <p id="postfeeds"></p>

			</div>

			

		
			
				<div class="DateHeader">Wednesday, April 25, 2007</div>
			

			<div class="Post"><a name="7215014502099622853">&nbsp;</a>
				<span class="PostTitle">

					<a href="http://weblog.raganwald.com/2007/04/rails-style-creators-in-java-or-how-i.html" title="permanent link">Rails-style creators in Java, or, how I learned to stop worrying and love anonymous inner classes</a></span>
					<div style="clear:both;"></div>Let&#8217;s begin with a well-known problem: creating a <code>Map</code> that is to be pre-populated with a few values. Here is some na&iuml;ve code that creates a Map and then puts two values into it:<br /><br /><pre class="textmate-source sunburst"><span class="source source_java"><br /><span class="storage storage_modifier storage_modifier_java">final</span> <span class="support support_type support_type_built-ins support_type_built-ins_java">Map</span><span class="keyword keyword_operator keyword_operator_comparison keyword_operator_comparison_java">&lt;</span><span class="support support_type support_type_built-ins support_type_built-ins_java">String</span>, <span class="support support_type support_type_built-ins support_type_built-ins_java">Object</span><span class="keyword <br />keyword_operator keyword_operator_comparison keyword_operator_comparison_java">&gt;</span> mm = <span class="keyword keyword_other keyword_other_class-fns keyword_other_class-fns_java">new</span> <span class="support support_type support_type_built-ins support_type_built-ins_java">HashMap</span><span class="keyword keyword_operator keyword_operator_comparison keyword_operator_comparison_java">&lt;</span><span class="support support_type support_type_built-ins support_type_built-ins_java">String</span>, <span class="support support_type support_type_built-ins support_type_built-ins_java">Object</span><span class="keyword keyword_operator keyword_operator_comparison keyword_operator_comparison_java">&gt;</span>();<br />mm.put(<span class="string string_quoted string_quoted_double string_quoted_double_java"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_java">"</span>foo<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_java">"</span></span>, <span class="string string_quoted string_quoted_double string_quoted_double_java"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_java">"</span>Strive To Finish Up<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_java">"</span></span>);<br />mm.put(<span class="string string_quoted string_quoted_double string_quoted_double_java"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_java">"</span>bar<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_java">"</span></span>, <span class="string string_quoted string_quoted_double string_quoted_double_java"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_java">"</span>Public House<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_java">"</span></span>);<br /><br /></span></pre><br />Although this works, the problem with the na&iuml;ve code is that it does not say with conviction that the two <code>put</code> calls are part of the creation of the <code>Map</code>. If you move code around, it&#8217;s easy to drop a line. This code is <em>literal</em>, but it is not <a href="http://en.wikipedia.org/wiki/Literate_programming">literate</a>. <br /><br />Most Java programmers<sup>1</sup> are familiar with the Map Initializer Idiom:<br /><br /><pre class="textmate-source sunburst"><span class="source source_java"><br /><span class="storage storage_modifier storage_modifier_java">final</span> <span class="support support_type support_type_built-ins support_type_built-ins_java">Map</span><span class="keyword keyword_operator keyword_operator_comparison keyword_operator_comparison_java">&lt;</span><span class="support support_type support_type_built-ins support_type_built-ins_java">String</span>, <span class="support support_type support_type_built-ins support_type_built-ins_java">Object</span><span class="keyword keyword_operator keyword_operator_comparison keyword_operator_comparison_java">&gt;</span> m = <span class="keyword keyword_other keyword_other_class-fns keyword_other_class-fns_java">new</span> <span class="support support_type support_type_built-ins support_type_built-ins_java">HashMap</span><span class="keyword keyword_operator keyword_operator_comparison keyword_operator_comparison_java">&lt;</span><span class="support support_type support_type_built-ins support_type_built-ins_java">String</span>, <span class="support support_type support_type_built-ins support_type_built-ins_java">Object</span><span class="keyword keyword_operator keyword_operator_comparison keyword_operator_comparison_java">&gt;</span>() {{<br />    put(<span class="string string_quoted string_quoted_double string_quoted_double_java"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_java">"</span>bar<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_java">"</span></span>, <span class="string string_quoted string_quoted_double string_quoted_double_java"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_java">"</span>saloon<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_java">"</span></span>);<br />    put(<span class="string string_quoted string_quoted_double string_quoted_double_java"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_java">"</span>bash<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_java">"</span></span>, <span class="constant constant_numeric constant_numeric_java">7</span>);<br />}};<br /><br /></span></pre><br />This creates a new <code>Map</code> and populates it with two members. This is a big improvement. The initialization is clearly embedded in the line of code that creates the Map. Thanks to a small <a href="http://java.sun.com/docs/books/tutorial/java/javaOO/initial.html">syntax hack</a>, it is (by Java standards) concise.<br /><br />If you&rsquo;re into the details, it actually creates a new anonymous inner class that extends <code>HashMap</code>. The inner class doesn&rsquo;t add any new instance members, but it does contain an initializer: code between braces is run when instances are initialized. That&rsquo;s why there are double braces: the outer set delineates the body of the anonymous inner class, the inner set delineates the initializer block.<br /><br />Note that your new Map isn&rsquo;t exactly equal to any HashMap, because it has a different class. That <a href="http://weblog.raganwald.com/2007/04/what-does-barbara-liskov-have-to-say.html">sometimes matters</a>.<br /><br /><strong>POJOs</strong><br /><br />Many Java programmers labour with applications where the original architect wielded the Golden POJO Hammer: absolutely everything in the application looked like a POJO nail. I work with one such code base: it is obviously a traditional Procedural application. Getting anything done involves calling a global procedure and passing in a bunch of arguments.<br /><br />The original architects worked for one of those Global Services companies, and you can&#8217;t charge hundreds of dollars an hour<sup>2</sup> writing programs that our grandparents would recognize from the sixties. So to add a layer of <acronym title="Object Obfuscation">OO</acronym>, they turned every procedure call into a method, so a simple call like:<br /><br /><pre class="textmate-source sunburst"><span class="source source_java"><br /><span class="storage storage_modifier storage_modifier_java">final</span> <span class="support support_type support_type_built-ins support_type_built-ins_java">BigDecimal</span> balance = <span class="storage storage_type storage_type_java">AccountModule</span>.getAccountBalance(<span class="string string_quoted string_quoted_double string_quoted_double_java"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_java">"</span>12345-678<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_java">"</span></span>);<br /><br /></span></pre><br />became:<br /><br /><pre class="textmate-source sunburst"><span class="source source_java"><br /><span class="storage storage_modifier storage_modifier_java">final</span> <span class="storage storage_type storage_type_java">BalanceDoer</span> doer = <span class="keyword keyword_other keyword_other_class-fns keyword_other_class-fns_java">new</span> <span class="storage storage_type storage_type_java">BalanceDoer</span>();<br />doer.setAccountNumber(<span class="string string_quoted string_quoted_double string_quoted_double_java"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_java">"</span>12345-678<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_java">"</span></span>);<br />doer.doit();<br /><span class="storage storage_modifier storage_modifier_java">final</span> <span class="support support_type support_type_built-ins support_type_built-ins_java">BigDecimal</span> balance = doer.getBalance();<br /><br /></span></pre><br />(The nice thing about using this &#8220;OO Style&#8221; is that you get named parameters and multiple return values. I shall leave it to the static type checking enthusiasts to point out the drawbacks of this approach.)<br /><br />Well, we can use the same initializer idiom with POJOs like <code>BalanceDoer</code> (although you may have to move <code>doit()</code> outside of the initializer if you need checked exceptions):<br /><br /><pre class="textmate-source sunburst"><span class="source source_java"><br /><span class="storage storage_modifier storage_modifier_java">final</span> <span class="storage storage_type storage_type_java">BalanceDoer</span> doer = <span class="keyword keyword_other keyword_other_class-fns keyword_other_class-fns_java">new</span> <span class="storage storage_type storage_type_java">BalanceDoer</span>() {{<br />    setAccountNumber(<span class="string string_quoted string_quoted_double string_quoted_double_java"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_java">"</span>12345-678<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_java">"</span></span>);<br />    doit();<br />}};<br /><span class="storage storage_modifier storage_modifier_java">final</span> <span class="support support_type support_type_built-ins support_type_built-ins_java">BigDecimal</span> balance = doer.getBalance();<br /><br /></span></pre><br /><br /><div class="book"><br /><hr/><a name="evtst|a|0262561158" href="http://www.amazon.com/gp/product/0262561158?ie=UTF8&amp;tag=raganwald001-20&amp;link_code=as3&amp;camp=211189&amp;creative=373489&amp;creativeASIN=0262561158"><img src="http://weblog.raganwald.com/uploaded_images/a_little_java-777624.jpg" border="0"></a><img src="http://www.assoc-amazon.com/e/ir?t=raganwald001-20&amp;l=as2&amp;o=1&amp;a=0262561158" alt="" style="border: medium none  ! important; margin: 0px ! important;" border="0" height="1" width="1"><br><br><em><a name="evtst|a|0262561158" href="http://www.amazon.com/gp/product/0262561158?ie=UTF8&amp;tag=raganwald001-20&amp;link_code=as3&amp;camp=211189&amp;creative=373489&amp;creativeASIN=0262561158">A Little Java, a Few Patterns</a> is brought to you by the authors of <a name="evtst|a|0262560992" href="http://www.amazon.com/gp/product/0262560992?ie=UTF8&amp;tag=raganwald001-20&amp;link_code=as3&amp;camp=211189&amp;creative=373489&amp;creativeASIN=0262560992">The Little Schemer</a><img src="http://www.assoc-amazon.com/e/ir?t=raganwald001-20&amp;l=as2&amp;o=1&amp;a=0262560992" alt="" style="border: medium none  ! important; margin: 0px ! important;" border="0" height="1" width="1">, a book that teaches recursion and first-class functions: it is no surprise to discover that their book about Java eschews the same old, same old Hello World approach in favour of teaching deep ideas about Object-Oriented design and Pattern-Oriented design using Java as the language of instruction.<hr></em></div>Again, you get a more literate snippet of code: the initialization and invocation all belong together, and you have put them together. If you move this around, you won&#8217;t drop an important line by mistake. And you get to save some keystrokes if there are a lot of fields to initialize.<br /><br />If you dare to use <code>protected</code> fields in POJOs (this is heresy to the &#8220;lock everything down so that other programmers subclassing your stuff can&#8217;t actually change anything&#8221; zealots), you can even write <code>accountNumber = "12345-678";</code> in the initializer instead of using a setter.<br /><br />I prefer that form, it looks a lot more like what you are trying to say: this field has this value for this <code>doit</code> call. That may be a matter of taste, or I may be overlooking something important.<br /><br />Remember, your new object is an instance of an anonymous inner class, not of the original POJO class. This matters greatly if you test for class membership with <code>equals</code> instead of substitutability with <code>instanceof</code>.<br /><br /><strong>What does this have to do with Rails?</strong><br /><br />This is where we could go off on a long essay about how using things like Lisp, Smalltalk, and Ruby on Rails opens your mind to possibilities. That when you get used to <code>MyModel.create(:foo =&gt; 'Shove That Fish Under')</code>, you look for ways to make your Java code easier, and so forth.<br /><br />But honestly, you knew that already, didn&#8217;t you?<br /><br /><em>Update: <a href="http://weblog.raganwald.com/2007/04/writing-programs-for-people-to-read.html">Writing programs for people to read</a>.</em><br /><div style="clear: both;"></div><hr/><br /><ol><li>Where by &#8220;most,&#8221; I mean those who haven&#8217;t been hiding under the &#8220;Java-programs-must-only-contain-approved&reg;-design-patterns: all-other-idioms-are-considered-hard-to-read-by-mediocre-colleagues&#8221; rock.<br /><br />In my experience, that is the majority of good programmers. If reading blogs convinces you otherwise, remember that many of the best people are too busy building good stuff to write about building good stuff.<br /><br /><em>Update: A commenter expressed some surprise that this is a well-known idiom. Have a look at <a href="http://www.c2.com/cgi/wiki?DoubleBraceInitialization">Double Brace Initialization</a>.</em><br /><br />The other Java people, the ones with time on their hands, or the ones that consider themselves &#8220;too good to program,&#8221; are the ones that write posts explaining why Java programs must be dumbed down to the lowest common denominator. I also blog. Draw your own conclusions from the evidence.</li><br /><li>Not <a href="http://www.kuro5hin.org/story/2005/9/27/95759/4240">this</a> company, although that&#8217;s an amusing post.</li><br /></ol><div style="clear:both; padding-bottom:0.25em"></div><p class="blogger-labels">Labels: <a rel='tag' href="http://weblog.raganwald.com/labels/java.html">java</a></p>&nbsp;
					<span class="PostFooter">

						&para; <a href="http://weblog.raganwald.com/2007/04/rails-style-creators-in-java-or-how-i.html" title="permanent link">10:10 AM</a>

					 
				</span> 


                                        <p id="postfeeds"></p>

			</div>

			

		
			
				<div class="DateHeader">Sunday, April 15, 2007</div>
			

			<div class="Post"><a name="2836775033960947170">&nbsp;</a>
				<span class="PostTitle">

					<a href="http://weblog.raganwald.com/2007/04/what-does-barbara-liskov-have-to-say.html" title="permanent link">What does Barbara Liskov have to say about Equality in Java?</a></span>
					<div style="clear:both;"></div>Erick Reid posted some code showing his <a href="http://erickreid.blogspot.com/2008/06/sourcecode-generation-of-good-equals.html">standard implementations of <code>equals</code> and <code>hashCode</code> in Java</a> (updated link). His implementations draw heavily on Joshua Bloch&#8217;s principles. I think he&rsquo;s done a great job in implementing the Java standard implementation of equality. On the other hand, I&rsquo;m a little disquieted by the way equality works in Java.<br /><br />Here&#8217;s a shorter version of his equality method for a class, <code>TempBean</code>, that has members <code>_foo</code>, and <code>_bar</code>:<br /><pre><code><br />public boolean equals(Object object) {<br />  if (object != this) {<br />    if (object != null && getClass().equals(object.getClass())) {<br />      final TempBean other = (TempBean) object;<br />      return (_foo == null ? other._foo == null : _foo.equals(other._foo)) &&<br />          (_bar == null ? other._bar == null : _bar.equals(other._bar));<br />    }<br />    return false;<br />  }<br />  return true;<br />}<br /></code></pre><br />The interesting part for me is the test for class equality: <code>getClass().equals(object.getClass())</code>. Compare and contrast to:<br /><pre><code><br />public boolean equals(Object object) {<br />  if (object != this) {<br />    if (object != null &amp;&amp; object instanceof TempBean) {<br />      final TempBean other = (TempBean) object;<br />      return (_foo == null ? other._foo == null : _foo.equals(other._foo)) &amp;&amp;<br />          (_bar == null ? other._bar == null : _bar.equals(other._bar));<br />    }<br />    return false;<br />  }<br />  return true;<br />}<br /></code></pre><br />This works when <code>object</code> is a <code>TempBean</code>. That&#8217;s almost the same as the first code. It&#8217;s different when <code>object</code> is an instance of <code>TempBean</code> but not a <code>TempBean</code>.<br /><br />For example:<br /><pre><code><br />void doSomethingSeussian (final TempBean thingOne) {<br />    final TempBean thingTwo = TempBean.getThingFromBox(/* ... */);<br /><br />    if (thingTwo.equals(thingOne)) {<br />        // ...<br />    }<br />}<br /></code></pre><br /><code>thingTwo</code> is obviously a <code>TempBean</code>. Or is it? What does the factory method <code>getThingFromBox</code> do? And what if <code>thingOne</code> is an instance of a <em>subclass</em> of <code>TempBean</code>? What if it has exactly the same <code>_foo</code> and <code>_bar</code> as <code>thingTwo</code>? Why isn&#8217;t it <code>equals</code>? <br /><br />Does this sound farfetched? What if it doesn&#8217;t even have any different members, it only varies in some subtle implementation way? For example, what if <code>thingOne</code> is a <code>ThreadSafeTempBean</code> that guarantees thread safety in a way that is otherwise transparent to clients? Or a <code>MockTempBean</code> that is used for unit tests?<br /><br /><strong>All equalities are equal, but some are more equal than others</strong><br /><br />If you program in Java, you probably already know that <code>==</code> is not the same thing as <code>equals</code>. One measures <em>identity </em>, whether two objects are the exact same identical object in memory at the same location. (Unless they are those dratted primitives, in which case it measures <em>value equality</em>). Identity is almost useless in Java, it breaks all over the place, and that&rsquo;s why it&rsquo;s rightfully rare.<br /><br />Value equality is where the interesting problem lies. There are two kinds of value equalities: physical equality (&ldquo;these two are identical copies of the same object in every respect&rdquo;) and logical equality (&ldquo;for my purposes, these two are equivalent&rdquo;).<br /><br /><div class="book"><a name="evtst|a|0262561158" href="http://www.amazon.com/gp/product/0262561158?ie=UTF8&amp;tag=raganwald001-20&amp;link_code=as3&amp;camp=211189&amp;creative=373489&amp;creativeASIN=0262561158"><img src="http://weblog.raganwald.com/uploaded_images/a_little_java-777624.jpg" border="0"></a><img src="http://www.assoc-amazon.com/e/ir?t=raganwald001-20&amp;l=as2&amp;o=1&amp;a=0262561158" alt="" style="border: medium none  ! important; margin: 0px ! important;" border="0" height="1" width="1"><br /><br /><a name="evtst|a|0262561158" href="http://www.amazon.com/gp/product/0262561158?ie=UTF8&amp;tag=raganwald001-20&amp;link_code=as3&amp;camp=211189&amp;creative=373489&amp;creativeASIN=0262561158">A Little Java, a Few Patterns</a> is brought to you by the authors of <a href="http://www.amazon.com/gp/product/0262560992?ie=UTF8&tag=raganwald001-20&linkCode=as2&camp=1789&creative=9325&creativeASIN=0262560992">The Little Schemer</a><img src="http://www.assoc-amazon.com/e/ir?t=raganwald001-20&l=as2&o=1&a=0262560992" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />, a book that teaches recursion and first-class functions, as well as <a href="http://www.amazon.com/gp/product/026256114X?ie=UTF8&tag=raganwald001-20&linkCode=as2&camp=1789&creative=9325&creativeASIN=026256114X">The Little MLer</a><img src="http://www.assoc-amazon.com/e/ir?t=raganwald001-20&l=as2&o=1&a=026256114X" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />, a book that teaches you how to design programs with a powerful strong, static type system.<br /><br />So it is no surprise to discover that their book about Java eschews the same old, same old Hello World approach in favour of teaching deep ideas about Object-Oriented design and Pattern-Oriented design using Java as the language of instruction.<br /><br /></div>The basic problem here is that <code>equals</code> captures physical equality, which ignores the <a href="http://en.wikipedia.org/wiki/Liskov_substitution_principle" title="Liskov substitution principle">Liskov Substitution Principle</a>, one of the fundamental principles in OO design. It is leaking the implementation, just like a <a href="http://www.joelonsoftware.com/articles/LeakyAbstractions.html" title="The Law of Leaky Abstractions - Joel on Software">leaky abstraction</a>.<br /><br />(I think a lot of the problem starts when people conflate interfaces with classes. There&#8217;s a big difference between saying &#8220;this is the interface TempBean, and here is how to tell if any two TempBeans are equals to each other&#8221; and saying &#8220;this is an implementation of a TempBean, and if you want to know whether it is the exact same thing as another implementation, here is how to do it.&#8221;<br /><br />The former ought to be very common, and the latter quite rare in OO programs.)<br /><br />It isn&#8217;t easy to fix the physical equality problem. If you use the second form of code, you get an equals method that is not <a href="http://en.wikipedia.org/wiki/Symmetric_relation">symmetric</a> (thanks, Marc!). In the examples above, <code>thingOne.eqauls(thingTwo)</code> is not always the same as <code>thingTwo.equals(thingOne)</code>! And if you&rsquo;re implementing a <code>HashMap</code>, which kind of equality do you want to use for deciding whether a key is already in the collection?<br /><br />This last question is another way of pointing out that equality is not an easy thing to define if you mix the notion of polymorphism into a language. Do you always want logical equality? I can easily think of code that would break horribly if you made a <code>HashMap</code> that respected the Liskov Substitution Principle for keys. And I can also think of code where I want a map or set that respects the Liskov substitution principle.<br /><br /><strong>What can we do about this?</strong><br /><br />To make equality adhere to the Liskov Substitution Method in a language like Java, you can&#8217;t make it an object method. One of the other cherished notions in OO design is that every object ought to know everything about its behaviour. But this objects can&#8217;t know how much detail a client wants in making the comparison.<br /><br />The piece of code that ought to know how to compare two <code>TempBeans</code> is the <code>TempBean</code> class (which is also the <code>TempBean</code> interface in Java, but Java doesn&#8217;t allow code in interfaces). We&#8217;re off to a good start, the code for <code>equals</code> is in the TempBean class. But where we went wrong is making it an instance method. What happens if it&#8217;s a <em>static</em> method?<br /><pre><code><br />public static boolean equivalent(TeampBean left, TempBean right) {<br />  if (left != right) {<br />    if (left != null &amp;&amp; right != null) {<br />      return (left._foo == null ? right._foo == null : left._foo.equals(right._foo)) &amp;&amp;<br />          (left._bar == null ? right._bar == null :left. _bar.equals(right._bar));<br />    }<br />    return false;<br />  }<br />  return true;<br />}<br /></code></pre><br />Now you can write code like:<br /><pre><code><br />void doSomethingSeussian (final TempBean thingOne) {<br />    final TempBean thingTwo = TempBean.getThingFromBox(/* ... */);<br /><br />    if (TempBean.equivalent(thingTwo, thingOne)) {<br />        // ...<br />    }<br />}<br /></code></pre><br />Without worrying about whether either variable holds a <code>TempBean</code>, a <code>ThreadSafeTempBean</code>, or a <code>MockTempBean</code>. It&#8217;s true that sometimes you care very deeply about the difference. But most of the time, you probably do not, and using an <code>equals</code> method that does care is wrong.<div style="clear:both; padding-bottom:0.25em"></div><p class="blogger-labels">Labels: <a rel='tag' href="http://weblog.raganwald.com/labels/java.html">java</a></p>&nbsp;
					<span class="PostFooter">

						&para; <a href="http://weblog.raganwald.com/2007/04/what-does-barbara-liskov-have-to-say.html" title="permanent link">9:40 PM</a>

					 
				</span> 


                                        <p id="postfeeds"></p>

			</div>

			

		
			
				<div class="DateHeader">Wednesday, April 04, 2007</div>
			

			<div class="Post"><a name="8511257161778092284">&nbsp;</a>
				<span class="PostTitle">

					<a href="http://weblog.raganwald.com/2007/04/haskell-not-just-for-language-weenies.html" title="permanent link">Don't have a COW, man? What Haskell teaches us about writing Enterprise-scale software</a></span>
					<div style="clear:both;"></div><a href="http://factorlang-fornovices.blogspot.com/">Berlin Brown</a> asked:<br /><blockquote>I read programming.reddit religiously but I rarely see something that could be used in a non-startup environment.  Am I wrong, or are you considering deploying a haskell enterprise web application?  And if the stuff discussed isn&#8217;t relevant for the next 5 years (i.e. an erlang based webapp) will it ever be relevant?<br /></blockquote><br />Yes, I use what I read on <a href="http://programming.reddit.com/" title="reddit.com: programming - what&#39;s new online">programming.reddit.com</a> in my day job. That&#8217;s one of the reasons I <em>have</em> this day job: it&#8217;s part of what I do to sift through all of the cool stuff and find the things that are practical today.<br /><br />Since you mentioned <a href="http://www.haskell.org/" title="HaskellWiki">Haskell</a>:<br /><br />Consider a multi-threaded application with shared memory, like a really big web server that has some big shared collection of things in memory. From time to time you add things to the big collection, from time to time you remove them.<br /><br /><strong>Pessimism and coarse-grained locking</strong><br /><br />One way to arbitrate multiple threads is to have one copy of the collection with strict locking protocols that apply to its coarse-grained operations like <code>add</code>, <code>remove</code>, and <code>fetch</code>.<br /><br />In a language like Java, you can <code>synchonize</code> those methods and you&#8217;re done. You have just implemented <em>mutex locking</em>: only one thread can use the collection at a time. If one thread is fetching something from the collection, all other threads must wait, even if all they want to do is fetch things as well.<br /><br />That sucks <a href="http://rot13.com?text=tbng%20qvpx">tbng qvpx</a>, especially if you do lots of reading: why should thread <code>546</code> have to wait to fetch something just because thread <code>532</code> is currently fetching something?<sup>1</sup><br /><br /><strong>Read and write locks</strong><br /><br />The next improvement is to have two kinds of locks: <em>read locks</em> and <em>write locks</em>. Two or more threads can lock the collection for reading, but if any thread locks the collection for writing, all of the other threads have to wait until it is done.<br /><br />This works for about 17 clock ticks, and then you fix the bug by adding a new rule: if a thread wants a write lock but one or more threads have read locks, it has to wait, but any other threads that want read locks can&#8217;t have them. Even though the only threads with locks have read locks, they still have to wait.<br /><br />The thread waiting to write gets a kind of pending write lock that blocks all other threads from taking out new locks. And then you fix the next bug by saying that all threads waiting wait in a priority queue so that the read threads aren&#8217;t starved by write threads and the write threads aren&#8217;t starved by read threads.<br /><br /><div class="book"><a href="http://www.amazon.com/gp/product/0521663504?ie=UTF8&amp;tag=raganwald001-20&amp;linkCode=as2&amp;camp=1789&amp;creative=9325&amp;creativeASIN=0521663504"><img border="0" src="http://weblog.raganwald.com/uploaded_images/purely_functional_data_structures.jpg"></a><img src="http://www.assoc-amazon.com/e/ir?t=raganwald001-20&amp;l=as2&amp;o=1&amp;a=0521663504" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" /><br /><br /><a href="http://www.amazon.com/gp/product/0521663504?ie=UTF8&amp;tag=raganwald001-20&amp;linkCode=as2&amp;camp=1789&amp;creative=9325&amp;creativeASIN=0521663504">Purely Functional Data Structures</a><img src="http://www.assoc-amazon.com/e/ir?t=raganwald001-20&amp;l=as2&amp;o=1&amp;a=0521663504" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" /> takes you step by step through the design and implementation of copy on write collections. These collections <em>can</em> be used in purely functional languages, but they are just as useful in multi-paradigm languages like Java, Ruby, or Python handling multiple threads and performance optimization. The author&#8217;s <a href="http://www.cs.cmu.edu/~rwh/theses/okasaki.pdf" title="Purely Functional Data Structures">thesis</a> is available on line for free.<br /><br /></div>You now have a system that is pretty fast a long as you don&#8217;t write things very often. For example, you could build a fairly nice cache using read-write locking provided it is tuned so that you get lots of hits and only rarely have to drop things from the cache or add things to the cache. But if you&#8217;re doing something like maintaining a big index in memory where you have to make lots of updates, the writes will slow everything down.<br /><br />These kinds of locking protocols are called <em>pessimistic</em> protocols: you assume bad things will happen and prevent them from happening up front by blocking threads from executing until it is safe to proceed.<br /><br /><strong>Multi-version concurrency control</strong><br /><br />Another way to arbitrate multiple threads is to make copies of the collection whenever you perform an update.<sup>2</sup> You maintain multiple <em>versions</em> of the collection. When a thread needs the collection, it grabs the latest copy. When it wants to <code>remove</code> or <code>add</code> elements, it writes a new copy without disturbing an existing copy.<br /><br />This works really well in that threads that only want to read are never blocked. They always run at full speed, even if another thread is in the middle of an update. Hand-waving over how you figure out the whole &#8220;latest copy&#8221; thing, this scheme doesn&#8217;t work so well for threads that write.<br /><br />The problem is one of <em>serialization</em>: this word means, if some set of operations takes place on the collection, the result must be the same as if the operations were conducted one at a time on the collection. There is no guarantee of the <em>order</em> of the operations, just that the result is the same as if they had been carried out in some order.<br /><br />Let&#8217;s use an example. Say our collection is a Map. It starts empty:<br /><br /><pre><code>{ }<br /></code></pre><br /><br />Operation <code>A</code> adds an element:<br /><br /><pre><code>{...a: "A"...}<br /></code></pre><br /><br />As does operation <code>B</code>:<br /><br /><pre><code>{...b: "B"...}<br /></code></pre><br /><br />And operation <code>C</code>:<br /><br /><pre><code>{...c: "C"...}<br /></code></pre><br /><br />If we start with an empty hash and perform all three operations, the result should be <code>{ a: "A", b: "B", c: "C" }</code>, exactly the same result as if each operation were performed serially, one after the other. But what happens if each operation is performed by a thread that grabs the initial copy, <code>{}</code> and writes its result back to the collection? Something called a <em>race condition</em>: the result will be <code>{ a: "A" }</code>, <code>{ b: "B" }</code>, or <code>{ c: "C" }</code>, with the &#8220;winner&#8221; being the last one to write its result.<br /><br />We can fix this problem in a couple of ways. One way is to keep the versions so that reading threads work at full speed, but use mutexes for write locks so that only one thread can write at a time. That&rsquo;s simple, and if you can figure out a cheap way to make copies, works pretty well.<br /><br />That&rsquo;s your pessimistic protocol again (threads that write have to wait on other threads that write), but it&rsquo;s a huge win for threads that read.<br /><br />Making this work is tricky. Copying the entire thing is expensive, so you need to do clever tricks where you only copy the things that change and share the things that don&#8217;t change. And you can get a big, big win if you can avoid write conflicts by arbitrating conflict at a finer grain. For example, a <code>HashMap</code> uses a set of linked lists. If two different threads write to different &#8220;buckets,&#8221; you can merge their results rather than rolling one back and starting again.<br /><br /><div class="book"><hr/><br />One of the best books ever written on the subject of implementing fault tolerant concurrency (either on a single system or a distributed network) is <a href="http://www.amazon.com/gp/product/0201107155?ie=UTF8&tag=raganwald001-20&linkCode=as2&camp=1789&creative=9325&creativeASIN=0201107155">Concurrency Control and Recovery in Database Systems</a><img src="http://www.assoc-amazon.com/e/ir?t=raganwald001-20&l=as2&o=1&a=0201107155" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />.<br /><br />Don&rsquo;t be fooled by the word &ldquo;database&rdquo;&mdash;the techniques described are just as useful for implementing distributed algorithms like MapReduce, concurrent data structures like high-performance collections, or for building multi-threaded communication systems based on queues.<br /><br />Like all classics, it&rsquo;s also available <a href="http://research.microsoft.com/users/philbe/ccontrol/">online</a> for free.<br /><br /><hr/> <br /></div>There is a lot of extra overhead for this if a thread wants to write while another thread is reading a version, so it is only a big win if writes are fairly rare. Remember, one of the big wins is that reads <em>never</em> wait on writes because they work with immutable versions of the collection.<br /><br />Depending on how many threads you have, what kinds of operations are most likely, and other factors, this kind of system can be orders of magnitude faster than coarse-grained pessimistic locking.<br /><br />Sometimes you want a slightly different protocol. The aforementioned is often called <em>single write, many reads.</em> It requires threads that plan on writing to know in advance they need to write. But for something like a cache, you don&#8217;t know you need to write until you miss the cache. And then it&#8217;s too late to get a write lock.<br /><br /><strong>Optimism and many writes, many reads</strong><br /><br />The easiest way to avoid having to pre-declare whether a thread is a reader or a writer is by letting all of the threads do as they please. They all get the latest version and chug happily along.<br /><br />When they are finished, if they never executed an <code>add</code> or <code>remove</code> we let go of the copy of the collection and we&#8217;re done. If a thread wants to write, it makes a copy as above and writes to its copy. But it doesn&rsquo;t have to grab a lock while it is writing, so writes don&rsquo;t wait on other writes.<br /><br />Now, if a thread <em>has</em> executed a write (an <code>add</code> or <code>remove</code>), when it is done we check the result to see if it violates serializability.<br /><br />For example, we can number our versions. Let&#8217;s say that <code>{}</code> is version <code>0</code>. The first thread to finish, let&#8217;s say it&#8217;s the thread performing operation <code>B</code>, creates its result: <code>{ b: "B" }</code>. Now it checks the collection to see if anyone has updated it since <code>B</code> read the collection. The collection is still at version <code>0</code>, so <code>B</code> can write its result. <code>B</code> writes <code>{ b: "B" }</code> to the collection and calls it version <code>1</code>.<br /><br />Next <code>A</code> finishes and notices that the collection is at version <code>1</code>. This is a problem, because <code>A</code> is working with an updated version <code>0</code>, so it has to throw out its work, fetch version <code>1</code>, and try again. This is exactly the same thing as using a source code control system like <a href="http://subversion.tigris.org/" title="subversion.tigris.org">Subversion</a> to resolve conflicts.<br /><br />This many reads, many writes strategy is called an <em>optimistic protocol</em> because you do work in the hope that nothing will cause you to throw it out and try again. It&rsquo;s a big win if writes do happen at the same time, but they rarely conflict.<br /><br />For example, if you have a good strategy for <em>merging</em> writes, this is huge.<br /><br /><strong>So what?</strong><br /><br />Well, it would be great if you didn&#8217;t have to reinvent the wheel and have to work out all of the implications when you want to make a really fast shared collection in a multi-threaded environment. What you want is someone to share a wealth of experience about how to make really fast copies of things by only changing the little bits that you change instead of the whole thing, and so forth.<br /><br /><blockquote>I like languages which say, &ldquo;No, you don't want to write it the way you&rsquo;re thinking. There&rsquo;s a vastly better way to solve this whole class of problems.&rdquo; Me: <em>brain explodes</em></blockquote><br /><div style="text-align: right">&mdash;<a href="http://www.randomhacks.net/">Eric M. Kidd</a></div><br /><br />Where do you go for that kind of information? How about to people who spend all day thinking about collections that cannot change because their programming languages are purely functional?<br /><br />Yes, what I&#8217;ve just described is <em>exactly</em> how languages like Haskell implement mutable collections like dictionaries and lists. In purely functional languages, collections never change. Adding something to a collection is really creating a new collection with an extra element. This is the exact same implementation that we need for building optimistically locked collections in a multi-threaded environment!<br /><br />Haskell teaches us extremely useful techniques for writing Enterprise-scale software.<br /><br /><em>And more techniques: <a href="http://weblog.raganwald.com/2007/05/hard-core-concurrency-considerations.html">Hard-core concurrency considerations</a></em><br /><br /><hr /><br /><ol><li>Now, you might be saying, &#8220;what a waste, this is like locking a table in a database when we should be locking <em>rows</em>.&#8221; But if you look at the database closely, it does lock the table when you perform certain actions like deleting a row. Or it does something more complicated, and now that you&rsquo;ve read the entire post, you know what it really does.</li><br /><li>Making Copies on Writes is called <em>copy on write semantics</em>, or COW for short. Chew on that for a while.</ol><div style="clear:both; padding-bottom:0.25em"></div><p class="blogger-labels">Labels: <a rel='tag' href="http://weblog.raganwald.com/labels/java.html">java</a>, <a rel='tag' href="http://weblog.raganwald.com/labels/lispy.html">lispy</a>, <a rel='tag' href="http://weblog.raganwald.com/labels/popular.html">popular</a></p>&nbsp;
					<span class="PostFooter">

						&para; <a href="http://weblog.raganwald.com/2007/04/haskell-not-just-for-language-weenies.html" title="permanent link">10:38 PM</a>

					 
				</span> 


                                        <p id="postfeeds"></p>

			</div>

			

		
			
				<div class="DateHeader">Sunday, March 11, 2007</div>
			

			<div class="Post"><a name="1990194990621630996">&nbsp;</a>
				<span class="PostTitle">

					<a href="http://weblog.raganwald.com/2007/03/why-why-functional-programming-matters.html" title="permanent link">Why Why Functional Programming Matters Matters</a></span>
					<div style="clear:both;"></div>I recently re-read the amazing paper <a href="http://www.math.chalmers.se/~rjmh/Papers/whyfp.html">Why Functional Programming Matters</a> (&#8220;WhyFP&#8221;). Although I thought that I understood WhyFP when I first read it a few years ago, when I had another look last weekend I suddenly understood that I had missed an important message.<sup>1</sup><br /><br />Now obviously (can you guess from the title?) the paper is about the importance of one particular style of programming, functional programming. And when I first read the paper, I took it at face value: I thought, &#8220;Here are some reasons why functional programming languages matter.&#8221;<br /><br />On re-reading it, I see that the paper contains insights that apply to programming in general. I don&#8217;t know why this surprises me. The fact is, programming language design revolves around program design. A language&#8217;s design reflects the opinions of its creators about the proper design of programs.<br /><br />In a very real sense, the design of a programming language is a strong expression of the opinions of the designer about good programs. When I first read WhyFP, I thought the author was expressing an opinion about the design of good programming languages. Whereas on the second reading, I realized he was expressing an opinion about the design of good programs.<br /><br /><strong>Can we add though subtraction?</strong><br /><br /><blockquote>It is a logical impossibility to make a language more powerful by omitting features, no matter how bad they may be.</blockquote><br />Is this obvious? So how do we explain that one reason Java is considered &#8220;better than C++&#8221; is because it omits manual memory management? And one reason many people consider Java &#8220;better than Ruby&#8221; is because you cannot open base classes like <code>String</code> in Java? So no, it is not obvious. Why not?<br /><br />The key is the word <em>better</em>. It&#8217;s not the same as the phrase <em>more powerful</em>.<sup>2</sup> The removal or deliberate omission of these features is an expression about the idea that programs which do not use these features are better than programs which do. Any feature (or removal of a feature) which makes the programs written in the language better makes the language better. Thus, it <em>is</em> possible to make a language &#8220;better&#8221; by removing features that are considered harmful,<sup>3</sup> if by doing so it makes programs in the language better programs.<br /><br />In the opinion of the designers of Java, programs that do not use <code>malloc</code> and <code>free</code> are safer than those that do. And the opinion of the designers of Java is that programs that do not modify base classes like <code>String</code> are safer than those that do. The Java language design emphasizes a certain kind of safety, and to a Java language designer, safer programs are better programs.<br /><br />&#8220;More powerful&#8221; is a design goal just like &#8220;safer.&#8221; But yet, what does it mean? We understand what a safer language is. It&#8217;s a language where programs written in the language are safer. But what is a &#8220;more powerful&#8221; language? That programs written in the language are more powerful? What does that mean? Fewer symbols (the &#8220;golf&#8221; metric)?<br /><br />WhyFP asserts that you cannot make a language more powerful through the removal of features. To paraphrase an argument from the paper, <em>if removing harmful features was useful by itself, C and C++ programmers would simply have stopped using</em> <code>malloc</code> <em>and</em> <code>free</code> <em>twenty years ago</em>. Improving on C/C++ was not just a matter of removing <code>malloc</code> and <code>free</code>, it was also a matter of adding automatic garbage collection.<br /><br /><blockquote>This space, wherein the essay ought to argue that Java compensates for its closed base classes by providing a more powerful substitute feature, left intentionally blank.</blockquote><br />At the same time, there is room for arguing that some languages are improved by the removal of harmful features. To understand why they may be improved but not more powerful, we need a more objective definition of what it means for a language to be &#8220;more powerful.&#8221; Specifically, what quality does a more powerful programming language permit or encourage in programs?<br /><br />When we understand what makes a program &#8220;better&#8221; in the mind of a language designer, we can understand the choices behind the language.<br /><br /><strong>Factoring</strong><br /><br />Factoring a program is the act of dividing it into units that are composed to produce the working software.<sup>4</sup> Factoring happens as part of the design. (<em>Re</em>-factoring is the act of rearranging an existing program to be factored in a different way). If you want to compare this to factoring in number theory, a well designed program has lots of factors, like the number <code>3,628,800</code> (<code>10!</code>). A <a href="http://www.laputan.org/mud/">Big Ball of Mud</a> is like the number <code>3,628,811</code>, a prime.<br /><br />Composition is the construction of programs from smaller programs. So factoring is to composition as division is to multiplication.<br /><br />Factoring programs isn&#8217;t really like factoring simple divisors. The most important reason is that programs can be factored in orthogonal ways. When you break a program into subprograms (using methods, subroutines, functions, what-have-you), that&#8217;s one axis of factoring. When you break an a modular program up into modules, that&#8217;s another, orthogonal axis of factoring.<br /><br />Programs that are well-factored are more desirable than programs that are poorly factored.<br /><br /><blockquote>In computer science, <strong>separation of concerns</strong> (SoC) is the process of breaking a program into distinct features that overlap in functionality as little as possible. A concern is any piece of interest or focus in a program.<br />  <br />  SoC is a long standing idea that simply means a large problem is easier to manage if it can be broken down into pieces; particularly so if the solutions to the sub-problems can be combined to form a solution to the large problem.<br />  <br />  The term separation of concerns was probably coined by Edsger W. Dijkstra in his paper <a href="http://www.cs.utexas.edu/users/EWD/transcriptions/EWD04xx/EWD447.html">On the role of scientific thought</a>.</blockquote><br />&#8212;Excerpts from the Wikipedia entry on <a href="http://en.wikipedia.org/wiki/Separation_of_concerns">Separation of Concerns</a><br /><br />Programs that separate their concerns are well-factored. There&#8217;s a principle of software development, <a href="http://www.amazon.com/gp/product/0201379430?ie=UTF8&amp;tag=raganwald001-20&amp;linkCode=as2&amp;camp=211189&amp;creative=374929&amp;creativeASIN=0201379430" title="Object Design: Roles, Responsibilities, and Collaborations">responsibility-driven design</a>. Each component should have one clear responsibility, and it should have everything it needs to carry out its responsibility.<br /><br />This is the separation of concerns again. Each component of a program having one clearly defined responsibility means each concern is addressed in one clearly defined place.<br /><br /><blockquote>Let’s ask a question about Monopoly (and Enterprise software). Where do the rules live? In a noun-oriented design, the rules are smooshed and smeared across the design, because every single object is responsible for knowing everything about everything that it can ‘do’. All the verbs are glued to the nouns as methods.</blockquote><div>&#8212;<a href="http://weblog.raganwald.com/2006/06/my-favourite-interview-question.html">My favourite interview question</a></div><br /><br />In a game design where you have important information about a rule smeared all over the object hierarchy, you have very poor separation of concerns. It looks at first like there&#8217;s a clear factoring &#8220;Baltic Avenue has a method called <code>isUpgradableToHotel</code>,&#8221; but when you look more closely you realize that every object representing a property is burdened with knowing almost all of the rules of the game.<br /><br /><div class="book"><a href="http://www.amazon.com/gp/product/026256100X?ie=UTF8&tag=raganwald001-20&linkCode=as2&camp=1789&creative=9325&creativeASIN=026256100X"><img border="0" src="http://weblog.raganwald.com/uploaded_images/seasoned_schemer.jpg"></a><img src="http://www.assoc-amazon.com/e/ir?t=raganwald001-20&l=as2&o=1&a=026256100X" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" /><br /><br /><a href="http://www.amazon.com/gp/product/026256100X?ie=UTF8&tag=raganwald001-20&linkCode=as2&camp=1789&creative=9325&creativeASIN=026256100X">The Seasoned Schemer</a><img src="http://www.assoc-amazon.com/e/ir?t=raganwald001-20&l=as2&o=1&a=026256100X" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" /> is devoted to the myriad uses of first class functions. This book is approachable and a delight to read, but the ideas are provocative and when you close the back cover you will be able to compose programs from functions in powerful new ways.<br><br></div>The concerns are not clearly separated: there&#8217;s no one place to look and understand the behaviour of the game.<br /><br />Programs that separate their concerns are better programs than those that do not. And languages that facilitate this kind of program design are better than those that hamper it.<br /><br /><strong>Power through features that separate concerns</strong><br /><br />One thing that makes a programming language &#8220;more powerful&#8221; in my opinion is the provision of more ways to factor programs. Or if you prefer, <em>more axes of composition</em>. The more different ways you can compose programs out of subprograms, the more powerful a language is. <br /><br />Do you remember <a href="http://en.wikipedia.org/wiki/Structured_programming">Structured Programming</a>? The gist is, you remove <code>goto</code> and you replace it with well-defined control flow mechanisms: some form of subroutine call and return, some form of selection mechanism like Algol-descendant <code>if</code>, and some form of repetition like Common Lisp&#8217;s <code>loop</code> macro.<br /><br />Dijkstra&#8217;s view on structured programming was that it promoted the separation of concerns. The factoring of programs into blocks with well-defined control flow made it easy to understand blocks and rearrange programs in different ways. Programs with indiscriminate jumps did not factor well (if at all): they were difficult to understand and often could not be rearranged at all.<br /><br />Structured <a href="http://dmoz.org/Computers/Programming/Languages/Assembly/68k/">68k ASM</a> programming is straightforward in theory. You just need a lot of boilerplate, design patterns, and the discipline to stick to your convictions. But of course, lots of 68k ASM programming in practice is only partially structured. Statistically speaking, 68k ASM is not a structured programming language even though structured programming is possible in 68k ASM.<br /><br />Structured Pascal programming is straightforward both in theory and in practice. Pascal facilitates separation of concerns through structured programming. So we say that Pascal &#8220;is more powerful than 68k ASM&#8221; to mean that in practice, programs written in Pascal are more structured than programs written in 68k ASM because Pascal provides facilities for separating concerns that are missing in 68k ASM.<br /><br /><strong>For example: working with lists</strong><br /><br />Consider this snippet of iterative code:<br /><br /><pre class="textmate-source sunburst"><br /><span class="source source_java"><span class="storage storage_type storage_type_java">int</span> numberOfOldTimers = <span class="constant constant_numeric constant_numeric_java">0</span>;<br /><span class="meta meta_definition meta_definition_constructor meta_definition_constructor_java"><span class="entity entity_name entity_name_function entity_name_function_constructor entity_name_function_constructor_java">for</span> <span class="meta meta_definition meta_definition_param-list meta_definition_param-list_java">(<span class="storage storage_type storage_type_java">Employee</span> emp: employeeList</span>) </span>{<br /><span class="meta meta_definition meta_definition_constructor meta_definition_constructor_java">    <span class="entity entity_name entity_name_function entity_name_function_constructor entity_name_function_constructor_java">for</span> <span class="meta meta_definition meta_definition_param-list meta_definition_param-list_java">(<span class="storage storage_type storage_type_java">Department</span> dept: departmentsInCompany</span>) </span>{<br />        <span class="keyword keyword_control keyword_control_java">if</span> (emp.getDepartmentId() <span class="keyword keyword_operator keyword_operator_comparison keyword_operator_comparison_java">==</span> dept.getId() <span class="keyword keyword_operator keyword_operator_logical keyword_operator_logical_java">&amp;&amp;</span> emp.getYearsOfService() <span class="keyword keyword_operator keyword_operator_comparison keyword_operator_comparison_java">&gt;</span> dept.getAge()) {<br />            <span class="keyword keyword_operator keyword_operator_increment-decrement keyword_operator_increment-decrement_java">++</span>numberOfOldTimers;<br />        }<br />    }<br />}<br /></span><br /></pre><br />This is an improvement on older practices.<sup>5, 6</sup> For one thing, the <code>for</code> loops hide the implementation details of iterating over <code>employeeList</code> and <code>departmentsInCompany</code>. Is this better because you have less to type? Yes. Is it better because you eliminate the fence-post errors associated with loop variables? Of course.<br /><br />But most interestingly, you have the beginnings of a <em>separation of concerns</em>: how to iterate over a single list is separate from what you do in the iteration.<br /><br /><blockquote>Try calling a colleague on the telephone and explaining what we want as succinctly as possible. Do you say &#8220;We want a loop inside a loop and inside of that an if, and&#8230;&#8221;? Or do you say &#8220;We want to count the number of employees that have been with the company longer than their departments have existed.&#8221;</blockquote><br />One problem with the <code>for</code> loop is that it can only handle one loop at a time. We have to nest loops to work with two lists at once. This is patently wrong: there&#8217;s nothing inherently nested about what we&#8217;re trying to do. We can demonstrate this easily: try calling a colleague on the telephone and explaining what we want as succinctly as possible. Do you say &#8220;We want a loop inside a loop and inside of that an if, and&#8230;&#8221;?<br /><br />No, we say, &#8220;We want to count the number of employees that have been with the company longer than their departments have existed.&#8221; There&#8217;s no discussion of nesting.<br /><br />In this case, a limitation of our tool has caused our concerns to intermingle again. The concern of &#8220;How to find the employees that have been with the company longer than their departments have existed&#8221; is intertwined with the concern of &#8220;count them.&#8221; Let&#8217;s try a different notation that separates the details of <em>how to find</em> from the detail of <em>counting what we&#8217;ve found</em>:<br /><br /><pre class="textmate-source sunburst"><br /><span class="source source_ruby">old_timers = (employees * departments).select <span class="keyword keyword_control keyword_control_ruby keyword_control_ruby_start-block">do </span>|emp, dept|<br />  emp.department_id == dept.id &amp;&amp; emp.years_of_service &gt; dept.age<br /><span class="keyword keyword_control keyword_control_ruby">end</span><br />number_of_old_timers = old_timers.size<br /></span><br /></pre><br />Now we have separated the concern of finding from counting. And we have hidden the nesting by using the <code>*</code> operator to create a Cartesian product of the two lists. Now let&#8217;s look at what we used to filter the combined list, <code>select</code>. The difference is more than just semantics, or counting characters, or the alleged pleasure of fooling around with closures.<br /><br /><div class="book"><br>  <a name="evtst|a|0521644089" href="http://www.amazon.com/gp/product/0521644089?ie=UTF8&amp;tag=raganwald001-20&amp;link_code=as3&amp;amp;camp=211189&amp;creative=373489&amp;creativeASIN=0521644089"><img src="http://weblog.raganwald.com/uploaded_images/haskell_school_of_expression.jpg" border="0"></a><img src="http://www.assoc-amazon.com/e/ir?t=raganwald001-20&amp;l=as2&amp;amp;amp;o=1&amp;a=0521644089" alt="" style="border: medium none  ! important; margin: 0px ! important;" border="0" height="1" width="1"><br>I’m not a Haskell user (yet), but <a name="evtst|a|0521644089" href="http://www.amazon.com/gp/product/0521644089?ie=UTF8&amp;tag=raganwald001-20&amp;link_code=as3&amp;amp;camp=211189&amp;creative=373489&amp;creativeASIN=0521644089">The Haskell School of Expression: Learning Functional Programming through Multimedia</a><img src="http://www.assoc-amazon.com/e/ir?t=raganwald001-20&amp;l=as2&amp;amp;amp;o=1&amp;a=0521644089" alt="" style="border: medium none  ! important; margin: 0px ! important;" border="0" height="1" width="1"> has received rave reviews and comes with solid recommendations. It’s on my <a href="http://www.amazon.com/gp/registry/wishlist/3A2XEHODQK2WP/ref=wl_web/">wish list</a> if you’re feeling generous!<br><br></div><code>*</code> and <code>select</code> facilitates separating the concerns of how to filter things (like iterate over them applying a test) from the concern of what we want to filter. So languages that make this easy are more powerful than languages that do not. In the sense that they facilitate additional axes of factoring.<br /><br /><strong>The Telephone Test</strong><br /><br />Let&#8217;s look back a few paragraphs. We have an example of the &#8220;Telephone Test:&#8221; when code very closely resembles how you would explain your solution over the telephone, we often say it is &#8220;very high level.&#8221; The usual case is that such code expresses a lot more <em>what</em> and a lot less <em>how</em>. The concern of what has been very clearly separated from the concern of how: you can&#8217;t even <em>see</em> the how if you don&#8217;t go looking for it.<br /><br />In general, we think this is a good thing. But it isn&#8217;t free: somewhere else there is a mass of code that supports your brevity. When that extra mass of code is built into the programming language, or is baked into the standard libraries, it is nearly free and obviously a Very Good Thing. A language that doesn&#8217;t just separate the concern of how but does the work for you is very close to &#8220;something for nothing&#8221; in programming.<br /><br />But sometimes you have to write the <em>how</em> as well as the <em>what</em>. It isn&#8217;t always handed to you. In that case, it is still valuable, because the resulting program still separates concerns. It still factors into separate components. The components can be changed.<br /><br />I recently separated the concern of describing &#8220;how to generate sample curves for some data mining&#8221; from the concern of &#8220;managing memory when generating the curves.&#8221; I did so by writing my own lazy evaluation code (Both the <a href="http://weblog.raganwald.com/2007/02/haskell-ruby-and-infinity.html">story</a> and the <a href="http://raganwald.com/source/lazy_lists.html">code</a> are on line). Here&#8217;s the key &#8220;what&#8221; code that generates an infinite list of parameters for sample bezi&eacute;r curves:<br /><br /><pre class="textmate-source sunburst"><br /><span class="source source_ruby"><span class="meta meta_function meta_function_method meta_function_method_without-arguments meta_function_method_without-arguments_ruby"><span class="keyword keyword_control keyword_control_def keyword_control_def_ruby">def</span> <span class="entity entity_name entity_name_function entity_name_function_ruby">magnitudes</span></span><br />  <span class="support support_class support_class_ruby">LazyList</span>.binary_search(<span class="constant constant_numeric constant_numeric_ruby">0.0</span>, <span class="constant constant_numeric constant_numeric_ruby">1.0</span>)<br /><span class="keyword keyword_control keyword_control_ruby">end</span><br /><br /><span class="meta meta_function meta_function_method meta_function_method_without-arguments meta_function_method_without-arguments_ruby"><span class="keyword keyword_control keyword_control_def keyword_control_def_ruby">def</span> <span class="entity entity_name entity_name_function entity_name_function_ruby">control_points</span></span><br />  <span class="support support_class support_class_ruby">LazyList</span>.cartesian_product(magnitudes, magnitudes) <span class="keyword keyword_control keyword_control_ruby keyword_control_ruby_start-block">do </span>|x, y|<br />    <span class="support support_class support_class_ruby">Dictionary</span>.<span class="keyword keyword_other keyword_other_special-method keyword_other_special-method_ruby">new</span>( <span class="constant constant_other constant_other_symbol constant_other_symbol_ruby"><span class="punctuation punctuation_definition punctuation_definition_constant punctuation_definition_constant_ruby">:</span>x</span> =&gt; x, <span class="constant constant_other constant_other_symbol constant_other_symbol_ruby"><span class="punctuation punctuation_definition punctuation_definition_constant punctuation_definition_constant_ruby">:</span>y</span> =&gt; y )<br />  <span class="keyword keyword_control keyword_control_ruby">end</span><br /><span class="keyword keyword_control keyword_control_ruby">end</span><br /><br /><span class="meta meta_function meta_function_method meta_function_method_without-arguments meta_function_method_without-arguments_ruby"><span class="keyword keyword_control keyword_control_def keyword_control_def_ruby">def</span> <span class="entity entity_name entity_name_function entity_name_function_ruby">order_one_flows</span></span> args = {}<br />  height, width = (args[<span class="constant constant_other constant_other_symbol constant_other_symbol_ruby"><span class="punctuation punctuation_definition punctuation_definition_constant punctuation_definition_constant_ruby">:</span>height</span>] || <span class="constant constant_numeric constant_numeric_ruby">100.0</span>), (args[<span class="constant constant_other constant_other_symbol constant_other_symbol_ruby"><span class="punctuation punctuation_definition punctuation_definition_constant punctuation_definition_constant_ruby">:</span>width</span>] || <span class="constant constant_numeric constant_numeric_ruby">100.0</span>)<br />  <span class="support support_class support_class_ruby">LazyList</span>.cartesian_product(<br />      magnitudes, control_points, control_points, magnitudes<br />  ) <span class="keyword keyword_control keyword_control_ruby keyword_control_ruby_start-block">do </span>|initial_y, p1, p2, final_y|<br />    <span class="support support_class support_class_ruby">FlowParams</span>.<span class="keyword keyword_other keyword_other_special-method keyword_other_special-method_ruby">new</span>(<br />      height, width, initial_y * height,<br />      <span class="support support_class support_class_ruby">CubicBezierParams</span>.<span class="keyword keyword_other keyword_other_special-method keyword_other_special-method_ruby">new</span>(<br />        <span class="constant constant_other constant_other_symbol constant_other_symbol_ruby"><span class="punctuation punctuation_definition punctuation_definition_constant punctuation_definition_constant_ruby">:</span>x</span> =&gt; width,          <span class="constant constant_other constant_other_symbol constant_other_symbol_ruby"><span class="punctuation punctuation_definition punctuation_definition_constant punctuation_definition_constant_ruby">:</span>y</span> =&gt; final_y * height,<br />        <span class="constant constant_other constant_other_symbol constant_other_symbol_ruby"><span class="punctuation punctuation_definition punctuation_definition_constant punctuation_definition_constant_ruby">:</span>x1</span> =&gt; p1.x * width,  <span class="constant constant_other constant_other_symbol constant_other_symbol_ruby"><span class="punctuation punctuation_definition punctuation_definition_constant punctuation_definition_constant_ruby">:</span>y1</span> =&gt; p1.y * height,<br />        <span class="constant constant_other constant_other_symbol constant_other_symbol_ruby"><span class="punctuation punctuation_definition punctuation_definition_constant punctuation_definition_constant_ruby">:</span>x2</span> =&gt; p2.x * width,  <span class="constant constant_other constant_other_symbol constant_other_symbol_ruby"><span class="punctuation punctuation_definition punctuation_definition_constant punctuation_definition_constant_ruby">:</span>y2</span> =&gt; p2.y * height<br />      )<br />    )<br />  <span class="keyword keyword_control keyword_control_ruby">end</span><br /><span class="keyword keyword_control keyword_control_ruby">end</span><br /></span><br /></pre><br />That&#8217;s it. Just as I might tell you on the phone: &#8220;Magnitudes&#8221; is a list of numbers between zero and one created by repeatedly dividing the intervals in half, like a binary search. &#8220;Control Points&#8221; is a list of the Cartesian product of magnitudes with itself, with one magnitude assigned to <code>x</code> and the other to <code>y</code>. And so forth.<br /><br />I will not say that the sum of this code and the code that actually implements infinite lists is shorter than imperative code that would intermingle loops and control structures, <a href="http://www.amazon.com/gp/product/B000002J27?ie=UTF8&amp;tag=raganwald001-20&amp;linkCode=as2&amp;camp=1789&amp;creative=9325&amp;creativeASIN=B000002J27" title="A Trick of the Tail by Genesis, Track 2, Entangled">entangling</a><img src="http://www.assoc-amazon.com/e/ir?t=raganwald001-20&amp;l=as2&amp;o=1&amp;a=B000002J27" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" /> <em>what</em> with <em>how</em>. I will say that it separates the concerns of what and how, and it separates them in a different way than <code>select</code> separated the concerns of what and how.<br /><br /><strong>So why does &#8220;Why Functional Programming Matters&#8221; matter again?</strong><br /><br />The great insight is that better programs separate concerns. They are factored more purely, and the factors are naturally along the lines of responsibility (rather than in Jenga piles of <code>abstract</code> <code>virtual</code> <code>base</code> <code>mixin</code> <code>module</code> <code>class</code> <code>proto_</code> <code>extends</code> <code>private</code> <code>implements</code>). Languages that facilitate better separation of concerns are more powerful in practice than those that don&#8217;t.<br /><br />WhyFP illustrates this point beautifully with the same examples I just gave: <a href="http://weblog.raganwald.com/2007/01/closures-and-higher-order-functions.html">first-class functions</a> and <a href="http://weblog.raganwald.com/2007/02/haskell-ruby-and-infinity.html">lazy evaluation</a>, both prominent features of modern functional languages like Haskell.<br /><br />WhyFP&#8217;s value is that it expresses an opinion about what makes programs better. It backs this opinion up with reasons why modern functional programming languages are more powerful than imperative programming languages. But even if you don&#8217;t plan to try functional programming tomorrow, the lessons about better programs are valuable for your work in <em>any</em> language today.<br /><br />That&rsquo;s why <a href="http://www.math.chalmers.se/~rjmh/Papers/whyfp.html">Why Functional Programming Matters</a> matters.<br /><br /><hr /><ol><li>And now I&#8217;m worried: what am I <em>still</em> missing?</li><br /><li>Please let&#8217;s not have a discussion about <a href="http://en.wikipedia.org/wiki/Turing-complete">Turing Equivalence</a>. Computer Science &#8220;Theory&#8221; tells us &#8220;there&#8217;s no such thing as more powerful.&#8221; Perhaps we share the belief that <em>In theory, there&#8217;s no difference between theory and practice. But in practice, there is</em>.</li><br /><li>I am not making the claim that <em>I</em> consider memory management or unsealed base classes harmful, but I argue that there exists at least one person who does.</li><br /><li>The word &#8220;factor&#8221; has been a little out of vogue in recent times. But thanks to an excellent <a href="http://programming.reddit.com/info/18td4/comments">post on reddit</a>, it could make a comeback.</li><br /><li>So much so that we won&#8217;t even bother to show what loops looked like in the days of <code>for (int i = 0; i &lt; employeeList.size(); ++i)</code>. </li><br /><li>Another organization might merge employees and departments, or have each department &ldquo;own&rdquo; a collection of employees. This makes our example easier, but now the <em>data</em> doesn&rsquo;t factor well. Everything we&rsquo;ve learned from databases in the last forty years tells us that we often need to find new ways to compose our data. The relational model factors well. The network model factors poorly.</li><br /></ol><div style="clear:both; padding-bottom:0.25em"></div><p class="blogger-labels">Labels: <a rel='tag' href="http://weblog.raganwald.com/labels/java.html">java</a>, <a rel='tag' href="http://weblog.raganwald.com/labels/lispy.html">lispy</a>, <a rel='tag' href="http://weblog.raganwald.com/labels/popular.html">popular</a>, <a rel='tag' href="http://weblog.raganwald.com/labels/ruby.html">ruby</a></p>&nbsp;
					<span class="PostFooter">

						&para; <a href="http://weblog.raganwald.com/2007/03/why-why-functional-programming-matters.html" title="permanent link">10:21 PM</a>

					 
				</span> 


                                        <p id="postfeeds"></p>

			</div>

			

		
			
				<div class="DateHeader">Monday, February 12, 2007</div>
			

			<div class="Post"><a name="677902229715311072">&nbsp;</a>
				<span class="PostTitle">

					<a href="http://weblog.raganwald.com/2007/02/programming-language-stories.html" title="permanent link">Programming Language Stories</a></span>
					<div style="clear:both;"></div><strong>C</strong><br /><br />A fellow needs a dog house, so he hires a contractor. This guy is a C programmer who&#8217;s between jobs at the moment, and he says forget those wimpy &#8220;agile&#8221; wooden dog houses, he can build the dog house out of bricks, it will last forever and is stronger than any wood structure.<br /><br />The client is doubtful, but that sounds very impressive, and the contractor says this is how all the real-world dog houses are made, so he agrees. Well, it takes forever: it seems every time the contractor thinks it&#8217;s finished, they discover there&#8217;s a chink between the bricks and there&#8217;s a leak. With wood you just trim to fit, but with bricks you have to plan everything in advance so that the bricks line up just right.<br /><br />But Spring turns to Summer turns to Autumn, and the job is done. The client pays up, and the contractor&#8217;s about to leave when he stops and thinks for a moment before speaking.<br /><br />&#8220;Hey,&#8221; the contractor says, &#8220;You paid for a pallet of bricks, and I used all but one. It&#8217;s a shame if it goes to waste. Why don&#8217;t I see if I can use it somewhere?&#8221; The client asks like what, and before you know it the contractor has scored a contract to build a brick path for the dog from the back door to the dog house. He orders some more bricks, gets to work right away, and this time things go a little better.<br /><br />The contractor is now doing C++ on the side. And he uses some new bricklaying techniques he learned from <a href="http://www.amazon.com/gp/product/0321334876?ie=UTF8&tag=raganwald001-20&linkCode=as2&camp=1789&creative=9325&creativeASIN=0321334876">Effective C++</a><img src="http://www.assoc-amazon.com/e/ir?t=raganwald001-20&l=as2&o=1&a=0321334876" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />: there are these funny angle braces everywhere thanks to his path building templates. Soon that job is done and the contractor collects his fee. He&#8217;s about to leave, but he reaches into his tool chest and pulls out a brick.<br /><br />&#8220;Hey,&#8221; the contractor says, &#8220;You paid for another pallet of bricks, and I used all but one on the path. It&#8217;s a shame if it goes to waste. Why don&#8217;t I see if I can use it somewhere?&#8221; The client is happy with the path, asks like what, and before you know it the contractor has scored another contract, this time to build a brick wall enclosing the yard. He orders some more bricks, and gets to work right away.<br /><br />Meanwhile, the contractor has become a Visual C++ programmer and reads MSDN magazine religiously. He applies his new skills to building the wall: he has all these fancy tools that can put up sections of scaffolding when you push a button. of course, there are huge holes you have to fill in yourself, and the scaffolding has all these crazy joins and angles, it&#8217;s hard to change anything or understand how the entire wall fits together, but it feels like you&#8217;re getting a lot done because the system seems to move a lot of bricks for you.<br /><br />Well, the wall takes forever, and it doesn&#8217;t look that good when it&#8217;s finally done. But the client pays up and the contractor is ready to leave. But he stops for a moment and pulls a brick out of his tool chest.<br /><br />&#8220;Hey,&#8221; the contractor says, &#8220;You paid for two more pallets of bricks for the wall, and I used all but one. It&#8217;s a shame if it goes to waste. Why don&#8217;t I see if I can use it somewhere?&#8221;<br /><br />The client has had enough of this, and he decides he&#8217;s going to show the contractor how he feels. &#8220;Give me that brick,&#8221; he orders. The surprised contractor hands it over. &#8220;I don&#8217;t give a rat&#8217;s ass about this brick&#8221; the client huffs, and he throws the brick clear out of his yard.<br /><br />&#8220;I need to get work done, not talk to contractors all day about bricks. And besides, I&#8217;ve talked to the big landscape contracting companies, and they all say nobody is using bricks, everyone has switched to sharp tools and netting. Now get out.&#8221;<br /><br /><strong>Ruby on Rails</strong><br /><br />Just inside the gates of heaven, St. Peter sits at a desk checking people in.<br /><br />Peter:  &#8220;Welcome to heaven.  Programming language?&#8221;<br /><br />The man at the front of the line says, &#8220;<a href="http://www.amazon.com/gp/product/0133713458?ie=UTF8&tag=raganwald001-20&linkCode=as2&camp=1789&creative=9325&creativeASIN=0133713458">Smalltalk</a><img src="http://www.assoc-amazon.com/e/ir?t=raganwald001-20&l=as2&o=1&a=0133713458" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />.&#8221;<br /><br />Glancing at his clipboard, Peter says, &#8220;Room 33.  Be very quiet as you pass Room Six.&#8221;<br /><br />The process repeats itself with the next person in line:<br /><br />Peter:  &#8220;Welcome to heaven.  Programming language?&#8221;<br /><br />Person #2:  &#8220;<a href="http://www.amazon.com/gp/product/1590592395?ie=UTF8&tag=raganwald001-20&linkCode=as2&camp=1789&creative=9325&creativeASIN=1590592395">Common Lisp</a><img src="http://www.assoc-amazon.com/e/ir?t=raganwald001-20&l=as2&o=1&a=1590592395" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />.&#8221;<br /><br />Peter:  &#8220;Room 17.  Be very quiet as you pass Room Six.&#8221;<br /><br />The next person moves to the front of the line with a look of curiosity on her face.<br /><br />Peter:  &#8220;Welcome to heaven.  Programming language?&#8221;<br /><br />Person #3:  &#8220;<a href="http://www.amazon.com/gp/product/0596009259?ie=UTF8&tag=raganwald001-20&linkCode=as2&camp=1789&creative=9325&creativeASIN=0596009259">Python</a><img src="http://www.assoc-amazon.com/e/ir?t=raganwald001-20&l=as2&o=1&a=0596009259" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />.&#8221;<br /><br />Peter:  &#8220;Room 54.  Be very quiet as you pass Room Six.&#8221;<br /><br />Person #3:  &#8220;Why do you keep telling us to be quiet as we pass Room Six?&#8221;<br /><br />Peter:  &#8220;Because the <a href="http://www.amazon.com/gp/product/0977616630?ie=UTF8&tag=raganwald001-20&linkCode=as2&camp=1789&creative=9325&creativeASIN=0977616630">Ruby on Rails</a><img src="http://www.assoc-amazon.com/e/ir?t=raganwald001-20&l=as2&o=1&a=0977616630" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" /> People are in Room Six, and they think they&#8217;re the only ones here.&#8221;<br /><p style="text-align: right">&#8212;Snarfed from Eric Sink&#8217;s <a href="http://software.ericsink.com/articles/Boundaries.html">Baptists and Boundaries</a></p><br /><strong>Java</strong><br /><br />A mother was preparing the pot-roast for Sunday&#8217;s big family dinner. Before searing it and placing it in the pan, she carefully sliced the ends off. Her three year-old daughter asked &#8220;Mommy, why do you cut the ends off the roast?&#8221;<br /><br />She answered, &#8220;My mom taught me to do it that way, and it&#8217;s delicious, so it must be a good idea. Maybe the juices from the meat mix with the vegetables?&#8221;<br /><br />Everyone sits down for dinner, and when Father is serving the roast, the daughter remembers her question. She turns to Grandma and asks, &#8220;Grandma, why did you teach Mommy to cut the ends off the roast?&#8221;<br /><br />Grandma thinks for a moment and says, &#8220;What a delightful question! I always used to cut the ends off the roast, it&#8217;s how <em>my</em> mother taught me. I don&#8217;t know why she did that, there must have been a good reason.&#8221; Grandma sits for a moment, remembering her mother. &#8220;Well,&#8221; she continues, &#8221; there must have been a good reason. Now eat your dinner before it gets cold!&#8221;<br /><br />The holidays roll around, and they&#8217;re having dinner at Grandma and Grandpa&#8217;s house. &#8220;Hey!&#8221; Grandma says to the little girl, &#8220;You know what, I was going through your great-grandmother&#8217;s things, and I found the old roast pan. We sure made some good pot roast in it. Let&#8217;s make pot roast with it tonight in her honour!&#8221;<br /><br />They get out the pan and wash it up. It&#8217;s old, and well-seasoned. Grandma looks it over. &#8220;It&#8217;s smaller than I remember. I was a little girl, and everything looks bigger when you&#8217;re small!&#8221;<br /><br />They put the roast on the counter before searing it. Just then, Grandpa walks by. &#8220;Do you want me to cut the ends off the roast?&#8221; he asks. &#8220;It&#8217;s the only way you&#8217;ll get it to fit in that small pan.&#8221;<br /><br />Grandma and the little girl look at each other. And they smile.<br /><br /><strong>Scheme</strong><br /><br />A fellow is on vacation, and he decides to ride one of those &#8220;scenic&#8221; double-decker buses that drive around from attraction to attraction. The upper level is open-air, and he&#8217;s the only one up there. He looks around, and decides that instead of re-reading his copy of <a href="http://www.amazon.com/gp/product/0262560992?ie=UTF8&tag=raganwald001-20&linkCode=as2&camp=1789&creative=9325&creativeASIN=0262560992">The Little Schemer</a><img src="http://www.assoc-amazon.com/e/ir?t=raganwald001-20&l=as2&o=1&a=0262560992" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />, he&rsquo;s going to really enjoy himself: he lights a cigar.<br /><br />No sooner has he lit the cigar when a woman comes huffing and puffing upstairs, carrying one of those sub-miniature dogs people use as fashion accessories. She takes one look at our man and demands he put the cigar out: it is <em>offensive to the dog</em>.<br /><br />&#8220;Madam,&#8221; our man asserts, &#8220;this cigar is not offensive. Let me tell you its secrets.&#8221;<br /><br />&#8220;Eschewing inferior mass-market tobacco, I order whole, functional leaves&#8212;at great expense and with difficulty&#8212;from a small collective in Cuba that still grow cigar tobacco the old-fashioned, original way.&#8221;<br /><br />&#8220;Unsullied by automatic rolling machines or other push button devices, I roll each cigar, myself, by hand. Using secret tobacco-macro techniques that are impenetrable to the typical ignorant cigarette smoker, I am able to pack as much smoking pleasure into a single cigar as would take a carton of cigarettes&#8212;nay, it is impossible to enjoy a smoke from regular cigarettes as much as I enjoy the elite, exclusive flavour of my cigars.&#8221;<br /><br />The woman is not impressed. &#8220;If your cigars are so good, how come nobody smokes them?&#8221; she asks. &#8220;If your cigars are so good, how come so many clubs and restaurants permit cigarettes but forbid cigars?&#8221;<br /><br />Our fellow is so irate he begins to splutter. &#8220;If you or your dog are unable to understand that the purity, the perfection achieved long ago on a remote island far from consumerism and mass productio&#8212;&#8221; But he is unable to finish, for the woman imperiously sweeps the cigar from his mouth and flings it over the side of the bus.<br /><br />&#8220;That&#8217;s what I think of your pompous cigar.&#8221; She tells him.<br /><br />He glares at her for a moment, then years of oppression, of being forced to live with the hated cigarettes against his will, bring him to a boil and he commits an unthinkable act. With a wrench, he seizes the dog and flings it after his cigar. There is a moment of uncomprehending shock, and then the woman begins to howl.<br /><br />Well, the bus driver hears all this and slams on the brakes. For a moment everything is higgledy-piggledy, and just as the woman&#8217;s wails return to their full volume, everyone is shocked to see the dog come trotting up, unharmed.<br /><br />And what do you know: the dog has&mdash;nestled gently in its mouth&mdash;the most unexpected thing:<br /><br /><a href="http://www.rot13.com/index.php?text=Gur%20Oevpx" title="The Brick">Gur Oevpx</a>.<br /><hr><br />If you enjoyed these stories, you may also like <a href="http://weblog.raganwald.com/2005/07/why-you-need-degree-to-work-for-bigco.html">Why You Need a Degree to Work For BigCo</a> and more recently, <a href="http://weblog.raganwald.com/2007/04/venture-capitalist-passes-away.html">A Venture Capitalist passes away peacefully, and...</a>.<div style="clear:both; padding-bottom:0.25em"></div><p class="blogger-labels">Labels: <a rel='tag' href="http://weblog.raganwald.com/labels/java.html">java</a>, <a rel='tag' href="http://weblog.raganwald.com/labels/lispy.html">lispy</a>, <a rel='tag' href="http://weblog.raganwald.com/labels/ruby.html">ruby</a></p>&nbsp;
					<span class="PostFooter">

						&para; <a href="http://weblog.raganwald.com/2007/02/programming-language-stories.html" title="permanent link">3:10 PM</a>

					 
				</span> 


                                        <p id="postfeeds"></p>

			</div>

			

		
			
				<div class="DateHeader">Friday, February 09, 2007</div>
			

			<div class="Post"><a name="117104072110045314">&nbsp;</a>
				<span class="PostTitle">

					<a href="http://weblog.raganwald.com/2007/02/program-in-java-you-must-be-joking.html" title="permanent link">Program in Java? You must be joking!</a></span>
					<div style="clear:both;"></div><blockquote><br />The Y combinator design pattern in Java is easily understood and can be used and maintained by unskilled, entry-level programmers.<br /><br />Cuius rei demonstrationem mirabilem sane detexi. Hanc marginis exiguitas non caperet.<br /></blockquote><br />You know, this kind of joke seems to rile Java apologists to no end. They come out of the woodwork with their web browsers set to <em>flame</em>. Absolutely no criticism of the language that powers everything from the web to space exploration (although there is never any talk of toasters) is allowed.<br /><br />And <em>do not</em> criticize the culture in any way whatsoever. Although it&#8217;s perfectly ok to boast that Java is designed to appeal to the widest possible diversity of skill levels, you <em>may not</em> suggest that Java programmers are stupid. Or else.<br /><br /><div class="book"><style type="text/css">.flickr-photo { border: solid 2px #000000; }.flickr-yourcomment { }.flickr-frame { text-align: left; padding: 3px; }.flickr-caption { font-size: 0.8em; margin-top: 0px; }</style><div class="flickr-frame"> <a href="http://www.flickr.com/photos/thomasb/334531216/" title="silly daddy!"><img height="240" width="168" src="http://farm1.static.flickr.com/138/334531216_31fa1468ac.jpg" class="flickr-photo" alt="" /></a><br /> <span class="flickr-caption"><a href="http://www.flickr.com/photos/thomasb/334531216/">silly daddy!</a>, originally uploaded by <a href="http://www.flickr.com/people/thomasb/">thomas.braithwaite</a>.</span></div>    <p class="flickr-yourcomment"> </p><br /></div>I am trying not to tell anyone what to do, but I have an observation. Have you ever heard a politically incorrect but extremely funny joke about a member of a particular culture? You know you have. And furthermore, the joke was probably told by a member of the group victimized in the joke.<br /><br />The unwritten rule is, if you&#8217;re a member, jokes are <em>fair game</em>. I was once with some, ahh, members of a religion that directly predated and evolved into Christianity. They were telling some jokes about their culture and religion. I had heard a few such jokes, but I wisely refrained from telling any. It&#8217;s not allowed. That&#8217;s the rule: outsiders may not joke.<br /><br />So back to Java. Guess what? I&#8217;m an <em>insider</em>. I write Java code every working day. If you care about hollow appeals to authority, I once wrote a Scheme implementation in Java. I was also the team lead for JProbe Threadalyzer, a tool that analyses multi-threaded Java behaviour. And the development manager for JProbe Server-Side Suite (the aforementioned thread analyser, plus profiling, code coverage, and memory debugging tools). And various J2EE implementations with various degrees of Enterprisy-ness.<br /><br />None of that makes me an expert. Nor does it make me right when I criticize or joke. But it does give me a certain smug <em>right to joke</em>. And don&rsquo;t we all need a laugh from time to time, even if we&rsquo;re laughing at ourselves? Perhaps <em>especially</em> if we're laughing at ourselves?<br /><br />I think it&rsquo;s a sign of good health to be able to laugh at ourselves and criticize our foibles. For all of the talk of Java as a &ldquo;mature platform,&rdquo; don&rsquo;t you agree that &ldquo;not taking criticism well&rdquo; is a little, well, <em>immature</em>? <br /><br />So since it&#8217;s Friday:<br /><br /><blockquote><br />A Muslim, a Vegetarian, and a Java Programmer are traveling by foot, and they stop at a farm house to sleep for the night. The farmer is impressed at the obvious sophistication of the Java Programmer&#8217;s tales of Enterprise wonder, and he invites her into the house. The Muslim he sends to the hayloft, and the Vegetarian can sleep in the barn.<br />  <br />  Well, the farmer is just pouring a night-cap and listening to the Java Programmer describe the time she knocked together a farm workflow application in less than a million lines of XML configuration code when there&#8217;s a knocking on the door.<br /><br />He opens the door and the Vegetarian is standing there. &#8220;I&#8217;m sorry,&#8221; the Vegetarian apologizes, &#8220;But you slaughter animals in the barn, and eating meat is offensive to my beliefs. I cannot sleep in the barn.&#8221; The farmer thinks this is bunkum, but he was raised to be courteous to his guests, so he asks the Vegetarian to swap places with the Muslim.<br />  <br />  The farmer knocks back his drink and turns down the lights. He can hear the Java Programmer setting up a sleeping bag factory to generate down-filled singleton sleeping containers in the living room. His wife is reading in bed, and he&#8217;s looking forward to catching up on the Wall Street Journal.<br /><br />Well, he is just about to climb into bed when there&#8217;s a banging on the door. He opens the door, and the Muslim is standing there. &#8220;I&#8217;m sorry,&#8221; the Muslim apologizes, &#8220;But you keep pigs in the barn, and pigs are profane according to my beliefs. I cannot sleep in the barn.&#8221;<br />  <br />  Muttering, the farmer rouses the Java Programmer off the couch and asks her to switch with the Muslim. He climbs into bed and has just started to read an interesting article on hedging commodity futures with convex derivatives when there&#8217;s a thunderous hammering at the door. His wife tells him to stay put and she goes to answer it. The farmer hears some excited talking, and a moment later his wife is at the bedroom door.<br />  <br />  &#8220;Honey,&#8221; she says, &#8220;it&#8217;s the pigs.&#8221;<br /></blockquote><div style="clear:both; padding-bottom:0.25em"></div><p class="blogger-labels">Labels: <a rel='tag' href="http://weblog.raganwald.com/labels/java.html">java</a>, <a rel='tag' href="http://weblog.raganwald.com/labels/popular.html">popular</a></p>&nbsp;
					<span class="PostFooter">

						&para; <a href="http://weblog.raganwald.com/2007/02/program-in-java-you-must-be-joking.html" title="permanent link">11:59 AM</a>

					 
				</span> 


                                        <p id="postfeeds"></p>

			</div>

			

		
			
				<div class="DateHeader">Wednesday, January 31, 2007</div>
			

			<div class="Post"><a name="117030666664178098">&nbsp;</a>
				<span class="PostTitle">

					<a href="http://weblog.raganwald.com/2007/01/closures-and-higher-order-functions.html" title="permanent link">Closures and Higher-Order Functions</a></span>
					<div style="clear:both;"></div>There has been a great deal of interest in <em><a href="http://gafter.blogspot.com/2007/01/definition-of-closures.html">closures</a></em> lately, driven in great part by the fact that there is talk of adding some form of anonymous functions to the Java. Most of the time, people talk about “adding closures” to Java, and that prompts a flurry of questions of the form “what is a closure and why should I care?”<br /><br />The discussion around closures tends to go on and on about the “closing over” of free variables and only lightly touch on the biggest change to Java: functions as first-class objects with a lightweight syntax for creating them. Making it easy to do something basic like define a new function is more than just a little syntactic sugar: it makes it easy to do new things with functions that were impractical when you needed a lot of boilerplate to make anything work.<br /><br /><blockquote>Without understanding functional programming, you can’t invent MapReduce, the algorithm that makes Google so massively scalable.<br /></blockquote><div style="text-align: right;">—Joel Spolsky, <a href="http://www.joelonsoftware.com/articles/ThePerilsofJavaSchools.html">The Perils of JavaSchools</a><br /></div><br />I’m going to try to explain first class functions using Ruby (it <em>is</em> possible to write code that does exactly the same thing using the current Java feature set, however the result is so wordy that it obscures the basic idea being presented: call it accidental complexity, or perhaps <a href="http://weblog.raganwald.com/2006/12/economizing-can-be-penny-wise-and.html">yellow code</a>.)<br /><br /><a href="http://www.ruby-lang.org/">Ruby</a> is a good language for demonstrating features that ought to be in Java. Like Java, Ruby uses squiggly brace syntax. Like Java, everything in Ruby is an object&mdash;whoops, Java has primitives. Okay, like Java, functions are represented as objects.<br /><br />In Java you write:<br /><br /><pre><code>interface IFromIAndI {<br />   Integer call(Integer a, Integer b);<br />}<br /><br />IFromIAndI add_two_integers = new IFromIAndI() {<br />   public Integer call(final Integer a, final Integer b) {<br />      return a + b;<br />   }<br />};<br /></code></pre><br />(The Java convention is to name things in <a href="http://en.wikipedia.org/wiki/CamelCase">lowerCamelCase</a>, but we’ll ignore that. If you need to print this essay on a dot-matrix printer you may want to make some changes first.)<br /><br />In Ruby you write the function as:<br /><br /><pre><code>add_two_integers = lambda { |a,b| a + b }<br /></code></pre><br />Later on, when you want to call your function in Java, you write:<br /><br /><pre><code>add_two_integers.call(35, 42);<br /></code></pre><br />And if you like semicolons, you write the <em>exact same thing</em> in Ruby:<br /><br /><pre><code>add_two_integers.call(35, 42);<br /></code></pre><br />You can do the same thing with multiplication:<br /><br /><pre><code>multiply_two_integers = lambda { |a,b| a * b }<br /></code></pre><br /><strong>First Class Functions</strong><br /><br />In the examples above, functions look a little like methods. The Java version is obviously implemented as a method. But what we did in both cases was assign the resulting function to a variable. In Java, assigning a method to a variable is not particularly easy (it is possible using reflection).<br /><br />Anything that can be assigned to a variable is a <em>value</em>. If it can also be passed as a parameter or returned from a method (or function), we say it is a <em>first class value</em>. Functions as first class values, or first class functions, are very interesting. For example, what can we do passing a function as a parameter to another function?<br /><br />Hmmm. Well, I am breaking a cardinal rule of selling something. We’re talking about shiny new toys without identifying a problem to be solved. Let’s talk about my favourite problem: writing the same thing more than once, violating the <acronym title="Don't Repeat Yourself">DRY</acronym> principle.<br /><br />Here are two pieces of similar Ruby code:<br /><br /><pre><code>adder_wth_acc = lambda { |acc, list|<br />   if list.empty?<br />      acc<br />   else<br />      adder_wth_acc.call(acc + list.first, list[1..-1]) # [1..-1] returns a copy of the list without the first element<br />   end<br />}<br />adder = lambda { |list|<br />   adder_wth_acc.call(0, list)<br />}<br />adder.call([1, 2, 3, 4, 5])<br /></code></pre><br />And:<br /><br /><pre><code>multiplier_with_acc = lambda { |acc, list|<br />   if list.empty?<br />      acc<br />   else<br />      multiplier_with_acc.call(acc * list.first, list[1..-1]) # [1..-1] returns a copy of the list without the first element<br />   end<br />   }<br />   multiplier = lambda { |list|<br />   multiplier_with_acc.call(1, list)<br />}<br />multiplier.call([1, 2, 3, 4, 5])<br /></code></pre><br />What do they both do? Pretty much the same thing: they accumulate the result of some binary operation over a list of values. <code>adder</code> accumulates addition, and <code>multiplier</code> accumulates multiplication. You could call this a “Design Pattern.” If you did that, you would use the exact chunk of code everywhere. I would call that retrograde. Didn’t our predecessors invent the subroutine so we could eliminate writing the exact same piece of code over and over again?<br /><br />Why can’t we do the same thing? Well, we can. A subroutine does the same thing over and over again, but it takes different parameters as it goes. What is different between adder and multiplier? Ah yes, the adding and multiplying. Functions. What we want is a function that takes a function as a parameter.<br /><br />Well, we said that with first-class functions, functions are values and can be passed as parameters. Let’s try it:<br /><br /><pre><code>folder = lambda { |default_value, binary_function, list|<br />   fold_with_acc = lambda { |acc, list|<br />      if list.empty?<br />          acc<br />      else<br />          fold_with_acc.call(binary_function.call(acc, list.first), list[1..-1])<br />      end<br />   }<br />   fold_with_acc.call(default_value, list)<br />}<br /></code></pre><br />Now we can use our function that takes functions as a parameter:<br /><br /><pre><code>folder.call(0, add_two_integers, [1, 2, 3, 4, 5])<br />folder.call(1, multiply_two_integers, [1, 2, 3, 4, 5])<br /></code></pre><br />This is <strong>much</strong> better. When functions can take functions as parameters, we can build abstractions like <code>folder</code> and save ourselves a lot of code. Note that this would be a lot harder to read if we had to surround all of our functions with Object boilerplate in Java. That’s one of the key reasons why ‘syntactic sugar’—making it brief—is a big win.<br /><br />And you know what? Functions are values, not just variables that happen to hold functions. These work just as well:<br /><br /><pre><code>folder.call(0, lambda { |a, b| a + b }, [1, 2, 3, 4, 5])<br />folder.call(1, lambda { |a, b| a * b }, [1, 2, 3, 4, 5])<br /></code></pre><br />There’s just one problem (actually two, but I’m saving one for later): everywhere you use our new <code>folder</code> function, you need to remember that <code>add_two_integers</code> needs a default value of zero, but <code>multiply_two_integers</code> needs a default value of one. That’s bad. Sooner or later you will get this wrong.<br /><br />What we need is a way to call <code>folder</code> without having to always remember the correct initial value. Should we extend our understanding of a function to include a default initial value for folding? If we’re thinking in Java, maybe our <code>IFromIAndI</code> interface needs a <code>getDefaultFoldValue</code>? I think not. Why should a function know anything about how it’s used? And besides, as we build other abstractions out of functions we’ll need more stuff.<br /><br />If we aren’t careful, we’ll end up implementing the <code>Visitor</code> pattern on functions, and all of our brevity will go out the window. No, what we want is this: in one place we define that folding addition starts with a default value of zero and in another place we say we want to fold, say, <code>[1, 2, 3, 4, 5]</code> with addition. Then when we want to fold something else with addition, like <code>[2, 4, 6, 8, 10]</code>, we shouldn’t have to say anything about zero again.<br /><br /><strong>Adding Curry</strong><br /><br />What we need is a function that folds addition. Didn’t we say that functions are values that can be returned from functions? How about a function that makes a folding function? We should pass it our initial value and our binary function, and it should return a function that performs the fold without needing an initial value as a parameter:<br /><br /><pre><code>fold_coder = lambda { |default_value, binary_function|<br />   fold_with_acc = lambda { |acc, list|<br />      if list.empty?<br />          acc<br />      else<br />          fold_with_acc.call(binary_function.call(acc, list.first), list[1..-1])<br />      end<br />   }<br />   lambda { |list|<br />      fold_with_acc.call(default_value, list)<br />   }<br />}<br /></code></pre><br />Now we can do the following:<br /><br /><pre><code>adder = fold_coder.call(0, lambda { |a, b| a + b })<br />adder.call([1, 2, 3, 4, 5])<br />adder.call([2, 4, 6, 8, 10])<br /></code></pre><br />No more remembering that addition starts with a default of zero.<br /><br /><blockquote>Actually, there’s a far simpler way to avoid having to remember the default value when you want to fold over addition. But let’s just play along so that we don’t have to come up with an entirely new set of examples to demonstrate the value of functions as first-class values.<br /></blockquote>Functional programmers (as opposed to the rest of us <em>dysfunctional</em> programmers) will recognize this as <a href="http://en.wikipedia.org/wiki/Currying">currying</a> our <code>folder</code> function. Currying is when a function takes more than one parameter and you combine one of the parameters and the function to produce a function that takes fewer parameters.<br /><br />Here’s a currying function in Ruby:<br /><br /><pre><code>curry = lambda { |fn,*a|<br />   lambda { |*b|<br />     fn.call(*(a + b))<br />   }<br />}<br /></code></pre><br />(<em>This is an improvement on an earlier version, thanks to Justin's <a href="http://weblog.raganwald.com/2007/01/closures-and-higher-order-functions.html#117037273013059827">comment</a>.</em>)<br /><br />So you can use our new function to create an increment function out of our adder and a treble function out of our multiplier:<br /><br /><pre><code>plus_one = curry.call(add_two_integers, 1)<br />times_three = curry.call(multiply_two_integers, 3)<br /></code></pre><br /><br />If you are ever asked, “what good is currying?,” I hope I’ve given you an example you can use to explain why currying matters, and why people do it all the time (possibly without explicitly naming it). Although it doesn’t look like much when looking at trivial examples like functions that multiply by three, it’s much more useful when creating folders and mappers where you want some of the parameters to remain constant.<br /><br /><strong>Composition</strong><br /><br />Our examples combined functions and non-functions to create new functions. Here’s an example from a recent post, <a href="http://weblog.raganwald.com/2007/01/dont-overthink-fizzbuzz.html">Don’t Overthink FizzBuzz</a>, where I give a method for <em>composing</em> two functions. The idea is that if you have multiple functions that each take one argument, you can combine them using <code>compose</code>. I also have a method that generates functions, <code>carbnation</code>:<br /><br /><pre><code># fizzbuzz.rb<br /><br />def compose *lambdas<br />  if lambdas.empty?<br />    lambda { nil }<br />  elsif lambdas.size == 1<br />    lambdas.first<br />  else<br />    lambda do |n|<br />      lambdas.first.call(compose(*lambdas[1..-1]).call(n))<br />    end<br />  end<br />end<br /><br />def carbonation(modulus, printable_form)<br />  i = 0<br />  lambda do |n|<br />    (i = (i + 1) % modulus) == 0 && printable_form || n<br />  end<br />end<br /><br />print(((1..100).map   &compose(     carbonation(15, 'FizzBuzz'), carbonation(5, 'Buzz'), carbonation(3, 'Fizz'))).join(' '))<br /><br /></code></pre><br />The simple explanation of how it works is that <code>carbonation</code> generates functions that replace every so many elements of a list with a printable string. <code>Compose</code> composes any two or more methods together. So if you want to print out 100 numbers, but replace every third number with “Fizz,” every fifth with “Buzz,” and all those that are third <strong>and</strong> fifth with “FizzBuzz,” you generate a function for each replacement, compose them together with compose, and then map the numbers from one to one hundred to the resulting überfunction.<br /><br />When you look at this today, it seems weird and unreadable by Java standards. I wonder if adding first-class functions with simple syntax to Java will lead the Java community to a place where code like this will not appear out of place?<br /><br /><strong>Just one more thing</strong><br /><br />So we started by saying that people are getting hung up on what makes a closure a closure, and there has been less emphasis on the benefits of using functions as first-class values. Did you notice that our <code>folder</code> function actually includes a non-trivial closure?<br /><br />If you look at the <code>fold_with_acc</code> function, it makes use of <code>binary_function</code>, a variable from its enclosing lexical scope. This is not possible with the current version of Java: if you translate this to Java, when you make <code>fold_with_acc</code> and anonymous inner class, you will have to copy <code>binary_function</code> into a final member to use it. It simply won’t compile if you try an idiom-for-idiom translation, even adding explicit types.<br /><br />And then if you look at the anonymous function it returns, <code>lambda { |list| fold_with_acc.call(default_value, list) }</code>, that anonymous function uses <code>default_value</code>,another variable from the enclosing lexical scope. Once again you will have to fool around with final variables to make this work, or perhaps declare full-fledged object with constructors.<br /><br />(If you try writing this simple example out in Java, you quickly find yourself inventing a lot of classes or interfaces. And they have some complicated types, like a function taking an integer and a function taking two integers, returning a function taking a list of integers and returning an integer.<br /><br />After twenty minutes of that, you understand why the <a href="http://www.ml.com/">ML</a> and <a href="http://planet.haskell.org/">Haskell</a> communities use <a href="http://en.wikipedia.org/wiki/Type_inference">type inference</a>: If the types are that complicated, it&rsquo;s incredibly helpful to have the compiler check them for you. Yet if the types are that verbose, it&rsquo;s incredibly painful to write them out by hand. Even if your IDE were to write them for you, they take up half the code, obscuring the meaning.<br /><br />You also get why the Ruby on Rails community doesn&rsquo;t care about type checking: types for CRUD applications are way less complicated than types for first-class functional programs.)<br /><br /><strong>That’s Interesting</strong><br /><br />Part of the interest in closures is in simplifying the syntax around functions, and part of the interest is in the way that access to enclosing scope would simplify a lot of code. There’s a whole debate around the value of simplification in a world where all serious languages are <a href="http://scienceblogs.com/goodmath/2007/01/turing_equivalent_vs_turing_co.php#more">Turing Equivalent</a>.<br /><blockquote><br />I hope you’re convinced, by now, that programming languages with first-class functions let you find more opportunities for abstraction, which means your code is smaller, tighter, more reusable, and more scalable.<br /></blockquote><div style="text-align: right;">—Joel Spolsky, <a href="http://www.joelonsoftware.com/items/2006/08/01.html">Can Your Programming Language Do This?</a><br /></div><br />For me, simpler is just nicer until something reaches a certain tipping point: when it becomes so simple that the accidental complexity of using it goes away, I will start using it without thinking about it. Tail optimization is like that: as long as recursion is slower than iteration and sometimes breaks, I have to think about it too much. But when I’m not burdened with “except…” and “when performance is not a factor…” it becomes natural.<br /><br />And then something interesting happens. It changes the way I look at problems, and one day I see a whole new way to do something that I never saw before. Functions as first class values are definitely one of those things that change everything.<br /><br /><span style="font-weight: bold;">Further Reading<span style="font-weight: bold;"><br /><br /></span></span>If this has whet your appetite for more, <a href="http://www.amazon.com/gp/product/0262011530?ie=UTF8&tag=raganwald001-20&amp;link_code=as3&camp=211189&amp;creative=373489&creativeASIN=0262011530">Structure and Interpretation of Computer Programs</a> is <span style="font-style: italic;">the</span> book on higher-order functions and how they can be used as building blocks to create more elaborate abstractions such as object-oriented programming.<br /><br /><a href="http://www.amazon.com/gp/product/026256100X?ie=UTF8&tag=raganwald001-20&amp;link_code=as3&amp;camp=211189&creative=373489&amp;creativeASIN=026256100X">The Seasoned Schemer</a> devotes an entire book to the uses of functions. Although the examples are in Scheme, the language is dead simple to learn and the techniques in the book can be applied to Ruby and Java (or at least to a future version of Java where you do not need functors).<br /><br />The second edition of <a href="http://www.amazon.com/gp/product/0974514055?ie=UTF8&tag=raganwald001-20&amp;link_code=as3&camp=211189&amp;creative=373489&creativeASIN=0974514055">Programming Ruby</a> is an indispensable guide. Even if you will not be using Ruby immediately, pick it up and discover why so many people are lauding the language's simple, clean design and powerful Lisp-like underpinnings.<br /><br />As the author says, &ldquo;<a href="http://www.amazon.com/gp/product/1558607013?ie=UTF8&tag=raganwald001-20&linkCode=as2&camp=1789&creative=9325&creativeASIN=1558607013">Higher-Order Perl: Transforming Programs with Programs</a><img src="http://www.assoc-amazon.com/e/ir?t=raganwald001-20&l=as2&o=1&a=1558607013" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" /> is about functional programming techniques in Perl. It&rsquo;s about how to write functions that can modify and manufacture other functions.<br /><br />&ldquo;Why would you want to do that? Because that way your code is more flexible and more reusable. Instead of writing ten similar functions, you write a general pattern or framework that can generate the functions you want; then you generate just the functions you need according to the pattern. The program doesn&rsquo;t need to know in advance which functions are necessary; it can generate them as needed. Instead of writing the complete program yourself, you get the computer to write it for you.&rdquo;<br /><br />It&rsquo;s worth reading even if you have no intention of using Perl: the ideas span languages, just as SICP is worth reading even if you don&rsquo;t use Scheme at work. And be sure to read <a href="http://interglacial.com/hoj/">Higher-Order JavaScript</a> and <a href="http://blog.grayproductions.net/articles/category/higher-order-ruby/">Higher-Order Ruby</a>. They translate HOJ&rsquo;s ideas to other languages.<br /><br /><i>Notable Follow-ups:</i><br /><br /><a href="http://www.randomhacks.net/articles/2007/02/01/some-useful-closures-in-ruby">Some useful closures, in Ruby</a>: &ldquo;The <a href="http://en.wikipedia.org/wiki/Dylan_programming_language">Dylan programming language</a> included four very useful functions for working with closures: <strong>complement</strong>, <strong>conjoin</strong>, <strong>disjoin</strong> and <strong>compose</strong>.  The names are a bit obscure, but they can each be written in a few lines of Ruby.&rdquo;<br /><br /><a href="http://www.wuenschenswert.net/wunschdenken/archives/117">From Functional to Object-Oriented Programming</a>: &ldquo;OO allows a traceable connection between the conceptual design level and the implementation level. Concepts have names, so you can talk about them, between programmers and architects.&rdquo;<br /><br /><a href="http://weblog.raganwald.com/2007/02/hof-or-oop-yes.html">HOF or OOP? Yes!</a>: &ldquo;First-class functions are a natural fit with OO, as evidenced by their presence in OO languages that aren’t glorified PDP-11 assemblers with some OO stuff bolted on the side.&rdquo;<br /><br /><a href="http://weblog.raganwald.com/2007/02/but-y-would-i-want-to-do-thing-like.html">But Y would I want to do a thing like this?</a>: &ldquo;To truly learn a new tool, you must not just learn the new tool, you must apply it to new kinds of problems. It’s no good learning to replace simple iteration with first-class functions: all you’ve learned is syntax. To really learn first-class functions, you must seek out problems that aren’t easily solved with iteration.&rdquo;<div style="clear:both; padding-bottom:0.25em"></div><p class="blogger-labels">Labels: <a rel='tag' href="http://weblog.raganwald.com/labels/java.html">java</a>, <a rel='tag' href="http://weblog.raganwald.com/labels/lispy.html">lispy</a>, <a rel='tag' href="http://weblog.raganwald.com/labels/popular.html">popular</a>, <a rel='tag' href="http://weblog.raganwald.com/labels/ruby.html">ruby</a></p>&nbsp;
					<span class="PostFooter">

						&para; <a href="http://weblog.raganwald.com/2007/01/closures-and-higher-order-functions.html" title="permanent link">11:55 PM</a>

					 
				</span> 


                                        <p id="postfeeds"></p>

			</div>

			

		
			
				<div class="DateHeader">Tuesday, January 30, 2007</div>
			

			<div class="Post"><a name="116982833560409993">&nbsp;</a>
				<span class="PostTitle">

					<a href="http://weblog.raganwald.com/2007/01/please-design-deck-of-cards-in-java.html" title="permanent link">Please design a deck of cards in Java</a></span>
					<div style="clear:both;"></div>Dear Future Colleague:<br /><br /><span style="font-style: italic;">I’ve been asked to perform a quick technical evaluation of your résumé before we ask you in for an interview. You obviously have the right kind of experience and I’m looking forward to meeting you soon.<br /><br />We are asking all candidates to perform a little exercise before coming in for the first meeting. I realize you have a great deal of relevant experience, so this will not take very much of your time at all.<br /><br />And I’m sure you appreciate the fact that we value ability and merit above certifications and other pieces of paper.</span><br /><br /><h4>Please design a deck of cards in Java</h4>Imagine that we are writing a casino program. We are not going to write the whole program right now, just the part of the program that has to handle the decks of cards to be used by the rest of the program.<br /><br /><blockquote>If you are not familiar with the kind of cards used in European card games (like Poker, Bridge, Blackjack, Crazy Eights, Rummy, and so on), please write back and I will give you a different problem. You should be comfortable with concepts like the ranks of the cards, the suits, shuffling, and dealing.<br /></blockquote>Your task is to design the interfaces and/or classes we would need for the deck(s) of cards. At a bare minimum, your classes should handle everything we need to know about decks of cards, the cards themselves, and operations on decks of cards like shuffling, dealing, removing cards from a deck (some games have one or two jokers, some don’t, some only use the cards from 9 and up, some from 7 and up, some use them all), and combining decks (<a href="http://www.pagat.com/rummy/canasta.html">Canasta</a> uses two, four, six, or more decks of cards with jokers!)<br /><br />You do not need to worry about the mechanics of games like hands of cards, ranking Poker hands, knowing about Trumps or Bowers (as in Euchre and Bridge), discard piles (as in most games), or melds (as in Gin, Rummy, and Canasta). Imagine that other people will write all of that stuff using your classes for decks and cards.<br /><br />Please be <span style="font-weight: bold;">specific</span> about the interfaces, abstract classes, and concrete classes you will need. There is no need to actually write the bodies of methods, but please be specific about what the methods are called, what parameters they take, and what they return (if anything).<br /><br />I am especially interested in the relationships between the classes. Although you don’t have to write out each method, if you expect that a method would call other methods in your design, please say so.<br /><br />For example:<br /><br /><pre><code>class Deck {<br /><br />// calls Card.arrangeRelativeTo(Card othercard)<br />public void shuffle () { ... }<br /><br />}<br /></code></pre><br /><br />You can see that in this hypothetical design cards have some ability to arrange themselves relatively to each other and I am documenting that <code>Decks</code> can be shuffled and they use the <code>Card</code>s’ <code>arrangeRelativeTo</code> method to do so. Obviously, you don’t need to follow that design. It’s just an example.<br /><br /><div class="book"><a href="http://www.amazon.com/gp/product/0201633612?ie=UTF8&tag=raganwald001-20&amp;linkCode=as2&camp=1789&amp;creative=9325&creativeASIN=0201633612"><img style="cursor: pointer;" src="http://weblog.raganwald.com/uploaded_images/design_patterns-714104.jpg" alt="Design Patterns" border="0" /></a><img src="http://www.assoc-amazon.com/e/ir?t=raganwald001-20&l=as2&amp;o=1&a=0201633612" alt="" style="border: medium none  ! important; margin: 0px ! important;" border="0" height="1" width="1" /><br /><a href="http://www.amazon.com/gp/product/0201633612?ie=UTF8&tag=raganwald001-20&amp;linkCode=as2&camp=1789&amp;creative=9325&creativeASIN=0201633612">Design Patterns: Elements of Reusable Object-Oriented Software (Addison-Wesley Professional Computing Series)</a><img src="http://www.assoc-amazon.com/e/ir?t=raganwald001-20&amp;l=as2&o=1&amp;a=0201633612" alt="" style="border: medium none  ! important; margin: 0px ! important;" border="0" height="1" width="1" /><br /></div>This extends to constructors. Does creating a <code>Deck</code> create <code>Card</code>s? Or does it use <code>Card</code>s that already exist? Or are <code>Card</code>s not even objects but are represented by primitive types?<br /><h4 id="uml">About UML</h4>You can just write out the skeleton of the classes and interfaces. If you prefer to use <a href="http://www.uml.org/">UML</a>, be my guest. As long as your design answers all of the questions I have, use whatever notation you prefer. Just don’t fall into the trap of letting the notation drive the design: just because a certain type of UML diagram doesn’t indicate the CREATES-A relationship, that doesn’t mean you shouldn’t add it: what’s important is the design, not the document.<br /><h4 id="requirements">Requirements?</h4>Feel free to <a href="mailto:apply@devtopia.com" title="Apply for a job at Devtopia">email</a> or call with any questions you might have about requirements. This is not meant as a test of your ability to read my mind about what I want or to ask insightful questions. So, it’s ok to ask me questions. If you have a choice to make, it’s also ok to just decide.<br /><br />For example, you might wonder how to represent which cards are left in a deck after dealings some out. Should you use a standard OO pattern like a <code>List</code> or <code>Set</code>? That might be fine if our Casino program is a single-user game. But if we are running a web-based virtual casino with many thousands of users, performance might be important enough that we consider using something like a <a href="http://en.wikipedia.org/wiki/Bit_field">bitfield</a> for each deck.<br /><br />If you want, you can ask what’s more important. Or you could just decide for yourself. Using a bitfield for performance is a fine decision. So is having a standard OO design. Each works well for a particular set of requirements.<br /><br />So don’t be too concerned about asking a million questions. I just want to get a basic idea of your comfort level designing OO software.<br /><br />Thanks,<br /><br /><br /><br /><br /><span style="font-style: italic; font-weight: bold;">Reg Braithwaite</span><br /><br />p.s. This isn’t a trick question. There’s no right answer, and as I said above I don’t even expect full implementations, so you don’t even have to write code that compiles.<br /><br />There is absolutely no need for a bunch of stuff I didn’t ask about, like requirements in three-ring binders or JUnit test cases. I know that you are probably tempted to show off your depth of experience and SDLC knowledge, however I really only want to know how you would approach the design in this question.<br /><br />Please save the other stuff for the interview. Just because I don’t need to know about it right now doesn’t mean I don’t agree that it’s important!<div style="clear:both; padding-bottom:0.25em"></div><p class="blogger-labels">Labels: <a rel='tag' href="http://weblog.raganwald.com/labels/java.html">java</a>, <a rel='tag' href="http://weblog.raganwald.com/labels/jobs.html">jobs</a></p>&nbsp;
					<span class="PostFooter">

						&para; <a href="http://weblog.raganwald.com/2007/01/please-design-deck-of-cards-in-java.html" title="permanent link">10:00 AM</a>

					 
				</span> 


                                        <p id="postfeeds"></p>

			</div>

			

		
			
				<div class="DateHeader">Friday, December 08, 2006</div>
			

			<div class="Post"><a name="116562693299794044">&nbsp;</a>
				<span class="PostTitle">

					<a href="http://weblog.raganwald.com/2006/12/trick-or-bleep.html" title="permanent link">Trick or Bleep?</a></span>
					<div style="clear:both;"></div>I like to post fun stuff on Fridays. I also repost old stuff from time to time when my brain is page faulting or when something I’m reading reminds me of an old post. Today both were true: I spotted <a href="http://www.iosn.net/Members/ken/blog/20061205" title="KISS (or why MS CS students have a bad time in interviews ...)">this post</a> about interviews going wrong and I remembered <a href="http://weblog.raganwald.com/2004/07/interviewees-perspective.html" title="The Interviewee's Perspective">an interview where I was the hapless victim</a>.<br /><br />There has been some refreshing commentary on the post and also on <a href="http://programming.reddit.com/info/u4pa/comments">reddit</a>. I want to give my thoughts on one issue. Was the interviewer posing a “trick question,” trying to find out how I negotiate conflict? This subject has attracted a lot of attention since Joel Spolsky recently <a href="http://www.joelonsoftware.com/articles/ThePhoneScreen.html" title="The Phone Screen">raised the issue</a>, and while it didn’t cross my mind at the time, it’s worth considering.<br /><br />The question posed to me was, <em>list all of the ways to call instance and class methods in Java</em>. I listed a bunch of things, and at the end, I included:<br /><pre><code>    someInstanceVariable.staticMethod();<br />    // calls the staticMethod of someInstancevariable's declared class<br /></code></pre>The interviewer told me I was wrong, and I shrugged, explaining that I thought I was right, but no big deal if I was wrong, since I never use that style of call, so it wasn’t an issue. The interviewer later told me that he did not like my answer, and indeed I did not get an offer.<br /><br />If this was a trick question, <em>ok, you had me</em>! I am not afraid to argue points where I believe there is a direct connection between the issue and the outcome of software development projects. If I really believe it is irrelevant, I don’t argue even if I have a personal preference. So I’ll happily go along with any particular coding style you advocate (including none), and if you insist that I use Eclipse for Java instead of TextMate, fine.<br /><br /><div style="float: right; margin: 0 0 10px 10px; width: 192px; "><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://www.amazon.com/gp/product/0201310058?ie=UTF8&tag=raganwald001-20&linkCode=as2&camp=1789&creative=9325&creativeASIN=0201310058.jpg"><img style="float:right; margin:0 0 10px 10px;cursor:pointer; cursor:hand;" src="http://weblog.raganwald.com/uploaded_images/effective_java-724431.jpg" border="0" alt="" /></a><img src="http://www.assoc-amazon.com/e/ir?t=raganwald001-20&l=as2&o=1&a=0201310058" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" /></div>The problem with that question (let’s be clear, it’s <em>my</em> problem, not the interviewer’s problem), is that I don’t really care whether Java lets you call a static method via an instance of a class. The reason I don’t care, as I explained to the interviewer, is that I will <strong>never</strong> allow that code to get into the repository.<br /><br />For those who are too busy with Lisp to know all of Java’s warts, the problem is that static or class methods are never polymorphic. So if you write:<br /><pre><code>    // (yes, I know about public vs. private. These are obviously in 'package scope')<br /><br />class House {<br />    static String doorAction () { return "closes and locks"; }<br />}<br />class S___House extends House {<br />    static String doorAction () { return "bangs"; }<br />}<br /></code></pre>and you do this:<br /><pre><code>    final House structure = new S___House();<br />System.out.println(structure.doorAction());<br /></code></pre>You get <code>closes and locks</code> instead of <code>bangs</code>. Always. This is <strong>not</strong> what happens with instance methods, and that’s because so-called ‘static methods’ in Java are really global functions that live in class namespaces. The compiler resolves the function <code>doorAction</code> by looking up the declared type of <code>structure</code> at compile time. Its actual type at runtime is irrelevant. C++ programmers recognize this as the difference between <a href="http://en.wikipedia.org/wiki/Virtual_functions">virtual</a> and non-virtual functions.<br /><br />Back to the “trick question.” My problem is that since I never have and never will use this, I’m not going to argue whether it’s legal or not. It will never have the slightest impact on any project I’m on. If you want an argument, let’s discuss why you think we should use this idiom in production code.<br /><br />I honestly don’t think it was a trick question. If the interviewer knew it was legal and wanted an argument, he could have (and I suggest should have) chosen a different thing  to argue, something a little more obvious, such as telling me it is <em>legal and polymorphic</em>, and then seeing whether I (a) know that it is not polymorphic, and (b) argue with him.<br /><br />I don’t use questions like this, but I can see the value of this second question: a really experienced person knows exactly why it isn’t polymorphic and can discuss the kinds of bugs you will get if you try to write code depending on it.<br /><br />What do you think? Was this really a trick question? If so, should I have been more aggressive in arguing the subtle points of Java law?<br /><br />p.s. <span style="font-style: italic;">The interviewer later told me that he did not like my answer, and indeed I did not get an offer</span>: one benefit of much water having passed under the bridge is a more balanced perspective. I no longer assume that this one question is the only reason the interviewer decided I was not appropriate.<br /><br /><div style="margin: 0px 10px 10px 0px; float: left; width: 200px; text-align: center;"><a href="http://www.amazon.com/gp/product/0316172324?ie=UTF8&tag=raganwald001-20&linkCode=as2&camp=1789&creative=9325&creativeASIN=0316172324"><img border="1" src="http://weblog.raganwald.com/uploaded_images/blink_2-736734.jpg"><img src="http://www.assoc-amazon.com/e/ir?t=raganwald001-20&l=as2&o=1&a=0316172324" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" /></a><br /><span style="font-size:85%;"><em><br />“Blink” examines why people make unconscious decisions. It's very relevant to interviews!</em></span></div>I may have been overqualified, too talkative, too reflective, or even too meticulous (when given the programming challenge of permuting a string, I was apparently the only candidate to ask what the output should be when the string contained duplicate letters). <a href="http://www.gladwell.com/blink/" title="Blink, by Malcolm Gladwell">Perhaps the interviewer had already decided the interview outcome before this question was discussed</a>.<br /><br />And do you know what? I’m not so sure I wouldn’t have reacted the same way as the interviewer. One of the big “No Hire” flags for me is a candidate who doesn’t fundamentally “get” a programming language. Anyone can “Learn Blub in 21 Days,” memorizing code snippets and patterns by rote. But such candidates often have no clue how a language works, how its features interact with each other to make those memorized code snippets work.<br /><br />Let’s say that I’m interviewing and I don’t know that Java (which isn’t particularly OO in theory or in practice) allows this bug of calling a static ‘method’ via an instance of a class. Is that so bad? Of course not, it’s a wart on the language. It’s not like knowing that it is allowed reveals a deep understanding of how Java works. So not knowing this isn’t a fundamental flaw in a Java developer or interviewer.<br /><br />Now a candidate tells me that this thing works. Well, I might jump to the conclusion that the candidate really doesn’t get the difference between static and instance methods, that the candidate will have trouble understanding the various scoping issues involved with instance members and static members. I could easily believe that this candidate will draw a complete blank when working with inner classes.<br /><br />An interviewer who didn’t happen to know this bit of Java trivia might reasonably infer that thinking it works betrays a superficial knowledge of Java.<div style="clear:both; padding-bottom:0.25em"></div><p class="blogger-labels">Labels: <a rel='tag' href="http://weblog.raganwald.com/labels/java.html">java</a>, <a rel='tag' href="http://weblog.raganwald.com/labels/jobs.html">jobs</a></p>&nbsp;
					<span class="PostFooter">

						&para; <a href="http://weblog.raganwald.com/2006/12/trick-or-bleep.html" title="permanent link">8:14 PM</a>

					 
				</span> 


                                        <p id="postfeeds"></p>

			</div>

			

		
			
				<div class="DateHeader">Sunday, October 15, 2006</div>
			

			<div class="Post"><a name="116096381333418437">&nbsp;</a>
				<span class="PostTitle">

					<a href="http://weblog.raganwald.com/2006/10/in-praise-of-informed-choices.html" title="permanent link">In praise of informed choices</a></span>
					<div style="clear:both;"></div><h4 id="first_a_word_from_our_sponsor">First, a word from our sponsor</h4>You know, this whole “<a href="http://weblog.raganwald.com/2006/10/are-we-blub-programmers.html">Blub</a>” thing has too many negative connotations. It has become, like “Star-Bellied Sneetch,” a way of labeling people.<br /><br />“<em>You use <a href="http://en.wikipedia.org/wiki/J_programming_language">J</a>, therefore you’re a Blub Programmer</em>.”<br /><br />“<em>There’s no such thing as Blub, therefore I can’t be a Blub Programmer</em>.”<br /><br />For the remainder of this post, we are going to discuss things in terms of <em>informed and uninformed choices</em>. This is a functional description and it focuses on a one-time behaviour. If you like the old terms, you know where to find grep.<br /><br />One argument <em>against</em> the idea that there is one overarching continuum of language or tool “power” is that tools <em>specialize</em>. The most appropriate tool for building CRUD database-backed web applications may not be the most appropriate tool for building interactive games.<br /><h4 id="success_through_specialization">Success through specialization</h4>Within a particular specialization, there is still a continuum of power. There may be a programmer who insists that Visual Basic backed ASP pages provide all the power she will ever need for CRUD web applications, and there is no need to Ruby, ASP.NET, or any of the other advances on the technology she likes. This sounds remarkably like she is making an uninformed choice, doesn’t it?<br /><br />The specialization argument is invoked quite often. When I hear it from <a href="http://undefined.com/ia/2006/10/14/blub-blub-blub/" title="Blub, blub, blub">someone who has taken the time to become comfortable with several different approaches to solving a problem</a>, I give it some credence.<br /><br />But how often do we hear someone say, “Oh, language X. Yeah, I hear that’s kind of specialized for Artificial Intelligence. And Y is probably terrific if you need to do some startup thing where you need to make a lot of changes as you go. I haven’t tried it, because I don’t do Y-like stuff. But for <em>my</em> purposes Z is the way to go. Each language has its specialization, and Z is best for what I’m doing.”<br /><br />Are those the words of someone who really understands X or Y and why anyone would need those weird features X and Y programmers boast of? Or what parts of languages X and Y would or wouldn’t apply to the problem at hand? Or is this just a way of sounding <a href="http://weblog.raganwald.com/2006/03/fair-and-balanced-look-at-static-vs.html">Fair and Balanced</a>?<br /><br />Just because tools <em>may</em> provide specialized benefits depending on the problem at hand, that doesn’t mean that the particular tool a programmer chooses is the best possible or best available. In other words, <em>uninformed choice can be local to a problem domain</em>.<br /><h4 id="in_a_fight_between_a_bear_and_an_alligator8230">In a fight between a bear and an alligator</h4>My second conjecture about specialized tool hypothesis is that most tools evolve over time away from specialization and towards generalization. Java, the language often mentioned in the same breath as uninformed choice, began its life as a specialized language for embedded programming. Toasters, set-top boxes, that kind of thing. Other languages have seen the same trend towards trying to solve all problems for all people.<br /><br />The older a language or tool is, the more likely it is a general-purpose tool. The converse tends to be true: the younger a language or tool is, the more likely it is to be specialized. The latter seem to be true even if the designers and sponsors intend it to be a general-purpose tool, because younger tools have smaller ecosystems.<br /><br />Take a language with a relatively small ecosystem: it may have been designed as a general-purpose tool, but if the the most popular stable, widely used libraries and frameworks support <a href="http://www.rubyonrails.com/" title="Ruby on Rails">building Ajax-ified CRUD applications</a>, it is a specialized tool as compared to a language that seems to support building everything up to an including <a href="http://java.sys-con.com/read/193146.htm">interplanetary navigation</a>.<br /><br />So It seems that some languages boast flexibility, others specialization. It seems unrealistic to expect that the specialized language can beat the generalized language. Unless you are comparing the languages on the basis of the specialized language’s “home turf.” In a fight between a bear and an alligator, <em>terrain determines the outcome</em>.<br /><br />Now someone argues, “Hey, you wouldn’t try to fight a fire with a Maserati or drive the Autobahn on a Segway.” The specialization argument. Ok. But is that really the comparison? All too often, I hear that argument, but what I see in the toolbox is a mini-van, the king of popularity, the vehicle that does several different things equally poorly.<br /><br />Honestly. Are programmers clinging to Haskell, Erlang, and Postscript because their needs are specialized and within their niche these languages are the best possible choice? Or are they vocally defending a language that does an awful lot of things in awkward ways against languages that solve their exact problem in an elegant way?<br /><h4 id="remember_java_is_not_an_uninformed_choice_and_neither_is_c">Java is not an uninformed choice, and neither is Visual Basic<br /></h4>Languages and tools are not uninformed. It’s the breadth of experience applied to making a choice that counts. Making a popular, comfortable, established, unfashionable, safe choice does not make you uninformed. An uninformed choice is made in ignorance of the benefits of making other choices.<br /><br />If you think that your next CRUD application would need anywhere from one half the code to one tenth the code if you used a specialized meta-programming tool like Ruby on Rails, but you’re sticking with ASP because that’s what the client asked for, you’re making an informed choice.<br /><br />If you write a new application and make heavy use of functional programming constructs for the first time, good for you. If you choose to leave an existing application more or less as-is and you don’t refactor every method to remove <a href="http://weblog.raganwald.com/2006/10/why-are-local-variables-bad.html" title="Why are local variables bad?">mutable local variables</a>, good for you again. You’re making an informed choice.<br /><br />Some uninformed choices are conservative choices, but so are are some informed choices. You can’t tell the difference merely by examining the language or tool chosen.<br /><h4 id="conservative_or_just_uninformed">Conservative? Or just Uninformed?</h4>I have a little litmus test for identifying an informed choice that just happens to be conservative. I don’t claim it’s infallible, and I have done absolutely no research to back it up. But in the interest of keeping the amusement value up, here is my proposal:<br /><br /><span style="font-style: italic;">When you see a program written in a conservative, “safe” language, and you want to know whether the programmer is a made a fully informed choice, examine the source code looking for evidence that the programmer has been exposed to other programming paradigms.</span><br /><br />Uninformed programmers invariably stick to whatever has been promoted as the sole, orthodox way to write programs for their language. If they need to work around a language limitation, they will do so using well known conventions such as widely disseminated “design patterns.” They can invariable name a dozen or more such patterns, but can never name a single language that handles these problems in a different way.<br /><br />The informed but conservative programmer has learnt something from other tools, other languages. The principles find their way into her work. A conservative programmer might have extremely pragmatic reasons for doing some work in Javascript. But she uses the <a href="http://prototype.conio.net/">Prototype Library</a> to implement higher-order functional programming. Or she might need to build something really big and hairy in C++. But she’ll implement Lisp’s map and reduce as a library so that <a href="http://en.wikipedia.org/wiki/MapReduce" title="MapReduce">C++ programs can vectorize on a grid with thousands of computers</a>.<br /><br />The uninformed programmer may have heard of these things, but not only will they eschew other tools and languages, the eschew the ideas behind them as well.<br /><br />Although <a href="http://en.wikipedia.org/wiki/Greenspun%27s_Tenth_Rule">the act of implementing a more powerful language on top of a more conservative language</a> is sometimes frustrating and often derided by purists, it is a sign that the programmer has thought deeply about the best way to solve a particular problem, and is not afraid to port what they like from one environment to another.<br /><br />What do you think? Do informed but conservative programmers incorporate features and paradigms from other tools and languages into their work?<div style="clear:both; padding-bottom:0.25em"></div><p class="blogger-labels">Labels: <a rel='tag' href="http://weblog.raganwald.com/labels/java.html">java</a></p>&nbsp;
					<span class="PostFooter">

						&para; <a href="http://weblog.raganwald.com/2006/10/in-praise-of-informed-choices.html" title="permanent link">9:52 PM</a>

					 
				</span> 


                                        <p id="postfeeds"></p>

			</div>

			

		
			
				<div class="DateHeader">Thursday, October 12, 2006</div>
			

			<div class="Post"><a name="116068720976582522">&nbsp;</a>
				<span class="PostTitle">

					<a href="http://weblog.raganwald.com/2006/10/are-we-blub-programmers.html" title="permanent link">Are we Blub programmers?</a></span>
					<div style="clear:both;"></div>From time to time I open my email and find someone asking a question:<br /><br /><blockquote>What the hell is Blub? I take from context that it may be a pejorative generalist term for programming languages that encourage writing pablum instead of programs. Or maybe it really is a new language out there that has a huge following I'm unaware of. </blockquote><div style="text-align: right;"><a href="http://chalain.livejournal.com/">Chalain</a>, the "<span style="font-style: italic;">if you're not having fun, you're doing</span><span style="font-style: italic;"> it wrong</span>" guy<br /></div><br /><a style="margin: 0pt 0pt 10px 10px; float: right;" href="http://www.flickr.com/photos/raganwald/15824364/" title="Preparing to climb Lollipop Kids"><img src="http://static.flickr.com/10/15824364_16defaae5e_m.jpg" alt="Preparing to climb Lollipop Kids" border="0" height="240" width="180" /></a>Actually, Blub is a hypothetical programming language Paul Graham invented when describing something very interesting: the <span style="font-style: italic;">Blub Paradox</span>:<br /><br /><blockquote>Blub falls right in the middle of the abstractness continuum... As long as our hypothetical Blub programmer is looking down the power continuum, he knows he's looking down. Languages less powerful than Blub are obviously less powerful, because they're missing some feature he's used to. But when our hypothetical Blub programmer looks in the other direction, up the power continuum, he doesn't realize he's looking up. What he sees are merely weird languages... Blub is good enough for him, because he thinks in Blub.</blockquote><div style="text-align: right;">Paul Graham, <a href="http://www.paulgraham.com/avg.html">Beating the Averages</a><br /></div><br />The interesting things about this paradox is that almost <span style="font-style: italic;">any</span> language could be Blub. The pre-requisites for a language being Blub are (a) there is at least one language less powerful than Blub, (b) there is at least one language <span style="font-style: italic;">more</span> powerful than Blub, and (c) that there be at least one programmer using Blub who accepts (a) but refutes (b) because he or she cannot see how the more powerful language is more powerful. She does not think in the <a href="http://www.braithwaite-lee.com/weblog/2006/01/finding-signal-to-noise-ratio-in-never.html">idioms</a> that the more powerful language affords.<br /><br /><div style="margin: 0pt 10px 10px 0pt; width: 240px; float: left; text-align: center; font-size: 85%;"><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://www.amazon.com/gp/redirect.html?ie=UTF8&location=http%3A%2F%2Fwww.amazon.com%2FLittle-MLer-Matthias-Felleisen%2Fdp%2F026256114X%2Fsr%3D1-1%2Fqid%3D1165759722%3Fie%3DUTF8%26s%3Dbooks&amp;amp;amp;amp;tag=raganwald001-20&linkCode=ur2&amp;camp=1789&creative=9325"><img style="cursor: pointer;" src="http://weblog.raganwald.com/uploaded_images/little_mler-705423.jpg" alt="" border="0" height="180" width="180" /></a><em><br /><br />The Little MLer introduces ML (and Ocaml) through a series of entertaining and straightforward exercises leading up to the construction of the Y Combinator.<br /><br />ML and OCaml introduce powerful strong typing and type inference. Both are great languages to learn: you will stretch your understanding of defining types and writing correct programs.<br /></em></div>When <span style="font-style: italic;">I</span> use the term, I am thinking of the language and also the programmers around it. Could Java be Blub? Sometimes, possibly often, but only when I'm thinking about Java programmers who dismiss Ruby's features as unnecessary. <a href="http://t-a-w.blogspot.com/2006/08/programming-in-blub.html">Could Ruby be Blub</a>? Sometimes, but only when I'm thinking about Ruby programmers who dismiss macros as unimportant.<br /><br /><a href="http://weblog.raganwald.com/2006/12/lisp-is-not-last-word.html">Could Lisp be Blub?</a> I suspect that Erlang and Haskell programmers might say that it is, provided we can find a Lisp programmer who feels that all progress in programming languages stopped when Common Lisp was standardized.<br /><br />At the same time, Java is not Blub when I am thinking of programmers <a href="http://weblog.raganwald.com/2006/10/in-praise-of-informed-choices.html">who are perfectly aware of its shortcomings and deliberately Greenspun around them for pragmatic reasons</a>. The same goes for any other language: it is sometimes Blub, and sometimes not Blub.<br /><br />So... I use the term "Blub" to refer to a programming language in the context of intransigent programmers who feel that their chosen tool is the best tool possible.<br /><br /><blockquote>Programming consists of overcoming two things: accidental difficulties, things which are difficult because you happen to be using inadequate programming tools, and things which are <em>actually difficult</em>, which no programming tool or language is going to solve. </blockquote><div style="text-align: right;"><a href="http://www.joelonsoftware.com/items/2006/10/12.html">Joel Spolsky reviewing Beyond Java<br /></a></div><br />This provokes a very obvious question: <span style="font-style: italic;">How do we know which things are accidentally difficult and which are actually difficult</span>? Is it only because we haven't discovered the right tool yet?<br /><br />It's easy to find a Java programmer who believes that all of the Design Patterns in the GoF's book are necessary. She believes that the difficulties of applying those patterns are actual difficulties of programming systems. It is only when she learns a different language that she realizes how the patterns were strongly driven by limitations in Java's object model.<br /><br />At that point she has an epiphany and understands that what she thought were actual difficulties were merely accidental difficulties. And the line between "accidental" and "actual" moves for her.<br /><br />No matter how much each us us thinks we know right now, are we nevertheless like this Java programmer, unable to see the difference between accidental and actual differences because we simply haven't discovered a more powerful tool?<br /><br />Are we Blub programmers?<br /><br /><span style="font-size:85%;"><span style="font-style: italic;">update</span>: <a href="http://weblog.raganwald.com/2006/10/in-praise-of-informed-choices.html">In praise of informed choices</a> and </span><a href="http://weblog.raganwald.com/2006/12/lisp-is-not-last-word.html">Lisp is not the last word</a><div style="clear:both; padding-bottom:0.25em"></div><p class="blogger-labels">Labels: <a rel='tag' href="http://weblog.raganwald.com/labels/java.html">java</a>, <a rel='tag' href="http://weblog.raganwald.com/labels/lispy.html">lispy</a>, <a rel='tag' href="http://weblog.raganwald.com/labels/popular.html">popular</a></p>&nbsp;
					<span class="PostFooter">

						&para; <a href="http://weblog.raganwald.com/2006/10/are-we-blub-programmers.html" title="permanent link">4:40 PM</a>

					 
				</span> 


                                        <p id="postfeeds"></p>

			</div>

			

		
			
				<div class="DateHeader">Sunday, October 08, 2006</div>
			

			<div class="Post"><a name="116033648506034653">&nbsp;</a>
				<span class="PostTitle">

					<a href="http://weblog.raganwald.com/2006/10/if-sneetches-with-stars-use-java-and.html" title="permanent link">If Sneetches with Stars use Java, and Sneetches without Stars use Ruby, who uses ML?</a></span>
					<div style="clear:both;"></div><a href="http://en.wikipedia.org/wiki/ML_programming_language">ML</a> is a programming language featuring <a href="http://en.wikipedia.org/wiki/Type_inference">type inference</a>: you don’t have to encumber your code with type declarations, the compiler can figure them out for you. So… are type inference languages like ML for Sneetches <a href="http://steve-yegge.blogspot.com/2006/10/egomania-itself.html">with or without stars</a>? Or another kind of Sneetch entirely?<br /><br /><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://www.amazon.com/Sneetches-Other-Stories-Classic-Seuss/dp/0394800893/s?ref=raganwald001-20"><img style="display:block; margin:0px auto 10px; text-align:center;cursor:pointer; cursor:hand;" src="http://weblog.raganwald.com/uploaded_images/sneetches-711589.jpg" border="0" alt="" /></a><blockquote style="font-style: italic;">Now, the Star-Belly Sneetches had bellies with stars.<br />The Plain-Belly Sneetches had none upon thars.<br />Those stars weren’t so big. They were really so small<br />You might think such a thing wouldn’t matter at all.</blockquote><span style="font-style: italic;font-size:85%;" >Update</span><span style="font-size:85%;">: More than a few people have <a href="http://empathybox.com/archives/7">written</a> that Steve Yegge's association of static typing with neatness and dynamic typing with slovenliness runs opposite to their impressions of the kinds of people who strongly prefer one or the other. I used Steve's terms in the original post, partly because I thought people would get the same joke I thought Steve was making. It looks like they don't, nobody wrote to say "LOL." I have changed the terms to something that represents what I think of the cultural divide between programmers who like Java and programmers who like Ruby.</span><br /><br />Let’s review. Sneetches with stars like to use a colour-coded label maker to label the drawers, boxes, and files in their office. Once glance at everything and you know what it holds. Sneetches with stars add extra labels even when you don’t need them. For example, if a box is labeled ‘tax receipts’, each piece of paper inside has a post-it note saying tax receipt’, even if it’s obviously a tax receipt and lives inside the tax receipts box.<h4 id="what_is_stariness">What is Stariness?</h4>Sneetches with stars like these languages we say are <em>statically typed</em>. What do we mean by the word static? We mean <em>it can be resolved at compile time</em>. Other words for this idea are <em>invariant</em> or <em>constant</em>. Sneetches with stars like languages where the type of each entity can be resolved at compile time.<br /><blockquote>Some people are always critical of vague statements. I tend rather to be critical of precise statements; they are the only ones which can correctly be labelled "wrong."</blockquote><div style="text-align: right;">Raymond Smullyan<br /></div><br />Let’s dive into this a little deeper. (My apologies to my readers who were actually paying attention to the stuff in first year computer science that isn’t a requirement for <a href="http://weblog.raganwald.com/2005/07/why-you-need-degree-to-work-for-bigco.html">getting a job at BigCo</a>.) What does it mean when we say “something can be resolved at compile time”? That expression is laden with implementation details like assuming we’re using a compiler. But it’s a convenient short-hand for saying <em>something about the program that is true every time you run the program</em>.<br /><br />Consider the <code>final</code> declaration in Java. If you write:<br /><pre><code>final String snafu = "situation normal...";<br /></code></pre>We know that the variable <code>snafu</code> always holds a reference to the constant string <code>"situation normal..."</code>. No matter what data you feed to your program and how you mangle it, <code>snafu</code> will always be <code>"situation normal..."</code>. Do you agree? (Joe Campbell, put your hand down. Yes, there is a back door way you can change the contents of a <code>String</code> in Java.)<br /><br />Java can take advantage of this to perform <em>constant propagation</em>. Everywhere you write <code>snafu</code>, Java can substitute <code>"situation normal..."</code> and throw away the variable lookup. To get away from arguing about back doors in the <code>String</code> class, let’s consider one of the primitive types, a <code>boolean</code>. If you write:<br /><pre><code>final boolean foo = true;<br />    // code without assignments to foo<br />    if (foo) {<br />        // do something<br />    }<br />    else {<br />        // do something else<br />    }<br /></code></pre>Wouldn’t you agree that the compiler can get rid of the variable lookup and the <code>if</code> statement? The path through the code is always through the <code>// do something</code> path every time you run the program.<br /><br />Now back to the word <em>stariness</em>. We really mean <em>the amount of stuff about the program that can be resolved at compile time</em>, or if you prefer, <em>the amount of stuff that is true every time you run the program</em>.<br /><br />In the example above, the compiler can figure out which branch the program will follow at compile time, because that variable is true every time you run the program.<br /><br />Stuff that is always true is useful. For most programs, we have an idea in our head about “correctness.” What we mean when we talk about a program being correct is that it produces desirable results every time you run the program.<br /><blockquote>A formalist is one who cannot understand a theory unless it is meaningless.</blockquote>Stariness is thus similar to correctness. And that’s why a lot of people, the Sneetches with stars, are obsessed with it. Being able to “prove” something about their program (“the method call <code>foo.bar(5)</code> never throws a <code>MethodNotImplemented</code> exception”) feels a lot like being able to prove that their program is correct.<br /><br />It feels a lot like it, but it isn’t the same thing. The reason it isn’t the same thing is that while its true that a program throwing <code>MethodNotImplemented</code> exceptions is probably not correct, it’s not true that a program that doesn’t throw such exceptions <em>is</em> correct. It just feels, somehow, more likely to be correct because we’ve thrown out one of the infinite ways it can be incorrect.<br /><br />Now that we’ve dispatched that logically, let’s be clear about something: just because stariness does not enforce correctness, it doesn’t mean that stariness isn’t <strong>useful</strong>. Stariness is useful. Period, no debate.<h4 id="back_to_inferences">Back to inferences</h4>Type inference is also for Sneetches with stars.  A language with type inference resolves the type of each entity at compile time by inspecting the program and figuring the types out through inspection. It’s a lot like the way a compiler can look at the Java code above and figure out that you always <code>// do something</code> and you never <code>// do something else</code>. The code looks sorta like you could go either way, but the compiler knows better.<br /><br /><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://www.amazon.com/gp/redirect.html?ie=UTF8&location=http%3A%2F%2Fwww.amazon.com%2FLittle-MLer-Matthias-Felleisen%2Fdp%2F026256114X%2Fsr%3D1-1%2Fqid%3D1165759722%3Fie%3DUTF8%26s%3Dbooks&tag=raganwald-store-20&linkCode=ur2&camp=1789&creative=9325"><img style="float:left; margin:0 10px 10px 0;cursor:pointer; cursor:hand;" src="http://weblog.raganwald.com/uploaded_images/little_mler-705423.jpg" border="0" alt="" /></a>Languages with type inference look like variables can have any type, but the compiler knows better. Remember the labels that the verbose declaration Sneetches with stars love? Type inference languages still have labels, but the labels are hidden inside of the files and boxes where you can’t see them.<br /><br />Remember when manufacturers used to put their labels <em>inside</em> clothes instead of right across the front? Same thing. The rules for what goes where are strictly enforced, it’s just that if you can figure out what goes where with a bit of common sense, you don’t need a label or a post-it note.<br /><br />Compare these two snippets of Java:<br /><pre><code>final String[] words = { "foo", "bar", "blitz" };<br />final int word_length = words.length;<br />final String[] anagrams = new String[word_length];<br /></code></pre>…and…<br /><pre><code>final words = { "foo", "bar", "blitz" };<br />final word_length = words.length;<br />final anagrams = new String[word_length];<br /></code></pre>Hey, if a variable is final, we can figure out its type in Java through simple inspection. Making that work in the compiler is something an intern ought to be able to do over a Summer work term!<br /><br /><span style="font-size:85%;">(Frank Atanassow pointed out that techniques exist for inferring the types of nearly all Java variables through inspection of programs. But this simple case is enough for our purposes.)</span><br /><br />So if we take a valid Java program and simply erased type declarations whenever we could logically deduce the type of the variables (using our simple scheme), but left them in whenever we were not sure of the final type of the variables, we would have exactly the same program. Nothing about it has changed except it has fewer symbols. It’s just as starry, it is just as static, it is no more or less correct than it was before we erased some symbols.<br /><br />And you over there itching to say something about IDE refactorings and auto-completions: None of those go away either. You can rename things and move things and press command-tab to get an object’s methods whenever you like. So… would you agree that type inference of this sort doesn’t change a starry program into a starless program? This isn’t about stariness versus starlessness, it’s about the obsessive-compulsive desire to label everything.<br /><br />The bottom line: <em>type inference does not change a statically typed language into a dynamically typed language</em>. It’s still starry.<h4 id="so_why_can8217t_the_Sneetches without stars_use_type_inference">So why can’t the Sneetches without stars use type inference?</h4>Think of types as being like values and objects like variables. A statically typed language is one where there are no type re-assignments. Some languages enforce this. But if you write a program in a static way, you can still reason about it. This is why lots of people think that we can “neaten up” languages like Ruby by adding type inference to the compiler: they're thinking about programs that are neat to begin with, but we happen to have written them in a language for Sneetches without stars.<br /><br />And whenever someone talks about a refactoring IDE or an auto-completing IDE for a dynamic language, they’re talking about performing some type inference on Ruby programs that are written in a static way. So… what’s the holdup? We said we could add type inference to Java in a Summer. Where’s the intern to add it to Ruby?<br /><blockquote>Programmed. In me somewhere, he thought, there is a matrix fitted in place, a grid screen that cuts me off from certain thoughts, certain actions. And forces me into others. I am not free. I never was, but now I know that; that makes it different.</blockquote><div style="text-align: right;">Philip K. Dick, "The Electric Ant"<br /></div><br />The problem is that the set of all programs that are "starry" is a subset of the set of all programs that parse correctly. So either not all starless programs are neat, or not all portions of a starless program are neat, or both.<br /><br />Let’s compare back to our Java snippet. Remember:<br /><pre><code>final boolean foo = true;<br />// code without assignments to foo<br />if (foo) {<br />    // do something<br />}<br />else {<br />    // do something else<br />}<br /></code></pre>The compiler could infer that we always follow the first branch because it knows that final variables are not reassigned. They’re <em>immutable</em>. What happens if we erase the <code>final</code> keyword as well:<br /><pre><code>boolean foo = true;<br />// code that might have assignments to foo<br />if (foo) {<br />    // do something<br />}<br />else {<br />    // do something else<br />}<br /></code></pre>Now the job is much harder. We have to examine all the code in between the declaration and the use of foo. If there are any assignments involving things we can't know until runtime, we can't know the value of foo until runtime.<br /><br />For a very large class of programs, we cannot infer the contents of a variable with less runtime complexity than running the program for every possible input. This is why compilers have limitations on the optimizations they can perform, and humans still need to do some thinking about writing fast programs.<br /><br />This exact same thing happens with types. In statically typed languages, types are never re-assigned. Whether explicitly declared or inferred, they're immutable. But in languages like Ruby where methods can be added and removed dynamically, where messages can be forwarded dynamically, where we can even send messages dynamically, the types of objects are fully mutable.<br /><br />In starless languges, there is no <code>final</code> keyword on the types of objects. We can no longer infer the type of a variable in any but the simplest, degenerate cases.<br /><br />The type inference problem in dynamically typed languages is exactly the same as the inferring the possible contents of a variable problem. The inferring the contents of a variable problem is doable for a restricted set of programs. And the way we tell the compiler that a variable is a member of this restricted set is with the <code>final</code> keyword.<br /><br />Likewise, the way we tell a compiler that the type of a variable is also restricted is that we use a language where the type of every variable is final. It’s the same thing: we don’t reassign final variables and we don’t change types on the fly.<br /><br />Starlessness is not about writing programs without labels. Starlessness is when you write dynamic programs. Dynamic doesn’t mean ‘unlabeled’. As I showed above, if the <code>final</code> keyword is there, the label is mostly optional. But if you don’t have <code>final</code>, you’re writing dynamic programs.<br /><br />Truly starless programs have dynamic types: <em>types that change at run time</em>. they are not always one thing or another. For example, what if you write an Object-Relational Mapper (“ORM”) that reflects on the database structure at run time. That is, you can change columns in a database table and you get new getters and setter methods in your program. <em>Without recompiling</em>.<br /><br />In a fully static language (with or without type inference), you can’t do that. Think of Java’s JDBC: you have to fool around with methods that get values and pass a column name as a parameter. Or maybe you create a hash. And C# is getting this capability, but of you look closely you still have to define the “type” of a query through the LINQ syntax.<h4 id="are_neat_freaks_ever_starless">Are Sneetches with stars ever starless?</h4>A dynamically typed language lets us define an object holding a database row with methods for each column. But we can’t know at compile time whether our program will throw a <code>MethodNotImplemented</code> exception because we don’t know whether someone will monkey with the database structure. That sounds bad.<br /><br />But what happens if you write the same thing in a neat program? Aha! a <code>SQLException</code>! it seems that there are dynamic things that must be dynamic no matter what you do.<br /><br />This is a specific case of Greenspunning. There are some facilities of dynamic languages that you are going to need. If you don’t have them built into your static language, you will build them yourself or use a framework that has already built them for you. Other examples I have seen in Java programs include:<br /><br />Spring and Hibernate;<br />Any use of <code>Class.forName(...)</code>;<br />Any use of dynamic proxies;<br /><br />In essence, you’re being a Sneetch without a star but twisting your starry language to permit starlessness. And for those portions of the program that are no longer nice, starry bundles that can be examined at compile time for invariant behaviour, you are indeed in dynamic territory and have to live with the risks.<br /><br />In my experience, all non-trivial starry programs contain this kind of starlessness. To my admittedly inexperienced eyes, starlessness is the hallmark of expert programming in starry languages ("expert" does not necessarily mean "more desirable," especially in the minds of those who believe that programs should be written and maintained by mediocre developers).<h4 id="eating_cake">Eating cake</h4>So… can we say that since you can write starless programs in neat languages, you can have the useful benefits of stariness when you need it and the flexibility of starlessness when you need that too? Isn’t that better?<br /><br />Yes, you <em>can</em> say that. And you may be right, for you. The <a href="http://boo.codehaus.org/Language+Guide">Boo</a> people believe that: their language has a <code>duck</code> keyword for when you feel like a Sneetch without a star. Be aware that at this moment in history, languages designed for Sneetches without stars seem to have much better features for writing starless programs than languages for Sneetches with stars. So my observation is this:<br /><br /><em>If you dislike the verbosity of starry languages like Java but like the feeling of safety, try a type inference language. Don’t go to a starless language if you don’t intend to actually write dynamically typed programs.</em><br /><br />My experience is that if you are frustrated by the amount of work you have to do to express the algorithms in your head, you should look at a language that removes your frustration. If you're using Java and don't like the verbosity, find a language that celebrates brevity while preserving static typing. But if you're using Java and find yourself pushing more and more logic out of java because its type system is too static or too inflexible, you should consider a language with a different approach to typing.<br /><blockquote>Computer languages differ not so much in what they make possible, but in what they make easy. </blockquote><div style="text-align: right;">Larry Wall<br /></div><h4 id="why_would_the_Sneetches without stars_use_starless_languages">Why would the Sneetches without stars use starless languages?</h4><em>Writing starless programs on top of neat languages is exactly the same thing as writing automatic memory management routines on top of a manually managed programming language or writing functional programs on top of a noun-centric object-oriented language.</em><br /><br />You can take that statement as an argument in favour of specialized languages for Sneetches without stars or as an argument against them. My guess is that the above statement is true and a Rorschach Inkblot: You will interpret it as confirmation of your existing prejudices.<div style="clear:both; padding-bottom:0.25em"></div><p class="blogger-labels">Labels: <a rel='tag' href="http://weblog.raganwald.com/labels/java.html">java</a>, <a rel='tag' href="http://weblog.raganwald.com/labels/popular.html">popular</a>, <a rel='tag' href="http://weblog.raganwald.com/labels/ruby.html">ruby</a></p>&nbsp;
					<span class="PostFooter">

						&para; <a href="http://weblog.raganwald.com/2006/10/if-sneetches-with-stars-use-java-and.html" title="permanent link">3:34 PM</a>

					 
				</span> 


                                        <p id="postfeeds"></p>

			</div>

			

		
			
				<div class="DateHeader">Thursday, June 01, 2006</div>
			

			<div class="Post"><a name="114917186438474759">&nbsp;</a>
				<span class="PostTitle">

					<a href="http://weblog.raganwald.com/2006/06/trade-off-between-power-and-ease-of.html" title="permanent link">The trade-off between power and ease of use in library interfaces</a></span>
					<div style="clear:both;"></div>Rusty has <a href="http://cafe.elharo.com/java/the-three-reasons-for-data-encapsulation/">another great contribution</a> to the discussion about locking down interfaces (a/k/a "final good or bad" also a/k/a "concrete good, abstract bad").<br /><br /><style type="text/css">.flickr-photo { border: solid 2px #000000; }.flickr-yourcomment { }.flickr-frame { text-align: left; padding: 3px; }.flickr-caption { font-size: 0.8em; margin-top: 0px; }</style><div class="flickr-frame"> <a href="http://www.flickr.com/photos/raganwald/15825475/" title="The roof problem Novocaine in Canada's Niagara Glen"><img src="http://static.flickr.com/14/15825475_96478ff3af.jpg" class="flickr-photo" alt="" /></a><br /><span class="flickr-caption"><a href="http://www.flickr.com/photos/raganwald/15825475/">The roof problem Novocaine in Canada's Niagara Glen</a>.</span></div>    <p class="flickr-yourcomment"> </p>Rusty points out that restricting an API makes it more accessible:<br /><blockquote style="font-style: italic;">The I in API stands for interface, and interfaces are for people, not just machines. APIs can be complex, confusing things... The smaller and simpler the API is, the easier it is to learn and use; the more likely it is that the API will be used correctly.</blockquote>I'm going to repeat and double underscore my suggestion that there are different approaches to the problem of designing software that other programmers must incorporate into their own designs.<br /><br />Rusty points out the obvious: there is a far greater 'market' for smaller and simpler things than for powerful things:<br /><blockquote style="font-style: italic;">For instance, you can switch a class from storing persistent data in a file to storing it in a database or vice versa. Sometimes this is important; but be honest: how many times have you really needed to do this? Out of the thousands of classes youÂve written, how many have had significant changes in their internal data structures? Maybe 1 in 10? And in how many have you actually needed multiple simultaneous implementations? Maybe 1 in 100, or less?</blockquote>True. But ummm... Does it matter whether you want to do something like this once a day, once a week, one a month, or once during a project? If you ever want to do this, why shouldn't it be possible?<br /><br />Let me jump in and answer the question for you: <span style="font-weight: bold;">there's a trade off to be made between power and ease of use</span>. The power to do unusual things (like climb roof cracks or modify frameworks) comes at the expense of ease of use (as measured by the narrowness of the interface).<br /><br />So if you make it possible for me to do powerful things, you might make your code harder to use for some class of people who never need to do these things. I'm all for that. There's a knob you can turn when you create your design: power vs. accessibility for the masses.<br /><br />(I don't say power vs. simplicity: thanks to the <a href="http://weblog.raganwald.com/2004/10/beware-of-turing-tar-pit.html">Turing Tar Pit</a>, it is possible to make something extremely simple, but have extraordinary power because you have provided the basic building blocks that allows your client programmer to do almost anything. For example, the programming language Scheme has just five 'special forms'. Almost all of the resulting power in the language, including the ability to define new Domain Specific Languages, comes from the way these five elements can be combined to create new forms.)<br /><br />I really think it comes down to thinking about your 'clientele' when you design frameworks or libraries. Remember that this started with someone calling for the final keyword to be deprecated from the Java language. C'mon. Java.<br /><br />Think about the Java programming culture for a moment. If I were writing a Java library for widespread use, I would consider Rusty's position carefully. After all, most of the people who would lament any restrictiveness have probably <a href="http://www.amazon.com/gp/product/0596100949/103-3202428-9460615?n=283155">bailed and are hacking rails</a> right now. But the remaining Java folks want their IDE and their compiler to catch all of their bugs for them. So if you 'cut against the grain', you provide power nobody wants at the expense of the simplicity they need to be productive in their environment.<br /><br />But if I were writing a Rails plugin... wait! You couldn't write a Rails plugin if DHH had locked rails down to begin with. Anyways, anything you do in the Ruby world should be far more open. You have a different clientele, with a different culture. It's really that simple.<br /><br />Of course, there's a trivial argument that all that 'powerful but unrestricted stuff' only works in small teams. That once you have 100+ programmers hacking on something you need more safeguards than a Missile Silo.<br /><br />All I can say in response is that (1) everything that has ever impressed me in software was done by small teams, not big ones. Just <a href="http://folklore.org/index.py">twenty-nine people created the entire Macintosh computer</a>, for example. And (2) given that productivity diminishes sharply with team size, shouldn't we be trying to find ways to make big teams smaller, such as by giving them more powerful tools?<br /><br />So I think that for a different programming culture, with a different kind of client programmer, you want and need to follow a different design philosophy that emphasizes trusting your client and providing as much power and flexibility as possible.<br /><br />This isn't a 'bad practice you can get away with in a small team' any more than rear-wheel drive and a manual transmission are bad engineering choices that you can get away with if a driver actually knows how to drive. Or than Scrum is a bad practice you can get away with if your team is gelled and motivated. They are appropriate choices under specific circumstances for a specific clientele that has the requisite skills and attitude. <span style="font-style: italic;">This is my theory</span>.<br /><br /><span style="font-weight: bold;">Conclusion</span>:<br /><br />So you ask me, is my theory bad? And I reply with a question, <span style="font-weight: bold;">for whom</span>?<div style="clear:both; padding-bottom:0.25em"></div><p class="blogger-labels">Labels: <a rel='tag' href="http://weblog.raganwald.com/labels/java.html">java</a></p>&nbsp;
					<span class="PostFooter">

						&para; <a href="http://weblog.raganwald.com/2006/06/trade-off-between-power-and-ease-of.html" title="permanent link">10:21 AM</a>

					 
				</span> 


                                        <p id="postfeeds"></p>

			</div>

			

		
			
				<div class="DateHeader">Tuesday, May 30, 2006</div>
			

			<div class="Post"><a name="114900010849166152">&nbsp;</a>
				<span class="PostTitle">

					<a href="http://weblog.raganwald.com/2006/05/reg-suffering-from-high-altitude.html" title="permanent link">Reg suffering from high-altitude hypoxia?</a></span>
					<div style="clear:both;"></div>Respected Java and XML Guru <a href="http://www.elharo.com/">Elliotte Rusty Harold</a> has posted <a href="http://cafe.elharo.com/java/eliminating-final/">a very nice discussion of Eiffel's Design by Contract principles</a>. Along the way, he makes a vicious ad hominem attack, accusing me of architecture astronautics (he actually stooped to using using the word "theorist," which means, <span style="font-style: italic;">someone who blogs when they should be coding</span>). But I digress.<br /><br /><a href="http://www.flickr.com/photos/raganwald/152207513/"><img src="http://static.flickr.com/46/152207513_b3be666020.jpg" width="375" height="500" alt="The World's Longest Single Arch Bridge" /></a><br /><br />The gist of his post is that since we don't have language-level support for Design By Contract, we ought to use <span style="font-weight: bold;">final</span> to accomplish as much invariant enforcement as possible. He suggests that final should be the default choice, that interfaces should be rare and concrete classes plentiful in a design, and that support for polymorphism is less-important than enforcing invariants:<br /><blockquote style="font-style: italic;">Preconditions, postconditions, and invariants are at the core of data encapsulation. They are the first and most important pillar of object oriented programming. Inheritance and polymorphism are second and third respectively, and are less important.</blockquote>While controversial, this argument is cogent. I would say it is consistent with a specific kind of design philosophy, one that would be as at home in Ada or Modula as it is in Java. This is in marked opposition to the design philosophy of SmallTalk and Squeak, so I would say it is <span style="font-style: italic;">not very object oriented</span>.<br /><br />Is that a bad thing? <span style="font-weight: bold;">I don't think so</span>. Principles like data encapsulization, modularity, contract enforcement, and componentization are extremely valuable and can be realized in many different ways. For example, what do you think the <a href="http://www.erlang.org/">Erlang</a> programming language or the <a href="http://en.wikipedia.org/wiki/Linda_%28coordination_language%29">Linda</a> communication and co&ouml;rdination frameworks are are all about? It's not just concurrency, dude.<br /><br />The large-scale Java applications I've seen have been particularly devoid of true object orientation, and people seem perfectly happy with that. (Rough metric: the OO-ness of a Java application is congruent to the reciprocal of the number of public static methods in the source code).<br /><br />So my conclusion is that if you want some advice on writing robust, large scale Java applications in a style that has been proven to be useful over the last several decades, you will find Rusty's post informative.<br /><br />p.s. My tongue was in my cheek when I composed the title and suggested that one of the most socially conscious Java bloggers in the world was vicious. But you knew that.<br /><br />p.p.s. If you feel that either Rusty or I can be correct but not both of us, please accept my condolences. How long has it been since imagination passed out of your life?<div style="clear:both; padding-bottom:0.25em"></div><p class="blogger-labels">Labels: <a rel='tag' href="http://weblog.raganwald.com/labels/java.html">java</a></p>&nbsp;
					<span class="PostFooter">

						&para; <a href="http://weblog.raganwald.com/2006/05/reg-suffering-from-high-altitude.html" title="permanent link">10:03 AM</a>

					 
				</span> 


                                        <p id="postfeeds"></p>

			</div>

			

		
			
				<div class="DateHeader">Thursday, May 25, 2006</div>
			

			<div class="Post"><a name="114856931325471522">&nbsp;</a>
				<span class="PostTitle">

					<a href="http://weblog.raganwald.com/2006/05/ready-aim-final.html" title="permanent link">Ready, Aim, Final</a></span>
					<div style="clear:both;"></div>There're <a href="http://www.sphericalimprovement.com/blogs/mbowler/exit.php?url_id=1042&entry_id=352">some</a> <a href="http://cafe.elharo.com/java/final-good/">interesting</a> <a href="http://www.cincomsmalltalk.com/blog/blogView?showComments=true&amp;entry=3325941352">rants</a> going on about Java's <span style="font-weight: bold;">final</span> keyword. And Mike Bowler does a decent job of <a href="http://www.sphericalimprovement.com/blogs/mbowler/archives/352-Weighing-in-on-final.html">explaining what final </a><a href="http://www.sphericalimprovement.com/blogs/mbowler/archives/352-Weighing-in-on-final.html">does</a>. As Mike points out, all of the ranting is about whether you should declare classes and methods final.<br /><br />The arguments against declaring classes and methods final are persuasive. It makes it really hard to unit test anything. You are putting future programmers in a straightjacket (that's actually part of the spirit of bondage and discipline languages like Java, but that doesn't mean it's a good idea). And some refactoring becomes impossible.<br /><br />When I look at these arguments, I see evidence of a deeper malaise. The problem isn't the final keyword. The problem is <span style="font-style: italic;">the lack of separation between interfaces and implementations</span>.<br /><br />Take <span style="font-weight: bold;">java.lang.String</span>. This class is final, and that is a royal PITA. If you want to extend String to do neat things like keep track of SQL injection safety you are SOL. Now if there was a String <span style="font-style: italic;">interface</span>, and everyone declared their instance variables with the interface instead of the implementation, there would be no problem with a final String class.<br /><br />Do you need a flag for whether the String is SQL-safe? Use delegation instead of inheritence. No problem. Do you need pluggable storage behaviours for handling special character sets? Use aggregation and a Strategy pattern.<br /><br />Separating the String interface from the String implementation solves our problems nicely.<br /><br />I'm 100% ok with the final keyword in implementations. I think it's ok to make a class and say, this is the FizbangImplementationClass. For example, if you were making a sort class for some reason, it would be a little weird to override the actual sort algorithm. If you do, maybe it isn't really a-kind-of FizbangImplementationClass, so it shouldn't extend that base class. It ought to <span style="font-style: italic;">conform to the same interface but be implemented as something else</span>.<br /><br />At no time in the near future will I be proposing JSR666, "How to fix the Java language so that you can write elegant, object-oriented code." But if I do, my suggestion will be to <span style="font-style: italic;">make every class an interface automatically</span>. (This is not an original idea.)<br /><br />Here's how it would work. We keep all of the existing syntax exactly as we have it. But the first addition is that you can have class A implement class B. Note that class B is a class, not an interface. This means class A acquires the public members of class B but not their implementations. Now you can 'override' to your heart's content. The final keywords do not affect this, because you are actually implementing an interface.<br /><br />Is this bad? I don't think so. Framework authors that declare methods final are usually trying to ensure some consistency within a class. If you are implementing the class instead of extending it, you can build it from the ground up. If you need some of the class's behaviour you can use delegation and the orginal class will retain its original behaviour.<br /><br />The second addition is that when you declare a variable to be of a certain class, you are naturally declaring it to be the interface of the class. So anything declared as a String is actually declared as the String interface, not the String class.<br /><br />(There are other, subtle changes that are needed. Should String.class refer to the class and String.interface refer to the interface separately? Order plenty of espresso and let the committee thrash this kind of question out).<br /><br />This could be all accomplished within the current language if everyone was disciplined about declaring interfaces. However, Gosling and Steele set the tone for the Java language when the original libraries contained precious few interfaces and tons of classes. I think it's too late to get everyone to change. So some language change is needed to handle the zillions of lines of existing code.<br /><br />Or, you could take another approach and eschew languages that deliberately restrict your expressiveness. It's a big world out here, and it would be a shame if you don't get out from behind your desk and travel once in a while :-)<br /><br /><span style="font-style: italic;">Updates: Elliote Rusty Harold <a href="http://cafe.elharo.com/java/eliminating-final/">triple-underscored his support for the final keyword, while suggesting that interfaces are mostly bad</a>, and <a href="http://weblog.raganwald.com/2006/05/reg-suffering-from-high-altitude.html">I responded with respect for our differences</a>.<br /><br />Then Rusty provided some <a href="http://cafe.elharo.com/java/the-three-reasons-for-data-encapsulation/">excellent reasons for locking interfaces down</a> in his designs, and I explained why I believe there're <a href="http://weblog.raganwald.com/2006/06/trade-off-between-power-and-ease-of.html">legitimate reasons to choose Rusty's approach for some programmers and more flexibility for others</a>.<br /></span><div style="clear:both; padding-bottom:0.25em"></div><p class="blogger-labels">Labels: <a rel='tag' href="http://weblog.raganwald.com/labels/java.html">java</a>, <a rel='tag' href="http://weblog.raganwald.com/labels/popular.html">popular</a></p>&nbsp;
					<span class="PostFooter">

						&para; <a href="http://weblog.raganwald.com/2006/05/ready-aim-final.html" title="permanent link">10:28 AM</a>

					 
				</span> 


                                        <p id="postfeeds"></p>

			</div>

			

		<script type="text/javascript" src="http://www.blogger.com/static/v1/common/js/327583163-csitaillib.js"></script>


	</div>







	<div id="rightcontent">

		<div class="SideBarTitle"><a href="http://reginald.braythwayt.com">Reg Braithwaite</a></div>

		<br />

		<br />

		<div class="SideBarTitle">Recent Writing</div>

                <a href="http://homoiconic.com">Homoiconic</a>

		<br/>

		<br/>

		<div class="SideBarTitle">Share</div>

                <a href="http://github.com/raganwald/rewrite_rails">rewrite_rails</a> /

                <a href="http://github.com/raganwald/andand">andand</a> /

                <a href="http://raganwald.com/source/unfold.rb.html">unfold.rb</a> /

                <a href="http://raganwald.com/source/string_to_proc.rb.html">string_to_proc.rb</a> /

                <a href="http://raganwald.com/source/dsl_and_let.html">dsl_and_let.rb</a> /

                <a href="http://raganwald.com/source/comprehensions.html">comprehension.rb</a> /

                <a href="http://raganwald.com/source/lazy_lists.html">lazy_lists.rb</a>

		<br />

		<br />

		<div class="SideBarTitle">Beauty</div> <!-- idioms -->

		<a href="http://weblog.raganwald.com/2008/04/is-strictly-equivalent-to.html">IS-STRICTLY-EQUIVALENT-TO-A</a> /

		<a href="http://weblog.raganwald.com/2008/03/spaghetti-western-coding.html">Spaghetti-Western Coding</a> /

		<a href="http://weblog.raganwald.com/2007/12/golf-is-good-program-spoiled.html">Golf is a good program spoiled</a> /

		<a href="http://weblog.raganwald.com/2007/11/programming-conventions-as-signals.html">Programming conventions as signals</a> /

                <a href="http://weblog.raganwald.com/2007/10/too-much-of-good-thing-not-all.html">Not all functions should be object methods</a>

<br/><br/>

                <a href="http://weblog.raganwald.com/2007/05/not-so-big-software-application.html">The Not So Big Software Design</a> /

		<a href="http://weblog.raganwald.com/2007/04/writing-programs-for-people-to-read.html">Writing programs for people to read</a> /
                
		<a href="http://weblog.raganwald.com/2007/03/why-why-functional-programming-matters.html">Why Why Functional Programming Matters Matters</a> /

		<a href="http://weblog.raganwald.com/2007/02/but-y-would-i-want-to-do-thing-like.html">But Y would I want to do a thing like this?</a>

		<br />

		<br />

		<div class="SideBarTitle">Work</div>

                <a href="http://weblog.raganwald.com/2008/04/single-most-important-thing-you-must-do.html">The single most important thing you must do to improve your programming career</a> /

                <a href="http://weblog.raganwald.com/2008/02/naive-approach-to-hiring-people.html">The Na&iuml;ve Approach to Hiring People</a> /

                <a href="http://weblog.raganwald.com/2008/01/no-disrespect.html">No Disrespect</a> /

		<a href="http://weblog.raganwald.com/2006/11/take-control-of-your-interview.html">Take control of your interview</a> /

		<a href="http://weblog.raganwald.com/2006/08/three-tips-for-getting-job-through.html">Three tips for getting a job through a recruiter</a> /

		<a href="http://weblog.raganwald.com/2006/06/my-favourite-interview-question.html">My favourite interview question</a>

                <br/>

                <br/>



                <div class="SideBarTitle">Buy Raganwald a Coffee</div>
				
                       <div style="float: right; width: 64px; margin-left: 6px; font-style: italic; text-align: center; font-size: 80%;"><form name="DoubleEspresso" action="https://www.paypal.com/cgi-bin/webscr" method="post">
<input type="hidden" name="cmd" value="_donations">
<input type="hidden" name="business" value="raganwald@gmail.com">
<input type="hidden" name="item_name" value="Buy Raganwald a Darkhorse Double Espresso">
<input type="hidden" name="item_number" value="DoubleEspresso">
<input type="hidden" name="amount" value="3.15">
<input type="hidden" name="no_shipping" value="0">
<input type="hidden" name="logo_custom" value="http://weblog.raganwald.com/uploaded_images/coffeecup.png">
<input type="hidden" name="no_note" value="1">
<input type="hidden" name="currency_code" value="USD">
<input type="hidden" name="tax" value="0">
<input type="hidden" name="lc" value="CA">
<input type="hidden" name="bn" value="PP-DonationsBF">
<input type="image" src="http://weblog.raganwald.com/uploaded_images/coffeecup.png" width="64" height="64" border="0" name="submit" alt="Make payments with PayPal - it's fast, free and secure!">
<img alt="" border="0" src="https://www.paypal.com/en_US/i/scr/pixel.gif" width="1" height="1">
</form></div>If you enjoy reading my weblog, please consider <a href="#"
title="Buy Raganwald a darkhorse double espresso, for $3.15" onclick="javascript: document.DoubleEspresso.submit();">buying me a Darkhorse Double Espresso, for just $3.15</a>
                       Thank you!

		<br />

		<br />



		<div class="SideBarTitle">Management</div>

		<a href="http://weblog.raganwald.com/2008/02/exception-handling-in-software.html">Exception Handling in Software Development</a> /

		<a href="http://weblog.raganwald.com/2007/11/what-if-powerful-languages-and-idioms.html">What if powerful languages and idioms only work for small teams?</a> /

                <a href="http://weblog.raganwald.com/2007/08/bricks.html">Bricks</a> /

                <a href="http://weblog.raganwald.com/2007/06/which-theory-first-evidence.html">Which theory fits the evidence?</a> /

                <a href="http://weblog.raganwald.com/2007/06/still-failing-still-learning.html">Still failing, still learning</a> /

		<a href="http://weblog.raganwald.com/2005/01/what-ive-learned-from-failure.html">What I&rsquo;ve learned from failure</a>

		<br />

		<br />

		<div class="SideBarTitle">Notation</div> <!-- languages -->

		<a href="http://weblog.raganwald.com/2008/06/what-does-do-when-used-as-unary.html">The unary ampersand in Ruby</a> /

		<a href="http://weblog.raganwald.com/2008/02/1100inject.html">(1..100).inject(&amp;:+)</a> /

                <a href="http://weblog.raganwald.com/2007/10/challenge-of-teaching-yourself.html">The challenge of teaching yourself a programming language</a> /

                <a href="http://weblog.raganwald.com/2006/11/significance-of-meta-circular_22.html">The significance of the meta-circular interpreter</a> /
                
                <a href="http://weblog.raganwald.com/2007/08/block-structured-javascript.html">Block-Structured Javascript</a> /

                <a href="http://weblog.raganwald.com/2007/02/haskell-ruby-and-infinity.html">Haskell, Ruby and Infinity</a> /

		<a href="http://weblog.raganwald.com/2007/01/closures-and-higher-order-functions.html">Closures and Higher-Order Functions</a>

		<br />

		<br />

		<div class="SideBarTitle">Opinion</div>

		<a href="http://weblog.raganwald.com/2008/05/why-apple-is-more-expensive-than-amazon.html">Why Apple is more expensive than Amazon</a> /

		<a href="http://weblog.raganwald.com/2008/04/why-we-are-biggest-obstacle-to-our-own.html">Why we are the biggest obstacles to our own growth</a> /

		<a href="http://weblog.raganwald.com/2008/03/process-is-to-software-as-software-is.html">Is software the documentation of business process mistakes?</a> /

		<a href="http://weblog.raganwald.com/2007/09/we-have-lost-control-of-apparatus.html">We have lost control of the apparatus</a> /

		<a href="http://weblog.raganwald.com/2007/01/what-ive-learned-from-sales-part-i.html">What I&rsquo;ve Learned From Sales</a>
                <a href="http://weblog.raganwald.com/2007/01/what-ive-learned-from-sales-part-i.html" title="What I've Learned From Sales, Part I: Don't Feed the Trolls">I</a>, 
                <a href="http://weblog.raganwald.com/2007/01/what-ive-learned-from-sales-part-ii.html" title="What I've Learned from Sales, Part II: Wanna Bet?">II</a>, 
                <a href="http://weblog.raganwald.com/2007/10/how-to-use-blunt-instrument-to-sharpen.html" title="What I've Learned from Sales, Part III: How to use a blunt instrument to sharpen your saw">III</a>

		<br/>

		<br/>

		<div class="SideBarTitle">Whimsey</div>

                <a href="http://weblog.raganwald.com/2008/05/narcissism-of-small-code-differences.html">The Narcissism of Small Code Differences</a> /

		<a href="http://weblog.raganwald.com/2008/01/billy-martins-technique-for-managing.html">Billy Martin&rsquo;s Technique for Managing his Manager</a> /

		<a href="http://weblog.raganwald.com/2007/10/three-stories-about-tao.html">Three stories about The Tao</a> /

		<a href="http://weblog.raganwald.com/2007/02/programming-language-stories.html">Programming Language Stories</a> /

		<a href="http://weblog.raganwald.com/2005/07/why-you-need-degree-to-work-for-bigco.html">Why You Need a Degree to Work For BigCo</a>

		<br />

		<br />

		<div class="SideBarTitle">History</div>

		
			<a href="http://weblog.raganwald.com/archives/2004_06_01_archive.html">06/04</a> /
		
			<a href="http://weblog.raganwald.com/archives/2004_07_01_archive.html">07/04</a> /
		
			<a href="http://weblog.raganwald.com/archives/2004_08_01_archive.html">08/04</a> /
		
			<a href="http://weblog.raganwald.com/archives/2004_09_01_archive.html">09/04</a> /
		
			<a href="http://weblog.raganwald.com/archives/2004_10_01_archive.html">10/04</a> /
		
			<a href="http://weblog.raganwald.com/archives/2004_11_01_archive.html">11/04</a> /
		
			<a href="http://weblog.raganwald.com/archives/2004_12_01_archive.html">12/04</a> /
		
			<a href="http://weblog.raganwald.com/archives/2005_01_01_archive.html">01/05</a> /
		
			<a href="http://weblog.raganwald.com/archives/2005_02_01_archive.html">02/05</a> /
		
			<a href="http://weblog.raganwald.com/archives/2005_03_01_archive.html">03/05</a> /
		
			<a href="http://weblog.raganwald.com/archives/2005_04_01_archive.html">04/05</a> /
		
			<a href="http://weblog.raganwald.com/archives/2005_06_01_archive.html">06/05</a> /
		
			<a href="http://weblog.raganwald.com/archives/2005_07_01_archive.html">07/05</a> /
		
			<a href="http://weblog.raganwald.com/archives/2005_08_01_archive.html">08/05</a> /
		
			<a href="http://weblog.raganwald.com/archives/2005_09_01_archive.html">09/05</a> /
		
			<a href="http://weblog.raganwald.com/archives/2005_10_01_archive.html">10/05</a> /
		
			<a href="http://weblog.raganwald.com/archives/2005_11_01_archive.html">11/05</a> /
		
			<a href="http://weblog.raganwald.com/archives/2006_01_01_archive.html">01/06</a> /
		
			<a href="http://weblog.raganwald.com/archives/2006_02_01_archive.html">02/06</a> /
		
			<a href="http://weblog.raganwald.com/archives/2006_03_01_archive.html">03/06</a> /
		
			<a href="http://weblog.raganwald.com/archives/2006_04_01_archive.html">04/06</a> /
		
			<a href="http://weblog.raganwald.com/archives/2006_05_01_archive.html">05/06</a> /
		
			<a href="http://weblog.raganwald.com/archives/2006_06_01_archive.html">06/06</a> /
		
			<a href="http://weblog.raganwald.com/archives/2006_07_01_archive.html">07/06</a> /
		
			<a href="http://weblog.raganwald.com/archives/2006_08_01_archive.html">08/06</a> /
		
			<a href="http://weblog.raganwald.com/archives/2006_09_01_archive.html">09/06</a> /
		
			<a href="http://weblog.raganwald.com/archives/2006_10_01_archive.html">10/06</a> /
		
			<a href="http://weblog.raganwald.com/archives/2006_11_01_archive.html">11/06</a> /
		
			<a href="http://weblog.raganwald.com/archives/2006_12_01_archive.html">12/06</a> /
		
			<a href="http://weblog.raganwald.com/archives/2007_01_01_archive.html">01/07</a> /
		
			<a href="http://weblog.raganwald.com/archives/2007_02_01_archive.html">02/07</a> /
		
			<a href="http://weblog.raganwald.com/archives/2007_03_01_archive.html">03/07</a> /
		
			<a href="http://weblog.raganwald.com/archives/2007_04_01_archive.html">04/07</a> /
		
			<a href="http://weblog.raganwald.com/archives/2007_05_01_archive.html">05/07</a> /
		
			<a href="http://weblog.raganwald.com/archives/2007_06_01_archive.html">06/07</a> /
		
			<a href="http://weblog.raganwald.com/archives/2007_07_01_archive.html">07/07</a> /
		
			<a href="http://weblog.raganwald.com/archives/2007_08_01_archive.html">08/07</a> /
		
			<a href="http://weblog.raganwald.com/archives/2007_09_01_archive.html">09/07</a> /
		
			<a href="http://weblog.raganwald.com/archives/2007_10_01_archive.html">10/07</a> /
		
			<a href="http://weblog.raganwald.com/archives/2007_11_01_archive.html">11/07</a> /
		
			<a href="http://weblog.raganwald.com/archives/2007_12_01_archive.html">12/07</a> /
		
			<a href="http://weblog.raganwald.com/archives/2008_01_01_archive.html">01/08</a> /
		
			<a href="http://weblog.raganwald.com/archives/2008_02_01_archive.html">02/08</a> /
		
			<a href="http://weblog.raganwald.com/archives/2008_03_01_archive.html">03/08</a> /
		
			<a href="http://weblog.raganwald.com/archives/2008_04_01_archive.html">04/08</a> /
		
			<a href="http://weblog.raganwald.com/archives/2008_05_01_archive.html">05/08</a> /
		
			<a href="http://weblog.raganwald.com/archives/2008_06_01_archive.html">06/08</a> /
		
			<a href="http://weblog.raganwald.com/archives/2008_07_01_archive.html">07/08</a> /
		
		<script type="text/javascript" language="Javascript">if (location.href.indexOf("archive")!=-1) document.write("<strong><a href=\"http://weblog.raganwald.com/welcome.html\">Current Posts</a></strong>");</script>
		<br/></p>
		<br/>

		<p class="profile-link"><a href="http://feeds.raganwald.com/raganwald"><img src="http://feeds.raganwald.com/~fc/raganwald?bg=&amp;fg=&amp;anim=0" height="26" width="88" style="border: 0pt none ; vertical-align: middle;" alt="" /></a>&nbsp;<a href="http://feeds.raganwald.com/raganwald" rel="alternate" type="application/rss+xml"><img src="http://www.raganwald.com/fb/images/pub/feed-icon16x16.png" alt="" style="border: 0pt none ; vertical-align: middle;"></a>&nbsp;<a href="http://feeds.raganwald.com/raganwald" rel="alternate" type="application/rss+xml">Subscribe in a reader</a></p>

	</div>





	<div style="visibility: hidden">
		<script type="text/javascript" src="http://www.blogger.com/static/v1/common/js/327583163-csitaillib.js"></script>
		
		<script type="text/javascript" src="http://www.assoc-amazon.com/s/link-enhancer?tag=raganwald001-20">
		</script>
		<noscript>
			<img src="http://www.assoc-amazon.com/s/noscript?tag=raganwald001-20" alt="" />
		</noscript>
	</div>

</body>
</html>